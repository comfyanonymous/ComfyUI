services:
  comfyui:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: comfyui
    ports:
      - "8188:8188"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    ipc: host
    volumes:
      - .:/app/ComfyUI                    # Mount local repo (for git checkout updates)
      - comfyui-models:/app/ComfyUI/models      # Persist models
      - comfyui-output:/app/ComfyUI/output      # Persist outputs
      - comfyui-input:/app/ComfyUI/input        # Persist inputs
      - comfyui-custom-nodes:/app/ComfyUI/custom_nodes  # Persist custom nodes
      - comfyui-user:/app/ComfyUI/user          # Persist user settings/workflows
      - comfyui-venv:/app/venv                  # Cache virtualenv
    environment:
      - TZ=America/Chicago
      - PUID=1000
      - PGID=1000
      # OpenTelemetry environment variables (optional - set if you want OTEL)
      # - OTEL_EXPORTER_OTLP_ENDPOINT=http://your-otel-collector:4317
      # - OTEL_SERVICE_NAME=comfyui
      # - OTEL_RESOURCE_ATTRIBUTES=service.name=comfyui
    restart: unless-stopped

volumes:
  comfyui-models:
  comfyui-output:
  comfyui-input:
  comfyui-custom-nodes:
  comfyui-user:
  comfyui-venv:

