{"version":3,"file":"index-Bln5LBF6.js","sources":["../../src/extensions/core/clipspace.ts","../../src/extensions/core/colorPalette.ts","../../src/extensions/core/contextMenuFilter.ts","../../src/extensions/core/dynamicPrompts.ts","../../src/extensions/core/editAttention.ts","../../src/extensions/core/widgetInputs.ts","../../src/extensions/core/groupNodeManage.ts","../../src/extensions/core/groupNode.ts","../../src/extensions/core/groupOptions.ts","../../src/extensions/core/invertMenuScrolling.ts","../../src/extensions/core/keybinds.ts","../../src/extensions/core/linkRenderMode.ts","../../src/extensions/core/maskeditor.ts","../../src/extensions/core/nodeTemplates.ts","../../src/extensions/core/noteNode.ts","../../src/extensions/core/rerouteNode.ts","../../src/extensions/core/saveImageExtraOutput.ts","../../src/extensions/core/simpleTouchSupport.ts","../../src/extensions/core/slotDefaults.ts","../../src/extensions/core/snapToGrid.ts","../../src/extensions/core/uploadImage.ts","../../src/extensions/core/webcamCapture.ts","../../src/extensions/core/uploadAudio.ts"],"sourcesContent":["import { app } from '../../scripts/app'\nimport { ComfyDialog, $el } from '../../scripts/ui'\nimport { ComfyApp } from '../../scripts/app'\n\nexport class ClipspaceDialog extends ComfyDialog {\n  static items = []\n  static instance = null\n\n  static registerButton(name, contextPredicate, callback) {\n    const item = $el('button', {\n      type: 'button',\n      textContent: name,\n      contextPredicate: contextPredicate,\n      onclick: callback\n    })\n\n    ClipspaceDialog.items.push(item)\n  }\n\n  static invalidatePreview() {\n    if (\n      ComfyApp.clipspace &&\n      ComfyApp.clipspace.imgs &&\n      ComfyApp.clipspace.imgs.length > 0\n    ) {\n      const img_preview = document.getElementById(\n        'clipspace_preview'\n      ) as HTMLImageElement\n      if (img_preview) {\n        img_preview.src =\n          ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src\n        img_preview.style.maxHeight = '100%'\n        img_preview.style.maxWidth = '100%'\n      }\n    }\n  }\n\n  static invalidate() {\n    if (ClipspaceDialog.instance) {\n      const self = ClipspaceDialog.instance\n      // allow reconstruct controls when copying from non-image to image content.\n      const children = $el('div.comfy-modal-content', [\n        self.createImgSettings(),\n        ...self.createButtons()\n      ])\n\n      if (self.element) {\n        // update\n        self.element.removeChild(self.element.firstChild)\n        self.element.appendChild(children)\n      } else {\n        // new\n        self.element = $el('div.comfy-modal', { parent: document.body }, [\n          children\n        ])\n      }\n\n      if (self.element.children[0].children.length <= 1) {\n        self.element.children[0].appendChild(\n          $el('p', {}, [\n            'Unable to find the features to edit content of a format stored in the current Clipspace.'\n          ])\n        )\n      }\n\n      ClipspaceDialog.invalidatePreview()\n    }\n  }\n\n  constructor() {\n    super()\n  }\n\n  createButtons() {\n    const buttons = []\n\n    for (let idx in ClipspaceDialog.items) {\n      const item = ClipspaceDialog.items[idx]\n      if (!item.contextPredicate || item.contextPredicate())\n        buttons.push(ClipspaceDialog.items[idx])\n    }\n\n    buttons.push(\n      $el('button', {\n        type: 'button',\n        textContent: 'Close',\n        onclick: () => {\n          this.close()\n        }\n      })\n    )\n\n    return buttons\n  }\n\n  createImgSettings() {\n    if (ComfyApp.clipspace.imgs) {\n      const combo_items = []\n      const imgs = ComfyApp.clipspace.imgs\n\n      for (let i = 0; i < imgs.length; i++) {\n        combo_items.push($el('option', { value: i }, [`${i}`]))\n      }\n\n      const combo1 = $el(\n        'select',\n        {\n          id: 'clipspace_img_selector',\n          onchange: (event) => {\n            ComfyApp.clipspace['selectedIndex'] = event.target.selectedIndex\n            ClipspaceDialog.invalidatePreview()\n          }\n        },\n        combo_items\n      )\n\n      const row1 = $el('tr', {}, [\n        $el('td', {}, [$el('font', { color: 'white' }, ['Select Image'])]),\n        $el('td', {}, [combo1])\n      ])\n\n      const combo2 = $el(\n        'select',\n        {\n          id: 'clipspace_img_paste_mode',\n          onchange: (event) => {\n            ComfyApp.clipspace['img_paste_mode'] = event.target.value\n          }\n        },\n        [\n          $el('option', { value: 'selected' }, 'selected'),\n          $el('option', { value: 'all' }, 'all')\n        ]\n      ) as HTMLSelectElement\n      combo2.value = ComfyApp.clipspace['img_paste_mode']\n\n      const row2 = $el('tr', {}, [\n        $el('td', {}, [$el('font', { color: 'white' }, ['Paste Mode'])]),\n        $el('td', {}, [combo2])\n      ])\n\n      const td = $el(\n        'td',\n        { align: 'center', width: '100px', height: '100px', colSpan: '2' },\n        [$el('img', { id: 'clipspace_preview', ondragstart: () => false }, [])]\n      )\n\n      const row3 = $el('tr', {}, [td])\n\n      return $el('table', {}, [row1, row2, row3])\n    } else {\n      return []\n    }\n  }\n\n  createImgPreview() {\n    if (ComfyApp.clipspace.imgs) {\n      return $el('img', { id: 'clipspace_preview', ondragstart: () => false })\n    } else return []\n  }\n\n  show() {\n    const img_preview = document.getElementById('clipspace_preview')\n    ClipspaceDialog.invalidate()\n\n    this.element.style.display = 'block'\n  }\n}\n\napp.registerExtension({\n  name: 'Comfy.Clipspace',\n  init(app) {\n    app.openClipspace = function () {\n      if (!ClipspaceDialog.instance) {\n        ClipspaceDialog.instance = new ClipspaceDialog()\n        ComfyApp.clipspace_invalidate_handler = ClipspaceDialog.invalidate\n      }\n\n      if (ComfyApp.clipspace) {\n        ClipspaceDialog.instance.show()\n      } else app.ui.dialog.show('Clipspace is Empty!')\n    }\n  }\n})\n","import { lightenColor } from '@/utils/colorUtil'\nimport { app } from '../../scripts/app'\nimport { $el } from '../../scripts/ui'\nimport type { ColorPalettes, Palette } from '@/types/colorPalette'\nimport { LGraphCanvas, LiteGraph } from '@comfyorg/litegraph'\n\n// Manage color palettes\n\nconst colorPalettes: ColorPalettes = {\n  dark: {\n    id: 'dark',\n    name: 'Dark (Default)',\n    colors: {\n      node_slot: {\n        CLIP: '#FFD500', // bright yellow\n        CLIP_VISION: '#A8DADC', // light blue-gray\n        CLIP_VISION_OUTPUT: '#ad7452', // rusty brown-orange\n        CONDITIONING: '#FFA931', // vibrant orange-yellow\n        CONTROL_NET: '#6EE7B7', // soft mint green\n        IMAGE: '#64B5F6', // bright sky blue\n        LATENT: '#FF9CF9', // light pink-purple\n        MASK: '#81C784', // muted green\n        MODEL: '#B39DDB', // light lavender-purple\n        STYLE_MODEL: '#C2FFAE', // light green-yellow\n        VAE: '#FF6E6E', // bright red\n        NOISE: '#B0B0B0', // gray\n        GUIDER: '#66FFFF', // cyan\n        SAMPLER: '#ECB4B4', // very soft red\n        SIGMAS: '#CDFFCD', // soft lime green\n        TAESD: '#DCC274' // cheesecake\n      },\n      litegraph_base: {\n        BACKGROUND_IMAGE:\n          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=',\n        CLEAR_BACKGROUND_COLOR: '#222',\n        NODE_TITLE_COLOR: '#999',\n        NODE_SELECTED_TITLE_COLOR: '#FFF',\n        NODE_TEXT_SIZE: 14,\n        NODE_TEXT_COLOR: '#AAA',\n        NODE_SUBTEXT_SIZE: 12,\n        NODE_DEFAULT_COLOR: '#333',\n        NODE_DEFAULT_BGCOLOR: '#353535',\n        NODE_DEFAULT_BOXCOLOR: '#666',\n        NODE_DEFAULT_SHAPE: 'box',\n        NODE_BOX_OUTLINE_COLOR: '#FFF',\n        DEFAULT_SHADOW_COLOR: 'rgba(0,0,0,0.5)',\n        DEFAULT_GROUP_FONT: 24,\n\n        WIDGET_BGCOLOR: '#222',\n        WIDGET_OUTLINE_COLOR: '#666',\n        WIDGET_TEXT_COLOR: '#DDD',\n        WIDGET_SECONDARY_TEXT_COLOR: '#999',\n\n        LINK_COLOR: '#9A9',\n        EVENT_LINK_COLOR: '#A86',\n        CONNECTING_LINK_COLOR: '#AFA'\n      },\n      comfy_base: {\n        'fg-color': '#fff',\n        'bg-color': '#202020',\n        'comfy-menu-bg': '#353535',\n        'comfy-input-bg': '#222',\n        'input-text': '#ddd',\n        'descrip-text': '#999',\n        'drag-text': '#ccc',\n        'error-text': '#ff4444',\n        'border-color': '#4e4e4e',\n        'tr-even-bg-color': '#222',\n        'tr-odd-bg-color': '#353535',\n        'content-bg': '#4e4e4e',\n        'content-fg': '#fff',\n        'content-hover-bg': '#222',\n        'content-hover-fg': '#fff'\n      }\n    }\n  },\n  light: {\n    id: 'light',\n    name: 'Light',\n    colors: {\n      node_slot: {\n        CLIP: '#FFA726', // orange\n        CLIP_VISION: '#5C6BC0', // indigo\n        CLIP_VISION_OUTPUT: '#8D6E63', // brown\n        CONDITIONING: '#EF5350', // red\n        CONTROL_NET: '#66BB6A', // green\n        IMAGE: '#42A5F5', // blue\n        LATENT: '#AB47BC', // purple\n        MASK: '#9CCC65', // light green\n        MODEL: '#7E57C2', // deep purple\n        STYLE_MODEL: '#D4E157', // lime\n        VAE: '#FF7043' // deep orange\n      },\n      litegraph_base: {\n        BACKGROUND_IMAGE:\n          'data:image/gif;base64,R0lGODlhZABkALMAAAAAAP///+vr6+rq6ujo6Ofn5+bm5uXl5d3d3f///wAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAkALAAAAABkAGQAAAT/UMhJq7046827HkcoHkYxjgZhnGG6si5LqnIM0/fL4qwwIMAg0CAsEovBIxKhRDaNy2GUOX0KfVFrssrNdpdaqTeKBX+dZ+jYvEaTf+y4W66mC8PUdrE879f9d2mBeoNLfH+IhYBbhIx2jkiHiomQlGKPl4uZe3CaeZifnnijgkESBqipqqusra6vsLGys62SlZO4t7qbuby7CLa+wqGWxL3Gv3jByMOkjc2lw8vOoNSi0czAncXW3Njdx9Pf48/Z4Kbbx+fQ5evZ4u3k1fKR6cn03vHlp7T9/v8A/8Gbp4+gwXoFryXMB2qgwoMMHyKEqA5fxX322FG8tzBcRnMW/zlulPbRncmQGidKjMjyYsOSKEF2FBlJQMCbOHP6c9iSZs+UnGYCdbnSo1CZI5F64kn0p1KnTH02nSoV3dGTV7FFHVqVq1dtWcMmVQZTbNGu72zqXMuW7danVL+6e4t1bEy6MeueBYLXrNO5Ze36jQtWsOG97wIj1vt3St/DjTEORss4nNq2mDP3e7w4r1bFkSET5hy6s2TRlD2/mSxXtSHQhCunXo26NevCpmvD/UU6tuullzULH76q92zdZG/Ltv1a+W+osI/nRmyc+fRi1Xdbh+68+0vv10dH3+77KD/i6IdnX669/frn5Zsjh4/2PXju8+8bzc9/6fj27LFnX11/+IUnXWl7BJfegm79FyB9JOl3oHgSklefgxAC+FmFGpqHIYcCfkhgfCohSKKJVo044YUMttggiBkmp6KFXw1oII24oYhjiDByaKOOHcp3Y5BD/njikSkO+eBREQAAOw==',\n        CLEAR_BACKGROUND_COLOR: 'lightgray',\n        NODE_TITLE_COLOR: '#222',\n        NODE_SELECTED_TITLE_COLOR: '#000',\n        NODE_TEXT_SIZE: 14,\n        NODE_TEXT_COLOR: '#444',\n        NODE_SUBTEXT_SIZE: 12,\n        NODE_DEFAULT_COLOR: '#F7F7F7',\n        NODE_DEFAULT_BGCOLOR: '#F5F5F5',\n        NODE_DEFAULT_BOXCOLOR: '#CCC',\n        NODE_DEFAULT_SHAPE: 'box',\n        NODE_BOX_OUTLINE_COLOR: '#000',\n        DEFAULT_SHADOW_COLOR: 'rgba(0,0,0,0.1)',\n        DEFAULT_GROUP_FONT: 24,\n\n        WIDGET_BGCOLOR: '#D4D4D4',\n        WIDGET_OUTLINE_COLOR: '#999',\n        WIDGET_TEXT_COLOR: '#222',\n        WIDGET_SECONDARY_TEXT_COLOR: '#555',\n\n        LINK_COLOR: '#4CAF50',\n        EVENT_LINK_COLOR: '#FF9800',\n        CONNECTING_LINK_COLOR: '#2196F3'\n      },\n      comfy_base: {\n        'fg-color': '#222',\n        'bg-color': '#DDD',\n        'comfy-menu-bg': '#F5F5F5',\n        'comfy-input-bg': '#C9C9C9',\n        'input-text': '#222',\n        'descrip-text': '#444',\n        'drag-text': '#555',\n        'error-text': '#F44336',\n        'border-color': '#888',\n        'tr-even-bg-color': '#f9f9f9',\n        'tr-odd-bg-color': '#fff',\n        'content-bg': '#e0e0e0',\n        'content-fg': '#222',\n        'content-hover-bg': '#adadad',\n        'content-hover-fg': '#222'\n      }\n    }\n  },\n  solarized: {\n    id: 'solarized',\n    name: 'Solarized',\n    colors: {\n      node_slot: {\n        CLIP: '#2AB7CA', // light blue\n        CLIP_VISION: '#6c71c4', // blue violet\n        CLIP_VISION_OUTPUT: '#859900', // olive green\n        CONDITIONING: '#d33682', // magenta\n        CONTROL_NET: '#d1ffd7', // light mint green\n        IMAGE: '#5940bb', // deep blue violet\n        LATENT: '#268bd2', // blue\n        MASK: '#CCC9E7', // light purple-gray\n        MODEL: '#dc322f', // red\n        STYLE_MODEL: '#1a998a', // teal\n        UPSCALE_MODEL: '#054A29', // dark green\n        VAE: '#facfad' // light pink-orange\n      },\n      litegraph_base: {\n        NODE_TITLE_COLOR: '#fdf6e3', // Base3\n        NODE_SELECTED_TITLE_COLOR: '#A9D400',\n        NODE_TEXT_SIZE: 14,\n        NODE_TEXT_COLOR: '#657b83', // Base00\n        NODE_SUBTEXT_SIZE: 12,\n        NODE_DEFAULT_COLOR: '#094656',\n        NODE_DEFAULT_BGCOLOR: '#073642', // Base02\n        NODE_DEFAULT_BOXCOLOR: '#839496', // Base0\n        NODE_DEFAULT_SHAPE: 'box',\n        NODE_BOX_OUTLINE_COLOR: '#fdf6e3', // Base3\n        DEFAULT_SHADOW_COLOR: 'rgba(0,0,0,0.5)',\n        DEFAULT_GROUP_FONT: 24,\n\n        WIDGET_BGCOLOR: '#002b36', // Base03\n        WIDGET_OUTLINE_COLOR: '#839496', // Base0\n        WIDGET_TEXT_COLOR: '#fdf6e3', // Base3\n        WIDGET_SECONDARY_TEXT_COLOR: '#93a1a1', // Base1\n\n        LINK_COLOR: '#2aa198', // Solarized Cyan\n        EVENT_LINK_COLOR: '#268bd2', // Solarized Blue\n        CONNECTING_LINK_COLOR: '#859900' // Solarized Green\n      },\n      comfy_base: {\n        'fg-color': '#fdf6e3', // Base3\n        'bg-color': '#002b36', // Base03\n        'comfy-menu-bg': '#073642', // Base02\n        'comfy-input-bg': '#002b36', // Base03\n        'input-text': '#93a1a1', // Base1\n        'descrip-text': '#586e75', // Base01\n        'drag-text': '#839496', // Base0\n        'error-text': '#dc322f', // Solarized Red\n        'border-color': '#657b83', // Base00\n        'tr-even-bg-color': '#002b36',\n        'tr-odd-bg-color': '#073642',\n        'content-bg': '#657b83',\n        'content-fg': '#fdf6e3',\n        'content-hover-bg': '#002b36',\n        'content-hover-fg': '#fdf6e3'\n      }\n    }\n  },\n  arc: {\n    id: 'arc',\n    name: 'Arc',\n    colors: {\n      node_slot: {\n        BOOLEAN: '',\n        CLIP: '#eacb8b',\n        CLIP_VISION: '#A8DADC',\n        CLIP_VISION_OUTPUT: '#ad7452',\n        CONDITIONING: '#cf876f',\n        CONTROL_NET: '#00d78d',\n        CONTROL_NET_WEIGHTS: '',\n        FLOAT: '',\n        GLIGEN: '',\n        IMAGE: '#80a1c0',\n        IMAGEUPLOAD: '',\n        INT: '',\n        LATENT: '#b38ead',\n        LATENT_KEYFRAME: '',\n        MASK: '#a3bd8d',\n        MODEL: '#8978a7',\n        SAMPLER: '',\n        SIGMAS: '',\n        STRING: '',\n        STYLE_MODEL: '#C2FFAE',\n        T2I_ADAPTER_WEIGHTS: '',\n        TAESD: '#DCC274',\n        TIMESTEP_KEYFRAME: '',\n        UPSCALE_MODEL: '',\n        VAE: '#be616b'\n      },\n      litegraph_base: {\n        BACKGROUND_IMAGE:\n          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcklEQVR4nO3YMUoDARgF4RfxBqZI6/0vZqFn0MYtrLIQMFN8U6V4LAtD+Jm9XG/v30OGl2e/AP7yevz4+vx45nvgF/+QGITEICQGITEIiUFIjNNC3q43u3/YnRJyPOzeQ+0e220nhRzReC8e7R7bbdvl+Jal1Bs46jEIiUFIDEJiEBKDkBhKPbZT6qHdptRTu02p53DUYxASg5AYhMQgJAYhMZR6bKfUQ7tNqad2m1LP4ajHICQGITEIiUFIDEJiKPXYTqmHdptST+02pZ7DUY9BSAxCYhASg5AYhMRQ6rGdUg/tNqWe2m1KPYejHoOQGITEICQGITEIiaHUYzulHtptSj2125R6Dkc9BiExCIlBSAxCYhASQ6nHdko9tNuUemq3KfUcjnoMQmIQEoOQGITEICSGUo/tlHpotyn11G5T6jkc9RiExCAkBiExCIlBSAylHtsp9dBuU+qp3abUczjqMQiJQUgMQmIQEoOQGITE+AHFISNQrFTGuwAAAABJRU5ErkJggg==',\n        CLEAR_BACKGROUND_COLOR: '#2b2f38',\n        NODE_TITLE_COLOR: '#b2b7bd',\n        NODE_SELECTED_TITLE_COLOR: '#FFF',\n        NODE_TEXT_SIZE: 14,\n        NODE_TEXT_COLOR: '#AAA',\n        NODE_SUBTEXT_SIZE: 12,\n        NODE_DEFAULT_COLOR: '#2b2f38',\n        NODE_DEFAULT_BGCOLOR: '#242730',\n        NODE_DEFAULT_BOXCOLOR: '#6e7581',\n        NODE_DEFAULT_SHAPE: 'box',\n        NODE_BOX_OUTLINE_COLOR: '#FFF',\n        DEFAULT_SHADOW_COLOR: 'rgba(0,0,0,0.5)',\n        DEFAULT_GROUP_FONT: 22,\n        WIDGET_BGCOLOR: '#2b2f38',\n        WIDGET_OUTLINE_COLOR: '#6e7581',\n        WIDGET_TEXT_COLOR: '#DDD',\n        WIDGET_SECONDARY_TEXT_COLOR: '#b2b7bd',\n        LINK_COLOR: '#9A9',\n        EVENT_LINK_COLOR: '#A86',\n        CONNECTING_LINK_COLOR: '#AFA'\n      },\n      comfy_base: {\n        'fg-color': '#fff',\n        'bg-color': '#2b2f38',\n        'comfy-menu-bg': '#242730',\n        'comfy-input-bg': '#2b2f38',\n        'input-text': '#ddd',\n        'descrip-text': '#b2b7bd',\n        'drag-text': '#ccc',\n        'error-text': '#ff4444',\n        'border-color': '#6e7581',\n        'tr-even-bg-color': '#2b2f38',\n        'tr-odd-bg-color': '#242730',\n        'content-bg': '#6e7581',\n        'content-fg': '#fff',\n        'content-hover-bg': '#2b2f38',\n        'content-hover-fg': '#fff'\n      }\n    }\n  },\n  nord: {\n    id: 'nord',\n    name: 'Nord',\n    colors: {\n      node_slot: {\n        BOOLEAN: '',\n        CLIP: '#eacb8b',\n        CLIP_VISION: '#A8DADC',\n        CLIP_VISION_OUTPUT: '#ad7452',\n        CONDITIONING: '#cf876f',\n        CONTROL_NET: '#00d78d',\n        CONTROL_NET_WEIGHTS: '',\n        FLOAT: '',\n        GLIGEN: '',\n        IMAGE: '#80a1c0',\n        IMAGEUPLOAD: '',\n        INT: '',\n        LATENT: '#b38ead',\n        LATENT_KEYFRAME: '',\n        MASK: '#a3bd8d',\n        MODEL: '#8978a7',\n        SAMPLER: '',\n        SIGMAS: '',\n        STRING: '',\n        STYLE_MODEL: '#C2FFAE',\n        T2I_ADAPTER_WEIGHTS: '',\n        TAESD: '#DCC274',\n        TIMESTEP_KEYFRAME: '',\n        UPSCALE_MODEL: '',\n        VAE: '#be616b'\n      },\n      litegraph_base: {\n        BACKGROUND_IMAGE:\n          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFu2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OSwgMjAyMy8wNi8yNS0yMDowMTo1NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI1LjEgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0xMS0xM1QwMDoxODowMiswMTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMTEtMTVUMDE6MjA6NDUrMDE6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMTEtMTVUMDE6MjA6NDUrMDE6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjUwNDFhMmZjLTEzNzQtMTk0ZC1hZWY4LTYxMzM1MTVmNjUwMCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyMzFiMTBiMC1iNGZiLTAyNGUtYjEyZS0zMDUzMDNjZDA3YzgiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyMzFiMTBiMC1iNGZiLTAyNGUtYjEyZS0zMDUzMDNjZDA3YzgiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjIzMWIxMGIwLWI0ZmItMDI0ZS1iMTJlLTMwNTMwM2NkMDdjOCIgc3RFdnQ6d2hlbj0iMjAyMy0xMS0xM1QwMDoxODowMiswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI1LjEgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1MDQxYTJmYy0xMzc0LTE5NGQtYWVmOC02MTMzNTE1ZjY1MDAiIHN0RXZ0OndoZW49IjIwMjMtMTEtMTVUMDE6MjA6NDUrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyNS4xIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz73jWg/AAAAyUlEQVR42u3WKwoAIBRFQRdiMb1idv9Lsxn9gEFw4Dbb8JCTojbbXEJwjJVL2HKwYMGCBQuWLbDmjr+9zrBGjHl1WVcvy2DBggULFizTWQpewSt4HzwsgwULFiwFr7MUvMtS8D54WLBgGSxYCl7BK3iXZbBgwYIFC5bpLAWv4BW8Dx6WwYIFC5aC11kK3mUpeB88LFiwDBYsBa/gFbzLMliwYMGCBct0loJX8AreBw/LYMGCBUvB6ywF77IUvA8eFixYBgsWrNfWAZPltufdad+1AAAAAElFTkSuQmCC',\n        CLEAR_BACKGROUND_COLOR: '#212732',\n        NODE_TITLE_COLOR: '#999',\n        NODE_SELECTED_TITLE_COLOR: '#e5eaf0',\n        NODE_TEXT_SIZE: 14,\n        NODE_TEXT_COLOR: '#bcc2c8',\n        NODE_SUBTEXT_SIZE: 12,\n        NODE_DEFAULT_COLOR: '#2e3440',\n        NODE_DEFAULT_BGCOLOR: '#161b22',\n        NODE_DEFAULT_BOXCOLOR: '#545d70',\n        NODE_DEFAULT_SHAPE: 'box',\n        NODE_BOX_OUTLINE_COLOR: '#e5eaf0',\n        DEFAULT_SHADOW_COLOR: 'rgba(0,0,0,0.5)',\n        DEFAULT_GROUP_FONT: 24,\n        WIDGET_BGCOLOR: '#2e3440',\n        WIDGET_OUTLINE_COLOR: '#545d70',\n        WIDGET_TEXT_COLOR: '#bcc2c8',\n        WIDGET_SECONDARY_TEXT_COLOR: '#999',\n        LINK_COLOR: '#9A9',\n        EVENT_LINK_COLOR: '#A86',\n        CONNECTING_LINK_COLOR: '#AFA'\n      },\n      comfy_base: {\n        'fg-color': '#e5eaf0',\n        'bg-color': '#2e3440',\n        'comfy-menu-bg': '#161b22',\n        'comfy-input-bg': '#2e3440',\n        'input-text': '#bcc2c8',\n        'descrip-text': '#999',\n        'drag-text': '#ccc',\n        'error-text': '#ff4444',\n        'border-color': '#545d70',\n        'tr-even-bg-color': '#2e3440',\n        'tr-odd-bg-color': '#161b22',\n        'content-bg': '#545d70',\n        'content-fg': '#e5eaf0',\n        'content-hover-bg': '#2e3440',\n        'content-hover-fg': '#e5eaf0'\n      }\n    }\n  },\n  github: {\n    id: 'github',\n    name: 'Github',\n    colors: {\n      node_slot: {\n        BOOLEAN: '',\n        CLIP: '#eacb8b',\n        CLIP_VISION: '#A8DADC',\n        CLIP_VISION_OUTPUT: '#ad7452',\n        CONDITIONING: '#cf876f',\n        CONTROL_NET: '#00d78d',\n        CONTROL_NET_WEIGHTS: '',\n        FLOAT: '',\n        GLIGEN: '',\n        IMAGE: '#80a1c0',\n        IMAGEUPLOAD: '',\n        INT: '',\n        LATENT: '#b38ead',\n        LATENT_KEYFRAME: '',\n        MASK: '#a3bd8d',\n        MODEL: '#8978a7',\n        SAMPLER: '',\n        SIGMAS: '',\n        STRING: '',\n        STYLE_MODEL: '#C2FFAE',\n        T2I_ADAPTER_WEIGHTS: '',\n        TAESD: '#DCC274',\n        TIMESTEP_KEYFRAME: '',\n        UPSCALE_MODEL: '',\n        VAE: '#be616b'\n      },\n      litegraph_base: {\n        BACKGROUND_IMAGE:\n          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGlmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OSwgMjAyMy8wNi8yNS0yMDowMTo1NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI1LjEgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0xMS0xM1QwMDoxODowMiswMTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMTEtMTVUMDI6MDQ6NTkrMDE6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMTEtMTVUMDI6MDQ6NTkrMDE6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmIyYzRhNjA5LWJmYTctYTg0MC1iOGFlLTk3MzE2ZjM1ZGIyNyIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjk0ZmNlZGU4LTE1MTctZmQ0MC04ZGU3LWYzOTgxM2E3ODk5ZiIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjIzMWIxMGIwLWI0ZmItMDI0ZS1iMTJlLTMwNTMwM2NkMDdjOCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjMxYjEwYjAtYjRmYi0wMjRlLWIxMmUtMzA1MzAzY2QwN2M4IiBzdEV2dDp3aGVuPSIyMDIzLTExLTEzVDAwOjE4OjAyKzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjUuMSAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ4OWY1NzlmLTJkNjUtZWQ0Zi04OTg0LTA4NGE2MGE1ZTMzNSIgc3RFdnQ6d2hlbj0iMjAyMy0xMS0xNVQwMjowNDo1OSswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI1LjEgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiMmM0YTYwOS1iZmE3LWE4NDAtYjhhZS05NzMxNmYzNWRiMjciIHN0RXZ0OndoZW49IjIwMjMtMTEtMTVUMDI6MDQ6NTkrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyNS4xIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4OTe6GAAAAx0lEQVR42u3WMQoAIQxFwRzJys77X8vSLiRgITif7bYbgrwYc/mKXyBoY4VVBgsWLFiwYFmOlTv+9jfDOjHmr8u6eVkGCxYsWLBgmc5S8ApewXvgYRksWLBgKXidpeBdloL3wMOCBctgwVLwCl7BuyyDBQsWLFiwTGcpeAWv4D3wsAwWLFiwFLzOUvAuS8F74GHBgmWwYCl4Ba/gXZbBggULFixYprMUvIJX8B54WAYLFixYCl5nKXiXpeA98LBgwTJYsGC9tg1o8f4TTtqzNQAAAABJRU5ErkJggg==',\n        CLEAR_BACKGROUND_COLOR: '#040506',\n        NODE_TITLE_COLOR: '#999',\n        NODE_SELECTED_TITLE_COLOR: '#e5eaf0',\n        NODE_TEXT_SIZE: 14,\n        NODE_TEXT_COLOR: '#bcc2c8',\n        NODE_SUBTEXT_SIZE: 12,\n        NODE_DEFAULT_COLOR: '#161b22',\n        NODE_DEFAULT_BGCOLOR: '#13171d',\n        NODE_DEFAULT_BOXCOLOR: '#30363d',\n        NODE_DEFAULT_SHAPE: 'box',\n        NODE_BOX_OUTLINE_COLOR: '#e5eaf0',\n        DEFAULT_SHADOW_COLOR: 'rgba(0,0,0,0.5)',\n        DEFAULT_GROUP_FONT: 24,\n        WIDGET_BGCOLOR: '#161b22',\n        WIDGET_OUTLINE_COLOR: '#30363d',\n        WIDGET_TEXT_COLOR: '#bcc2c8',\n        WIDGET_SECONDARY_TEXT_COLOR: '#999',\n        LINK_COLOR: '#9A9',\n        EVENT_LINK_COLOR: '#A86',\n        CONNECTING_LINK_COLOR: '#AFA'\n      },\n      comfy_base: {\n        'fg-color': '#e5eaf0',\n        'bg-color': '#161b22',\n        'comfy-menu-bg': '#13171d',\n        'comfy-input-bg': '#161b22',\n        'input-text': '#bcc2c8',\n        'descrip-text': '#999',\n        'drag-text': '#ccc',\n        'error-text': '#ff4444',\n        'border-color': '#30363d',\n        'tr-even-bg-color': '#161b22',\n        'tr-odd-bg-color': '#13171d',\n        'content-bg': '#30363d',\n        'content-fg': '#e5eaf0',\n        'content-hover-bg': '#161b22',\n        'content-hover-fg': '#e5eaf0'\n      }\n    }\n  }\n}\n\nconst id = 'Comfy.ColorPalette'\nconst idCustomColorPalettes = 'Comfy.CustomColorPalettes'\nconst defaultColorPaletteId = 'dark'\nconst els: { select: HTMLSelectElement | null } = {\n  select: null\n}\n// const ctxMenu = LiteGraph.ContextMenu;\napp.registerExtension({\n  name: id,\n  init() {\n    /**\n     * Changes the background color of the canvas.\n     *\n     * @method updateBackground\n     * @param {image} String\n     * @param {clearBackgroundColor} String\n     */\n    // @ts-expect-error\n    LGraphCanvas.prototype.updateBackground = function (\n      image,\n      clearBackgroundColor\n    ) {\n      this._bg_img = new Image()\n      this._bg_img.name = image\n      this._bg_img.src = image\n      this._bg_img.onload = () => {\n        this.draw(true, true)\n      }\n      this.background_image = image\n\n      this.clear_background = true\n      this.clear_background_color = clearBackgroundColor\n      this._pattern = null\n    }\n  },\n  addCustomNodeDefs(node_defs) {\n    const sortObjectKeys = (unordered) => {\n      return Object.keys(unordered)\n        .sort()\n        .reduce((obj, key) => {\n          obj[key] = unordered[key]\n          return obj\n        }, {})\n    }\n\n    function getSlotTypes() {\n      var types = []\n\n      const defs = node_defs\n      for (const nodeId in defs) {\n        const nodeData = defs[nodeId]\n\n        var inputs = nodeData['input']['required']\n        if (nodeData['input']['optional'] !== undefined) {\n          inputs = Object.assign(\n            {},\n            nodeData['input']['required'],\n            nodeData['input']['optional']\n          )\n        }\n\n        for (const inputName in inputs) {\n          const inputData = inputs[inputName]\n          const type = inputData[0]\n\n          if (!Array.isArray(type)) {\n            types.push(type)\n          }\n        }\n\n        for (const o in nodeData['output']) {\n          const output = nodeData['output'][o]\n          types.push(output)\n        }\n      }\n\n      return types\n    }\n\n    function completeColorPalette(colorPalette) {\n      var types = getSlotTypes()\n\n      for (const type of types) {\n        if (!colorPalette.colors.node_slot[type]) {\n          colorPalette.colors.node_slot[type] = ''\n        }\n      }\n\n      colorPalette.colors.node_slot = sortObjectKeys(\n        colorPalette.colors.node_slot\n      )\n\n      return colorPalette\n    }\n\n    const getColorPaletteTemplate = async () => {\n      let colorPalette = {\n        id: 'my_color_palette_unique_id',\n        name: 'My Color Palette',\n        colors: {\n          node_slot: {},\n          litegraph_base: {},\n          comfy_base: {}\n        }\n      }\n\n      // Copy over missing keys from default color palette\n      const defaultColorPalette = colorPalettes[defaultColorPaletteId]\n      for (const key in defaultColorPalette.colors.litegraph_base) {\n        if (!colorPalette.colors.litegraph_base[key]) {\n          colorPalette.colors.litegraph_base[key] = ''\n        }\n      }\n      for (const key in defaultColorPalette.colors.comfy_base) {\n        if (!colorPalette.colors.comfy_base[key]) {\n          colorPalette.colors.comfy_base[key] = ''\n        }\n      }\n\n      return completeColorPalette(colorPalette)\n    }\n\n    const getCustomColorPalettes = (): ColorPalettes => {\n      return app.ui.settings.getSettingValue(idCustomColorPalettes, {})\n    }\n\n    const setCustomColorPalettes = (customColorPalettes: ColorPalettes) => {\n      return app.ui.settings.setSettingValue(\n        idCustomColorPalettes,\n        customColorPalettes\n      )\n    }\n\n    const addCustomColorPalette = async (colorPalette) => {\n      if (typeof colorPalette !== 'object') {\n        alert('Invalid color palette.')\n        return\n      }\n\n      if (!colorPalette.id) {\n        alert('Color palette missing id.')\n        return\n      }\n\n      if (!colorPalette.name) {\n        alert('Color palette missing name.')\n        return\n      }\n\n      if (!colorPalette.colors) {\n        alert('Color palette missing colors.')\n        return\n      }\n\n      if (\n        colorPalette.colors.node_slot &&\n        typeof colorPalette.colors.node_slot !== 'object'\n      ) {\n        alert('Invalid color palette colors.node_slot.')\n        return\n      }\n\n      const customColorPalettes = getCustomColorPalettes()\n      customColorPalettes[colorPalette.id] = colorPalette\n      setCustomColorPalettes(customColorPalettes)\n\n      for (const option of els.select.childNodes) {\n        if (\n          (option as HTMLOptionElement).value ===\n          'custom_' + colorPalette.id\n        ) {\n          els.select.removeChild(option)\n        }\n      }\n\n      els.select.append(\n        $el('option', {\n          textContent: colorPalette.name + ' (custom)',\n          value: 'custom_' + colorPalette.id,\n          selected: true\n        })\n      )\n\n      setColorPalette('custom_' + colorPalette.id)\n      await loadColorPalette(colorPalette)\n    }\n\n    const deleteCustomColorPalette = async (colorPaletteId) => {\n      const customColorPalettes = getCustomColorPalettes()\n      delete customColorPalettes[colorPaletteId]\n      setCustomColorPalettes(customColorPalettes)\n\n      for (const opt of els.select.childNodes) {\n        const option = opt as HTMLOptionElement\n        if (option.value === defaultColorPaletteId) {\n          option.selected = true\n        }\n\n        if (option.value === 'custom_' + colorPaletteId) {\n          els.select.removeChild(option)\n        }\n      }\n\n      setColorPalette(defaultColorPaletteId)\n      await loadColorPalette(getColorPalette())\n    }\n\n    const loadColorPalette = async (colorPalette: Palette) => {\n      colorPalette = await completeColorPalette(colorPalette)\n      if (colorPalette.colors) {\n        // Sets the colors of node slots and links\n        if (colorPalette.colors.node_slot) {\n          Object.assign(\n            // @ts-expect-error\n            app.canvas.default_connection_color_byType,\n            colorPalette.colors.node_slot\n          )\n          Object.assign(\n            LGraphCanvas.link_type_colors,\n            colorPalette.colors.node_slot\n          )\n        }\n        // Sets the colors of the LiteGraph objects\n        if (colorPalette.colors.litegraph_base) {\n          // Everything updates correctly in the loop, except the Node Title and Link Color for some reason\n          app.canvas.node_title_color =\n            colorPalette.colors.litegraph_base.NODE_TITLE_COLOR\n          app.canvas.default_link_color =\n            colorPalette.colors.litegraph_base.LINK_COLOR\n\n          for (const key in colorPalette.colors.litegraph_base) {\n            if (\n              colorPalette.colors.litegraph_base.hasOwnProperty(key) &&\n              LiteGraph.hasOwnProperty(key)\n            ) {\n              LiteGraph[key] = colorPalette.colors.litegraph_base[key]\n            }\n          }\n        }\n        // Sets the color of ComfyUI elements\n        if (colorPalette.colors.comfy_base) {\n          const rootStyle = document.documentElement.style\n          for (const key in colorPalette.colors.comfy_base) {\n            rootStyle.setProperty(\n              '--' + key,\n              colorPalette.colors.comfy_base[key]\n            )\n          }\n        }\n        app.canvas.draw(true, true)\n      }\n    }\n\n    const getColorPalette = (colorPaletteId?) => {\n      if (!colorPaletteId) {\n        colorPaletteId = app.ui.settings.getSettingValue(\n          id,\n          defaultColorPaletteId\n        )\n      }\n\n      if (colorPaletteId.startsWith('custom_')) {\n        colorPaletteId = colorPaletteId.substr(7)\n        let customColorPalettes = getCustomColorPalettes()\n        if (customColorPalettes[colorPaletteId]) {\n          return customColorPalettes[colorPaletteId]\n        }\n      }\n\n      return colorPalettes[colorPaletteId]\n    }\n\n    const setColorPalette = (colorPaletteId) => {\n      app.ui.settings.setSettingValue(id, colorPaletteId)\n    }\n\n    const fileInput = $el('input', {\n      type: 'file',\n      accept: '.json',\n      style: { display: 'none' },\n      parent: document.body,\n      onchange: () => {\n        const file = fileInput.files[0]\n        if (file.type === 'application/json' || file.name.endsWith('.json')) {\n          const reader = new FileReader()\n          reader.onload = async () => {\n            await addCustomColorPalette(JSON.parse(reader.result as string))\n          }\n          reader.readAsText(file)\n        }\n      }\n    }) as HTMLInputElement\n\n    app.ui.settings.addSetting({\n      id,\n      name: 'Color Palette',\n      type: (name, setter, value) => {\n        const options = [\n          ...Object.values(colorPalettes).map((c) =>\n            $el('option', {\n              textContent: c.name,\n              value: c.id,\n              selected: c.id === value\n            })\n          ),\n          ...Object.values(getCustomColorPalettes()).map((c) =>\n            $el('option', {\n              textContent: `${c.name} (custom)`,\n              value: `custom_${c.id}`,\n              selected: `custom_${c.id}` === value\n            })\n          )\n        ]\n\n        els.select = $el(\n          'select',\n          {\n            style: {\n              marginBottom: '0.15rem',\n              width: '100%'\n            },\n            onchange: (e) => {\n              setter(e.target.value)\n            }\n          },\n          options\n        ) as HTMLSelectElement\n\n        return $el('tr', [\n          $el('td', [\n            $el('label', {\n              for: id.replaceAll('.', '-'),\n              textContent: 'Color palette'\n            })\n          ]),\n          $el('td', [\n            els.select,\n            $el(\n              'div',\n              {\n                style: {\n                  display: 'grid',\n                  gap: '4px',\n                  gridAutoFlow: 'column'\n                }\n              },\n              [\n                $el('input', {\n                  type: 'button',\n                  value: 'Export',\n                  onclick: async () => {\n                    const colorPaletteId = app.ui.settings.getSettingValue(\n                      id,\n                      defaultColorPaletteId\n                    )\n                    const colorPalette = await completeColorPalette(\n                      getColorPalette(colorPaletteId)\n                    )\n                    const json = JSON.stringify(colorPalette, null, 2) // convert the data to a JSON string\n                    const blob = new Blob([json], { type: 'application/json' })\n                    const url = URL.createObjectURL(blob)\n                    const a = $el('a', {\n                      href: url,\n                      download: colorPaletteId + '.json',\n                      style: { display: 'none' },\n                      parent: document.body\n                    })\n                    a.click()\n                    setTimeout(function () {\n                      a.remove()\n                      window.URL.revokeObjectURL(url)\n                    }, 0)\n                  }\n                }),\n                $el('input', {\n                  type: 'button',\n                  value: 'Import',\n                  onclick: () => {\n                    fileInput.click()\n                  }\n                }),\n                $el('input', {\n                  type: 'button',\n                  value: 'Template',\n                  onclick: async () => {\n                    const colorPalette = await getColorPaletteTemplate()\n                    const json = JSON.stringify(colorPalette, null, 2) // convert the data to a JSON string\n                    const blob = new Blob([json], { type: 'application/json' })\n                    const url = URL.createObjectURL(blob)\n                    const a = $el('a', {\n                      href: url,\n                      download: 'color_palette.json',\n                      style: { display: 'none' },\n                      parent: document.body\n                    })\n                    a.click()\n                    setTimeout(function () {\n                      a.remove()\n                      window.URL.revokeObjectURL(url)\n                    }, 0)\n                  }\n                }),\n                $el('input', {\n                  type: 'button',\n                  value: 'Delete',\n                  onclick: async () => {\n                    let colorPaletteId = app.ui.settings.getSettingValue(\n                      id,\n                      defaultColorPaletteId\n                    )\n\n                    if (colorPalettes[colorPaletteId]) {\n                      alert('You cannot delete a built-in color palette.')\n                      return\n                    }\n\n                    if (colorPaletteId.startsWith('custom_')) {\n                      colorPaletteId = colorPaletteId.substr(7)\n                    }\n\n                    await deleteCustomColorPalette(colorPaletteId)\n                  }\n                })\n              ]\n            )\n          ])\n        ])\n      },\n      defaultValue: defaultColorPaletteId,\n      async onChange(value) {\n        if (!value) {\n          return\n        }\n\n        let palette = colorPalettes[value]\n        if (palette) {\n          await loadColorPalette(palette)\n        } else if (value.startsWith('custom_')) {\n          value = value.substr(7)\n          let customColorPalettes = getCustomColorPalettes()\n          if (customColorPalettes[value]) {\n            palette = customColorPalettes[value]\n            await loadColorPalette(customColorPalettes[value])\n          }\n        }\n\n        let { BACKGROUND_IMAGE, CLEAR_BACKGROUND_COLOR } =\n          palette.colors.litegraph_base\n        if (\n          BACKGROUND_IMAGE === undefined ||\n          CLEAR_BACKGROUND_COLOR === undefined\n        ) {\n          const base = colorPalettes['dark'].colors.litegraph_base\n          BACKGROUND_IMAGE = base.BACKGROUND_IMAGE\n          CLEAR_BACKGROUND_COLOR = base.CLEAR_BACKGROUND_COLOR\n        }\n        // @ts-expect-error\n        // litegraph.extensions.js\n        app.canvas.updateBackground(BACKGROUND_IMAGE, CLEAR_BACKGROUND_COLOR)\n      }\n    })\n  }\n})\n","import { LiteGraph, LGraphCanvas } from '@comfyorg/litegraph'\nimport { app } from '../../scripts/app'\n\n// Adds filtering to combo context menus\n\nconst ext = {\n  name: 'Comfy.ContextMenuFilter',\n  init() {\n    const ctxMenu = LiteGraph.ContextMenu\n    // @ts-expect-error\n    // TODO Very hacky way to modify Litegraph behaviour. Fix this later.\n    LiteGraph.ContextMenu = function (values, options) {\n      const ctx = ctxMenu.call(this, values, options)\n\n      // If we are a dark menu (only used for combo boxes) then add a filter input\n      if (options?.className === 'dark' && values?.length > 10) {\n        const filter = document.createElement('input')\n        filter.classList.add('comfy-context-menu-filter')\n        filter.placeholder = 'Filter list'\n        this.root.prepend(filter)\n\n        const items = Array.from(\n          this.root.querySelectorAll('.litemenu-entry')\n        ) as HTMLElement[]\n        let displayedItems = [...items]\n        let itemCount = displayedItems.length\n\n        // We must request an animation frame for the current node of the active canvas to update.\n        requestAnimationFrame(() => {\n          // @ts-expect-error\n          const currentNode = LGraphCanvas.active_canvas.current_node\n          const clickedComboValue = currentNode.widgets\n            ?.filter(\n              (w) =>\n                w.type === 'combo' && w.options.values.length === values.length\n            )\n            .find((w) =>\n              w.options.values.every((v, i) => v === values[i])\n            )?.value\n\n          let selectedIndex = clickedComboValue\n            ? values.findIndex((v) => v === clickedComboValue)\n            : 0\n          if (selectedIndex < 0) {\n            selectedIndex = 0\n          }\n          let selectedItem = displayedItems[selectedIndex]\n          updateSelected()\n\n          // Apply highlighting to the selected item\n          function updateSelected() {\n            selectedItem?.style.setProperty('background-color', '')\n            selectedItem?.style.setProperty('color', '')\n            selectedItem = displayedItems[selectedIndex]\n            selectedItem?.style.setProperty(\n              'background-color',\n              '#ccc',\n              'important'\n            )\n            selectedItem?.style.setProperty('color', '#000', 'important')\n          }\n\n          const positionList = () => {\n            const rect = this.root.getBoundingClientRect()\n\n            // If the top is off-screen then shift the element with scaling applied\n            if (rect.top < 0) {\n              const scale =\n                1 -\n                this.root.getBoundingClientRect().height /\n                  this.root.clientHeight\n              const shift = (this.root.clientHeight * scale) / 2\n              this.root.style.top = -shift + 'px'\n            }\n          }\n\n          // Arrow up/down to select items\n          filter.addEventListener('keydown', (event) => {\n            switch (event.key) {\n              case 'ArrowUp':\n                event.preventDefault()\n                if (selectedIndex === 0) {\n                  selectedIndex = itemCount - 1\n                } else {\n                  selectedIndex--\n                }\n                updateSelected()\n                break\n              case 'ArrowRight':\n                event.preventDefault()\n                selectedIndex = itemCount - 1\n                updateSelected()\n                break\n              case 'ArrowDown':\n                event.preventDefault()\n                if (selectedIndex === itemCount - 1) {\n                  selectedIndex = 0\n                } else {\n                  selectedIndex++\n                }\n                updateSelected()\n                break\n              case 'ArrowLeft':\n                event.preventDefault()\n                selectedIndex = 0\n                updateSelected()\n                break\n              case 'Enter':\n                selectedItem?.click()\n                break\n              case 'Escape':\n                this.close()\n                break\n            }\n          })\n\n          filter.addEventListener('input', () => {\n            // Hide all items that don't match our filter\n            const term = filter.value.toLocaleLowerCase()\n            // When filtering, recompute which items are visible for arrow up/down and maintain selection.\n            displayedItems = items.filter((item) => {\n              const isVisible =\n                !term || item.textContent.toLocaleLowerCase().includes(term)\n              item.style.display = isVisible ? 'block' : 'none'\n              return isVisible\n            })\n\n            selectedIndex = 0\n            if (displayedItems.includes(selectedItem)) {\n              selectedIndex = displayedItems.findIndex(\n                (d) => d === selectedItem\n              )\n            }\n            itemCount = displayedItems.length\n\n            updateSelected()\n\n            // If we have an event then we can try and position the list under the source\n            if (options.event) {\n              let top = options.event.clientY - 10\n\n              const bodyRect = document.body.getBoundingClientRect()\n              const rootRect = this.root.getBoundingClientRect()\n              if (\n                bodyRect.height &&\n                top > bodyRect.height - rootRect.height - 10\n              ) {\n                top = Math.max(0, bodyRect.height - rootRect.height - 10)\n              }\n\n              this.root.style.top = top + 'px'\n              positionList()\n            }\n          })\n\n          requestAnimationFrame(() => {\n            // Focus the filter box when opening\n            filter.focus()\n\n            positionList()\n          })\n        })\n      }\n\n      return ctx\n    }\n\n    LiteGraph.ContextMenu.prototype = ctxMenu.prototype\n  }\n}\n\napp.registerExtension(ext)\n","import { app } from '../../scripts/app'\n\n// Allows for simple dynamic prompt replacement\n// Inputs in the format {a|b} will have a random value of a or b chosen when the prompt is queued.\n\n/*\n * Strips C-style line and block comments from a string\n */\nfunction stripComments(str) {\n  return str.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, '')\n}\n\napp.registerExtension({\n  name: 'Comfy.DynamicPrompts',\n  nodeCreated(node) {\n    if (node.widgets) {\n      // Locate dynamic prompt text widgets\n      // Include any widgets with dynamicPrompts set to true, and customtext\n      const widgets = node.widgets.filter((n) => n.dynamicPrompts)\n      for (const widget of widgets) {\n        // Override the serialization of the value to resolve dynamic prompts for all widgets supporting it in this node\n        widget.serializeValue = (workflowNode, widgetIndex) => {\n          let prompt = stripComments(widget.value)\n          while (\n            prompt.replace('\\\\{', '').includes('{') &&\n            prompt.replace('\\\\}', '').includes('}')\n          ) {\n            const startIndex = prompt.replace('\\\\{', '00').indexOf('{')\n            const endIndex = prompt.replace('\\\\}', '00').indexOf('}')\n\n            const optionsString = prompt.substring(startIndex + 1, endIndex)\n            const options = optionsString.split('|')\n\n            const randomIndex = Math.floor(Math.random() * options.length)\n            const randomOption = options[randomIndex]\n\n            prompt =\n              prompt.substring(0, startIndex) +\n              randomOption +\n              prompt.substring(endIndex + 1)\n          }\n\n          // Overwrite the value in the serialized workflow pnginfo\n          if (workflowNode?.widgets_values)\n            workflowNode.widgets_values[widgetIndex] = prompt\n\n          return prompt\n        }\n      }\n    }\n  }\n})\n","import { app } from '../../scripts/app'\n\n// Allows you to edit the attention weight by holding ctrl (or cmd) and using the up/down arrow keys\n\napp.registerExtension({\n  name: 'Comfy.EditAttention',\n  init() {\n    const editAttentionDelta = app.ui.settings.addSetting({\n      id: 'Comfy.EditAttention.Delta',\n      name: 'Ctrl+up/down precision',\n      type: 'slider',\n      attrs: {\n        min: 0.01,\n        max: 0.5,\n        step: 0.01\n      },\n      defaultValue: 0.05\n    })\n\n    function incrementWeight(weight, delta) {\n      const floatWeight = parseFloat(weight)\n      if (isNaN(floatWeight)) return weight\n      const newWeight = floatWeight + delta\n      if (newWeight < 0) return '0'\n      return String(Number(newWeight.toFixed(10)))\n    }\n\n    function findNearestEnclosure(text, cursorPos) {\n      let start = cursorPos,\n        end = cursorPos\n      let openCount = 0,\n        closeCount = 0\n\n      // Find opening parenthesis before cursor\n      while (start >= 0) {\n        start--\n        if (text[start] === '(' && openCount === closeCount) break\n        if (text[start] === '(') openCount++\n        if (text[start] === ')') closeCount++\n      }\n      if (start < 0) return false\n\n      openCount = 0\n      closeCount = 0\n\n      // Find closing parenthesis after cursor\n      while (end < text.length) {\n        if (text[end] === ')' && openCount === closeCount) break\n        if (text[end] === '(') openCount++\n        if (text[end] === ')') closeCount++\n        end++\n      }\n      if (end === text.length) return false\n\n      return { start: start + 1, end: end }\n    }\n\n    function addWeightToParentheses(text) {\n      const parenRegex = /^\\((.*)\\)$/\n      const parenMatch = text.match(parenRegex)\n\n      const floatRegex = /:([+-]?(\\d*\\.)?\\d+([eE][+-]?\\d+)?)/\n      const floatMatch = text.match(floatRegex)\n\n      if (parenMatch && !floatMatch) {\n        return `(${parenMatch[1]}:1.0)`\n      } else {\n        return text\n      }\n    }\n\n    function editAttention(event) {\n      const inputField = event.composedPath()[0]\n      const delta = parseFloat(editAttentionDelta.value)\n\n      if (inputField.tagName !== 'TEXTAREA') return\n      if (!(event.key === 'ArrowUp' || event.key === 'ArrowDown')) return\n      if (!event.ctrlKey && !event.metaKey) return\n\n      event.preventDefault()\n\n      let start = inputField.selectionStart\n      let end = inputField.selectionEnd\n      let selectedText = inputField.value.substring(start, end)\n\n      // If there is no selection, attempt to find the nearest enclosure, or select the current word\n      if (!selectedText) {\n        const nearestEnclosure = findNearestEnclosure(inputField.value, start)\n        if (nearestEnclosure) {\n          start = nearestEnclosure.start\n          end = nearestEnclosure.end\n          selectedText = inputField.value.substring(start, end)\n        } else {\n          // Select the current word, find the start and end of the word\n          const delimiters = ' .,\\\\/!?%^*;:{}=-_`~()\\r\\n\\t'\n\n          while (\n            !delimiters.includes(inputField.value[start - 1]) &&\n            start > 0\n          ) {\n            start--\n          }\n\n          while (\n            !delimiters.includes(inputField.value[end]) &&\n            end < inputField.value.length\n          ) {\n            end++\n          }\n\n          selectedText = inputField.value.substring(start, end)\n          if (!selectedText) return\n        }\n      }\n\n      // If the selection ends with a space, remove it\n      if (selectedText[selectedText.length - 1] === ' ') {\n        selectedText = selectedText.substring(0, selectedText.length - 1)\n        end -= 1\n      }\n\n      // If there are parentheses left and right of the selection, select them\n      if (\n        inputField.value[start - 1] === '(' &&\n        inputField.value[end] === ')'\n      ) {\n        start -= 1\n        end += 1\n        selectedText = inputField.value.substring(start, end)\n      }\n\n      // If the selection is not enclosed in parentheses, add them\n      if (\n        selectedText[0] !== '(' ||\n        selectedText[selectedText.length - 1] !== ')'\n      ) {\n        selectedText = `(${selectedText})`\n      }\n\n      // If the selection does not have a weight, add a weight of 1.0\n      selectedText = addWeightToParentheses(selectedText)\n\n      // Increment the weight\n      const weightDelta = event.key === 'ArrowUp' ? delta : -delta\n      const updatedText = selectedText.replace(\n        /\\((.*):(\\d+(?:\\.\\d+)?)\\)/,\n        (match, text, weight) => {\n          weight = incrementWeight(weight, weightDelta)\n          if (weight == 1) {\n            return text\n          } else {\n            return `(${text}:${weight})`\n          }\n        }\n      )\n\n      inputField.setRangeText(updatedText, start, end, 'select')\n    }\n    window.addEventListener('keydown', editAttention)\n  }\n})\n","import { ComfyWidgets, addValueControlWidgets } from '../../scripts/widgets'\nimport { app } from '../../scripts/app'\nimport { applyTextReplacements } from '../../scripts/utils'\nimport { LiteGraph } from '@comfyorg/litegraph'\nimport type { LGraphNode, INodeInputSlot, IWidget } from '@comfyorg/litegraph'\n\nconst CONVERTED_TYPE = 'converted-widget'\nconst VALID_TYPES = ['STRING', 'combo', 'number', 'toggle', 'BOOLEAN']\nconst CONFIG = Symbol()\nconst GET_CONFIG = Symbol()\nconst TARGET = Symbol() // Used for reroutes to specify the real target widget\n\ninterface PrimitiveNode extends LGraphNode {}\n\nconst replacePropertyName = 'Run widget replace on values'\nclass PrimitiveNode {\n  controlValues: any[]\n  lastType: string\n  static category: string\n  constructor() {\n    this.addOutput('connect to widget input', '*')\n    this.serialize_widgets = true\n    this.isVirtualNode = true\n\n    if (!this.properties || !(replacePropertyName in this.properties)) {\n      this.addProperty(replacePropertyName, false, 'boolean')\n    }\n  }\n\n  applyToGraph(extraLinks = []) {\n    if (!this.outputs[0].links?.length) return\n\n    function get_links(node) {\n      let links = []\n      for (const l of node.outputs[0].links) {\n        const linkInfo = app.graph.links[l]\n        const n = node.graph.getNodeById(linkInfo.target_id)\n        if (n.type == 'Reroute') {\n          links = links.concat(get_links(n))\n        } else {\n          links.push(l)\n        }\n      }\n      return links\n    }\n\n    let links = [\n      ...get_links(this).map((l) => app.graph.links[l]),\n      ...extraLinks\n    ]\n    let v = this.widgets?.[0].value\n    if (v && this.properties[replacePropertyName]) {\n      v = applyTextReplacements(app, v)\n    }\n\n    // For each output link copy our value over the original widget value\n    for (const linkInfo of links) {\n      const node = this.graph.getNodeById(linkInfo.target_id)\n      const input = node.inputs[linkInfo.target_slot]\n      let widget\n      if (input.widget[TARGET]) {\n        widget = input.widget[TARGET]\n      } else {\n        const widgetName = (input.widget as { name: string }).name\n        if (widgetName) {\n          widget = node.widgets.find((w) => w.name === widgetName)\n        }\n      }\n\n      if (widget) {\n        widget.value = v\n        if (widget.callback) {\n          widget.callback(\n            widget.value,\n            app.canvas,\n            node,\n            app.canvas.graph_mouse,\n            {}\n          )\n        }\n      }\n    }\n  }\n\n  refreshComboInNode() {\n    const widget = this.widgets?.[0]\n    if (widget?.type === 'combo') {\n      widget.options.values = this.outputs[0].widget[GET_CONFIG]()[0]\n\n      if (!widget.options.values.includes(widget.value)) {\n        widget.value = widget.options.values[0]\n        ;(widget.callback as Function)(widget.value)\n      }\n    }\n  }\n\n  onAfterGraphConfigured() {\n    if (this.outputs[0].links?.length && !this.widgets?.length) {\n      // TODO: Review this check\n      // @ts-expect-error\n      if (!this.#onFirstConnection()) return\n\n      // Populate widget values from config data\n      if (this.widgets) {\n        for (let i = 0; i < this.widgets_values.length; i++) {\n          const w = this.widgets[i]\n          if (w) {\n            w.value = this.widgets_values[i]\n          }\n        }\n      }\n\n      // Merge values if required\n      this.#mergeWidgetConfig()\n    }\n  }\n\n  onConnectionsChange(_, index, connected) {\n    if (app.configuringGraph) {\n      // Dont run while the graph is still setting up\n      return\n    }\n\n    const links = this.outputs[0].links\n    if (connected) {\n      if (links?.length && !this.widgets?.length) {\n        this.#onFirstConnection()\n      }\n    } else {\n      // We may have removed a link that caused the constraints to change\n      this.#mergeWidgetConfig()\n\n      if (!links?.length) {\n        this.onLastDisconnect()\n      }\n    }\n  }\n\n  onConnectOutput(slot, type, input, target_node, target_slot) {\n    // Fires before the link is made allowing us to reject it if it isn't valid\n    // No widget, we cant connect\n    if (!input.widget) {\n      if (!(input.type in ComfyWidgets)) return false\n    }\n\n    if (this.outputs[slot].links?.length) {\n      const valid = this.#isValidConnection(input)\n      if (valid) {\n        // On connect of additional outputs, copy our value to their widget\n        this.applyToGraph([{ target_id: target_node.id, target_slot }])\n      }\n      return valid\n    }\n  }\n\n  #onFirstConnection(recreating?: boolean) {\n    // First connection can fire before the graph is ready on initial load so random things can be missing\n    if (!this.outputs[0].links) {\n      this.onLastDisconnect()\n      return\n    }\n    const linkId = this.outputs[0].links[0]\n    const link = this.graph.links[linkId]\n    if (!link) return\n\n    const theirNode = this.graph.getNodeById(link.target_id)\n    if (!theirNode || !theirNode.inputs) return\n\n    const input = theirNode.inputs[link.target_slot]\n    if (!input) return\n\n    let widget\n    if (!input.widget) {\n      if (!(input.type in ComfyWidgets)) return\n      widget = { name: input.name, [GET_CONFIG]: () => [input.type, {}] } //fake widget\n    } else {\n      widget = input.widget\n    }\n\n    const config = widget[GET_CONFIG]?.()\n    if (!config) return\n\n    const { type } = getWidgetType(config)\n    // Update our output to restrict to the widget type\n    this.outputs[0].type = type\n    this.outputs[0].name = type\n    this.outputs[0].widget = widget\n\n    this.#createWidget(\n      widget[CONFIG] ?? config,\n      theirNode,\n      widget.name,\n      recreating,\n      widget[TARGET]\n    )\n  }\n\n  #createWidget(inputData, node, widgetName, recreating, targetWidget) {\n    let type = inputData[0]\n\n    if (type instanceof Array) {\n      type = 'COMBO'\n    }\n\n    let widget\n    if (type in ComfyWidgets) {\n      widget = (ComfyWidgets[type](this, 'value', inputData, app) || {}).widget\n    } else {\n      widget = this.addWidget(type, 'value', null, () => {}, {})\n    }\n\n    if (targetWidget) {\n      widget.value = targetWidget.value\n    } else if (node?.widgets && widget) {\n      const theirWidget = node.widgets.find((w) => w.name === widgetName)\n      if (theirWidget) {\n        widget.value = theirWidget.value\n      }\n    }\n\n    if (\n      !inputData?.[1]?.control_after_generate &&\n      (widget.type === 'number' || widget.type === 'combo')\n    ) {\n      let control_value = this.widgets_values?.[1]\n      if (!control_value) {\n        control_value = 'fixed'\n      }\n      addValueControlWidgets(\n        this,\n        widget,\n        control_value as string,\n        undefined,\n        inputData\n      )\n      let filter = this.widgets_values?.[2]\n      if (filter && this.widgets.length === 3) {\n        this.widgets[2].value = filter\n      }\n    }\n\n    // Restore any saved control values\n    const controlValues = this.controlValues\n    if (\n      this.lastType === this.widgets[0].type &&\n      controlValues?.length === this.widgets.length - 1\n    ) {\n      for (let i = 0; i < controlValues.length; i++) {\n        this.widgets[i + 1].value = controlValues[i]\n      }\n    }\n\n    // When our value changes, update other widgets to reflect our changes\n    // e.g. so LoadImage shows correct image\n    const callback = widget.callback\n    const self = this\n    widget.callback = function () {\n      const r = callback ? callback.apply(this, arguments) : undefined\n      self.applyToGraph()\n      return r\n    }\n\n    if (!recreating) {\n      // Grow our node if required\n      const sz = this.computeSize()\n      if (this.size[0] < sz[0]) {\n        this.size[0] = sz[0]\n      }\n      if (this.size[1] < sz[1]) {\n        this.size[1] = sz[1]\n      }\n\n      requestAnimationFrame(() => {\n        if (this.onResize) {\n          this.onResize(this.size)\n        }\n      })\n    }\n  }\n\n  recreateWidget() {\n    const values = this.widgets?.map((w) => w.value)\n    this.#removeWidgets()\n    this.#onFirstConnection(true)\n    if (values?.length) {\n      for (let i = 0; i < this.widgets?.length; i++)\n        this.widgets[i].value = values[i]\n    }\n    return this.widgets?.[0]\n  }\n\n  #mergeWidgetConfig() {\n    // Merge widget configs if the node has multiple outputs\n    const output = this.outputs[0]\n    const links = output.links\n\n    const hasConfig = !!output.widget[CONFIG]\n    if (hasConfig) {\n      delete output.widget[CONFIG]\n    }\n\n    if (links?.length < 2 && hasConfig) {\n      // Copy the widget options from the source\n      if (links.length) {\n        this.recreateWidget()\n      }\n\n      return\n    }\n\n    const config1 = output.widget[GET_CONFIG]()\n    const isNumber = config1[0] === 'INT' || config1[0] === 'FLOAT'\n    if (!isNumber) return\n\n    for (const linkId of links) {\n      const link = app.graph.links[linkId]\n      if (!link) continue // Can be null when removing a node\n\n      const theirNode = app.graph.getNodeById(link.target_id)\n      const theirInput = theirNode.inputs[link.target_slot]\n\n      // Call is valid connection so it can merge the configs when validating\n      this.#isValidConnection(theirInput, hasConfig)\n    }\n  }\n\n  #isValidConnection(input: INodeInputSlot, forceUpdate?: boolean) {\n    // Only allow connections where the configs match\n    const output = this.outputs[0]\n    const config2 = input.widget[GET_CONFIG]()\n    return !!mergeIfValid.call(\n      this,\n      output,\n      config2,\n      forceUpdate,\n      this.recreateWidget\n    )\n  }\n\n  #removeWidgets() {\n    if (this.widgets) {\n      // Allow widgets to cleanup\n      for (const w of this.widgets) {\n        if (w.onRemove) {\n          w.onRemove()\n        }\n      }\n\n      // Temporarily store the current values in case the node is being recreated\n      // e.g. by group node conversion\n      this.controlValues = []\n      this.lastType = this.widgets[0]?.type\n      for (let i = 1; i < this.widgets.length; i++) {\n        this.controlValues.push(this.widgets[i].value)\n      }\n      setTimeout(() => {\n        delete this.lastType\n        delete this.controlValues\n      }, 15)\n      this.widgets.length = 0\n    }\n  }\n\n  onLastDisconnect() {\n    // We cant remove + re-add the output here as if you drag a link over the same link\n    // it removes, then re-adds, causing it to break\n    this.outputs[0].type = '*'\n    this.outputs[0].name = 'connect to widget input'\n    delete this.outputs[0].widget\n\n    this.#removeWidgets()\n  }\n}\n\nexport function getWidgetConfig(slot) {\n  return slot.widget[CONFIG] ?? slot.widget[GET_CONFIG]()\n}\n\nfunction getConfig(widgetName) {\n  const { nodeData } = this.constructor\n  return (\n    nodeData?.input?.required[widgetName] ??\n    nodeData?.input?.optional?.[widgetName]\n  )\n}\n\nfunction isConvertibleWidget(widget, config) {\n  return (\n    (VALID_TYPES.includes(widget.type) || VALID_TYPES.includes(config[0])) &&\n    !widget.options?.forceInput\n  )\n}\n\nfunction hideWidget(node, widget, suffix = '') {\n  if (widget.type?.startsWith(CONVERTED_TYPE)) return\n  widget.origType = widget.type\n  widget.origComputeSize = widget.computeSize\n  widget.origSerializeValue = widget.serializeValue\n  widget.computeSize = () => [0, -4] // -4 is due to the gap litegraph adds between widgets automatically\n  widget.type = CONVERTED_TYPE + suffix\n  widget.serializeValue = () => {\n    // Prevent serializing the widget if we have no input linked\n    if (!node.inputs) {\n      return undefined\n    }\n    let node_input = node.inputs.find((i) => i.widget?.name === widget.name)\n\n    if (!node_input || !node_input.link) {\n      return undefined\n    }\n    return widget.origSerializeValue\n      ? widget.origSerializeValue()\n      : widget.value\n  }\n\n  // Hide any linked widgets, e.g. seed+seedControl\n  if (widget.linkedWidgets) {\n    for (const w of widget.linkedWidgets) {\n      hideWidget(node, w, ':' + widget.name)\n    }\n  }\n}\n\nfunction showWidget(widget) {\n  widget.type = widget.origType\n  widget.computeSize = widget.origComputeSize\n  widget.serializeValue = widget.origSerializeValue\n\n  delete widget.origType\n  delete widget.origComputeSize\n  delete widget.origSerializeValue\n\n  // Hide any linked widgets, e.g. seed+seedControl\n  if (widget.linkedWidgets) {\n    for (const w of widget.linkedWidgets) {\n      showWidget(w)\n    }\n  }\n}\n\nfunction convertToInput(node, widget, config) {\n  hideWidget(node, widget)\n\n  const { type } = getWidgetType(config)\n\n  // Add input and store widget config for creating on primitive node\n  const sz = node.size\n  node.addInput(widget.name, type, {\n    widget: { name: widget.name, [GET_CONFIG]: () => config }\n  })\n\n  for (const widget of node.widgets) {\n    widget.last_y += LiteGraph.NODE_SLOT_HEIGHT\n  }\n\n  // Restore original size but grow if needed\n  node.setSize([Math.max(sz[0], node.size[0]), Math.max(sz[1], node.size[1])])\n}\n\nfunction convertToWidget(node, widget) {\n  showWidget(widget)\n  const sz = node.size\n  node.removeInput(node.inputs.findIndex((i) => i.widget?.name === widget.name))\n\n  for (const widget of node.widgets) {\n    widget.last_y -= LiteGraph.NODE_SLOT_HEIGHT\n  }\n\n  // Restore original size but grow if needed\n  node.setSize([Math.max(sz[0], node.size[0]), Math.max(sz[1], node.size[1])])\n}\n\nfunction getWidgetType(config) {\n  // Special handling for COMBO so we restrict links based on the entries\n  let type = config[0]\n  if (type instanceof Array) {\n    type = 'COMBO'\n  }\n  return { type }\n}\n\nfunction isValidCombo(combo, obj) {\n  // New input isnt a combo\n  if (!(obj instanceof Array)) {\n    console.log(`connection rejected: tried to connect combo to ${obj}`)\n    return false\n  }\n  // New input combo has a different size\n  if (combo.length !== obj.length) {\n    console.log(`connection rejected: combo lists dont match`)\n    return false\n  }\n  // New input combo has different elements\n  if (combo.find((v, i) => obj[i] !== v)) {\n    console.log(`connection rejected: combo lists dont match`)\n    return false\n  }\n\n  return true\n}\n\nfunction isPrimitiveNode(node: LGraphNode): node is PrimitiveNode {\n  return node.type === 'PrimitiveNode'\n}\n\nexport function setWidgetConfig(slot, config, target?: IWidget) {\n  if (!slot.widget) return\n  if (config) {\n    slot.widget[GET_CONFIG] = () => config\n    slot.widget[TARGET] = target\n  } else {\n    delete slot.widget\n  }\n\n  if (slot.link) {\n    const link = app.graph.links[slot.link]\n    if (link) {\n      const originNode = app.graph.getNodeById(link.origin_id)\n      if (isPrimitiveNode(originNode)) {\n        if (config) {\n          originNode.recreateWidget()\n        } else if (!app.configuringGraph) {\n          originNode.disconnectOutput(0)\n          originNode.onLastDisconnect()\n        }\n      }\n    }\n  }\n}\n\nexport function mergeIfValid(\n  output,\n  config2,\n  forceUpdate?: boolean,\n  recreateWidget?: () => void,\n  config1?: unknown\n) {\n  if (!config1) {\n    config1 = output.widget[CONFIG] ?? output.widget[GET_CONFIG]()\n  }\n\n  if (config1[0] instanceof Array) {\n    if (!isValidCombo(config1[0], config2[0])) return\n  } else if (config1[0] !== config2[0]) {\n    // Types dont match\n    console.log(`connection rejected: types dont match`, config1[0], config2[0])\n    return\n  }\n\n  const keys = new Set([\n    ...Object.keys(config1[1] ?? {}),\n    ...Object.keys(config2[1] ?? {})\n  ])\n\n  let customConfig\n  const getCustomConfig = () => {\n    if (!customConfig) {\n      if (typeof structuredClone === 'undefined') {\n        customConfig = JSON.parse(JSON.stringify(config1[1] ?? {}))\n      } else {\n        customConfig = structuredClone(config1[1] ?? {})\n      }\n    }\n    return customConfig\n  }\n\n  const isNumber = config1[0] === 'INT' || config1[0] === 'FLOAT'\n  for (const k of keys.values()) {\n    if (\n      k !== 'default' &&\n      k !== 'forceInput' &&\n      k !== 'defaultInput' &&\n      k !== 'control_after_generate' &&\n      k !== 'multiline' &&\n      k !== 'tooltip'\n    ) {\n      let v1 = config1[1][k]\n      let v2 = config2[1]?.[k]\n\n      if (v1 === v2 || (!v1 && !v2)) continue\n\n      if (isNumber) {\n        if (k === 'min') {\n          const theirMax = config2[1]?.['max']\n          if (theirMax != null && v1 > theirMax) {\n            console.log('connection rejected: min > max', v1, theirMax)\n            return\n          }\n          getCustomConfig()[k] =\n            v1 == null ? v2 : v2 == null ? v1 : Math.max(v1, v2)\n          continue\n        } else if (k === 'max') {\n          const theirMin = config2[1]?.['min']\n          if (theirMin != null && v1 < theirMin) {\n            console.log('connection rejected: max < min', v1, theirMin)\n            return\n          }\n          getCustomConfig()[k] =\n            v1 == null ? v2 : v2 == null ? v1 : Math.min(v1, v2)\n          continue\n        } else if (k === 'step') {\n          let step\n          if (v1 == null) {\n            // No current step\n            step = v2\n          } else if (v2 == null) {\n            // No new step\n            step = v1\n          } else {\n            if (v1 < v2) {\n              // Ensure v1 is larger for the mod\n              const a = v2\n              v2 = v1\n              v1 = a\n            }\n            if (v1 % v2) {\n              console.log(\n                'connection rejected: steps not divisible',\n                'current:',\n                v1,\n                'new:',\n                v2\n              )\n              return\n            }\n\n            step = v1\n          }\n\n          getCustomConfig()[k] = step\n          continue\n        }\n      }\n\n      console.log(`connection rejected: config ${k} values dont match`, v1, v2)\n      return\n    }\n  }\n\n  if (customConfig || forceUpdate) {\n    if (customConfig) {\n      output.widget[CONFIG] = [config1[0], customConfig]\n    }\n\n    const widget = recreateWidget?.call(this)\n    // When deleting a node this can be null\n    if (widget) {\n      const min = widget.options.min\n      const max = widget.options.max\n      if (min != null && widget.value < min) widget.value = min\n      if (max != null && widget.value > max) widget.value = max\n      widget.callback(widget.value)\n    }\n  }\n\n  return { customConfig }\n}\n\nlet useConversionSubmenusSetting\napp.registerExtension({\n  name: 'Comfy.WidgetInputs',\n  init() {\n    useConversionSubmenusSetting = app.ui.settings.addSetting({\n      id: 'Comfy.NodeInputConversionSubmenus',\n      name: 'Node widget/input conversion sub-menus',\n      tooltip:\n        'In the node context menu, place the entries that convert between input/widget in sub-menus.',\n      type: 'boolean',\n      defaultValue: true\n    })\n  },\n  async beforeRegisterNodeDef(nodeType, nodeData, app) {\n    // Add menu options to convert to/from widgets\n    const origGetExtraMenuOptions = nodeType.prototype.getExtraMenuOptions\n    nodeType.prototype.convertWidgetToInput = function (widget) {\n      const config = getConfig.call(this, widget.name) ?? [\n        widget.type,\n        widget.options || {}\n      ]\n      if (!isConvertibleWidget(widget, config)) return false\n      convertToInput(this, widget, config)\n      return true\n    }\n    nodeType.prototype.getExtraMenuOptions = function (_, options) {\n      const r = origGetExtraMenuOptions\n        ? origGetExtraMenuOptions.apply(this, arguments)\n        : undefined\n\n      if (this.widgets) {\n        let toInput = []\n        let toWidget = []\n        for (const w of this.widgets) {\n          if (w.options?.forceInput) {\n            continue\n          }\n          if (w.type === CONVERTED_TYPE) {\n            toWidget.push({\n              content: `Convert ${w.name} to widget`,\n              callback: () => convertToWidget(this, w)\n            })\n          } else {\n            const config = getConfig.call(this, w.name) ?? [\n              w.type,\n              w.options || {}\n            ]\n            if (isConvertibleWidget(w, config)) {\n              toInput.push({\n                content: `Convert ${w.name} to input`,\n                callback: () => convertToInput(this, w, config)\n              })\n            }\n          }\n        }\n\n        //Convert.. main menu\n        if (toInput.length) {\n          if (useConversionSubmenusSetting.value) {\n            options.push({\n              content: 'Convert Widget to Input',\n              submenu: {\n                options: toInput\n              }\n            })\n          } else {\n            options.push(...toInput, null)\n          }\n        }\n        if (toWidget.length) {\n          if (useConversionSubmenusSetting.value) {\n            options.push({\n              content: 'Convert Input to Widget',\n              submenu: {\n                options: toWidget\n              }\n            })\n          } else {\n            options.push(...toWidget, null)\n          }\n        }\n      }\n\n      return r\n    }\n\n    nodeType.prototype.onGraphConfigured = function () {\n      if (!this.inputs) return\n\n      for (const input of this.inputs) {\n        if (input.widget) {\n          if (!input.widget[GET_CONFIG]) {\n            input.widget[GET_CONFIG] = () =>\n              getConfig.call(this, input.widget.name)\n          }\n\n          // Cleanup old widget config\n          if (input.widget.config) {\n            if (input.widget.config[0] instanceof Array) {\n              // If we are an old converted combo then replace the input type and the stored link data\n              input.type = 'COMBO'\n\n              const link = app.graph.links[input.link]\n              if (link) {\n                link.type = input.type\n              }\n            }\n            delete input.widget.config\n          }\n\n          const w = this.widgets.find((w) => w.name === input.widget.name)\n          if (w) {\n            hideWidget(this, w)\n          } else {\n            convertToWidget(this, input)\n          }\n        }\n      }\n    }\n\n    const origOnNodeCreated = nodeType.prototype.onNodeCreated\n    nodeType.prototype.onNodeCreated = function () {\n      const r = origOnNodeCreated ? origOnNodeCreated.apply(this) : undefined\n\n      // When node is created, convert any force/default inputs\n      if (!app.configuringGraph && this.widgets) {\n        for (const w of this.widgets) {\n          if (w?.options?.forceInput || w?.options?.defaultInput) {\n            const config = getConfig.call(this, w.name) ?? [\n              w.type,\n              w.options || {}\n            ]\n            convertToInput(this, w, config)\n          }\n        }\n      }\n\n      return r\n    }\n\n    const origOnConfigure = nodeType.prototype.onConfigure\n    nodeType.prototype.onConfigure = function () {\n      const r = origOnConfigure\n        ? origOnConfigure.apply(this, arguments)\n        : undefined\n      if (!app.configuringGraph && this.inputs) {\n        // On copy + paste of nodes, ensure that widget configs are set up\n        for (const input of this.inputs) {\n          if (input.widget && !input.widget[GET_CONFIG]) {\n            input.widget[GET_CONFIG] = () =>\n              getConfig.call(this, input.widget.name)\n            const w = this.widgets.find((w) => w.name === input.widget.name)\n            if (w) {\n              hideWidget(this, w)\n            }\n          }\n        }\n      }\n\n      return r\n    }\n\n    function isNodeAtPos(pos) {\n      for (const n of app.graph._nodes) {\n        if (n.pos[0] === pos[0] && n.pos[1] === pos[1]) {\n          return true\n        }\n      }\n      return false\n    }\n\n    // Double click a widget input to automatically attach a primitive\n    const origOnInputDblClick = nodeType.prototype.onInputDblClick\n    const ignoreDblClick = Symbol()\n    nodeType.prototype.onInputDblClick = function (slot) {\n      const r = origOnInputDblClick\n        ? origOnInputDblClick.apply(this, arguments)\n        : undefined\n\n      const input = this.inputs[slot]\n      if (!input.widget || !input[ignoreDblClick]) {\n        // Not a widget input or already handled input\n        if (\n          !(input.type in ComfyWidgets) &&\n          !(input.widget[GET_CONFIG]?.()?.[0] instanceof Array)\n        ) {\n          return r //also Not a ComfyWidgets input or combo (do nothing)\n        }\n      }\n\n      // Create a primitive node\n      const node = LiteGraph.createNode('PrimitiveNode')\n      app.graph.add(node)\n\n      // Calculate a position that wont directly overlap another node\n      const pos: [number, number] = [\n        this.pos[0] - node.size[0] - 30,\n        this.pos[1]\n      ]\n      while (isNodeAtPos(pos)) {\n        pos[1] += LiteGraph.NODE_TITLE_HEIGHT\n      }\n\n      node.pos = pos\n      node.connect(0, this, slot)\n      node.title = input.name\n\n      // Prevent adding duplicates due to triple clicking\n      input[ignoreDblClick] = true\n      setTimeout(() => {\n        delete input[ignoreDblClick]\n      }, 300)\n\n      return r\n    }\n\n    // Prevent connecting COMBO lists to converted inputs that dont match types\n    const onConnectInput = nodeType.prototype.onConnectInput\n    nodeType.prototype.onConnectInput = function (\n      targetSlot,\n      type,\n      output,\n      originNode,\n      originSlot\n    ) {\n      const v = onConnectInput?.(this, arguments)\n      // Not a combo, ignore\n      if (type !== 'COMBO') return v\n      // Primitive output, allow that to handle\n      if (originNode.outputs[originSlot].widget) return v\n\n      // Ensure target is also a combo\n      const targetCombo = this.inputs[targetSlot].widget?.[GET_CONFIG]?.()?.[0]\n      if (!targetCombo || !(targetCombo instanceof Array)) return v\n\n      // Check they match\n      const originConfig =\n        originNode.constructor?.nodeData?.output?.[originSlot]\n      if (!originConfig || !isValidCombo(targetCombo, originConfig)) {\n        return false\n      }\n\n      return v\n    }\n  },\n  registerCustomNodes() {\n    LiteGraph.registerNodeType(\n      'PrimitiveNode',\n      Object.assign(PrimitiveNode, {\n        title: 'Primitive'\n      })\n    )\n    PrimitiveNode.category = 'utils'\n  }\n})\n","import { $el, ComfyDialog } from '../../scripts/ui'\nimport { DraggableList } from '../../scripts/ui/draggableList'\nimport { GroupNodeConfig, GroupNodeHandler } from './groupNode'\nimport './groupNodeManage.css'\nimport { app, type ComfyApp } from '../../scripts/app'\nimport {\n  LiteGraph,\n  type LGraphNode,\n  type LGraphNodeConstructor\n} from '@comfyorg/litegraph'\n\nconst ORDER: symbol = Symbol()\n\nfunction merge(target, source) {\n  if (typeof target === 'object' && typeof source === 'object') {\n    for (const key in source) {\n      const sv = source[key]\n      if (typeof sv === 'object') {\n        let tv = target[key]\n        if (!tv) tv = target[key] = {}\n        merge(tv, source[key])\n      } else {\n        target[key] = sv\n      }\n    }\n  }\n\n  return target\n}\n\nexport class ManageGroupDialog extends ComfyDialog<HTMLDialogElement> {\n  tabs: Record<\n    'Inputs' | 'Outputs' | 'Widgets',\n    { tab: HTMLAnchorElement; page: HTMLElement }\n  >\n  selectedNodeIndex: number | null | undefined\n  selectedTab: keyof ManageGroupDialog['tabs'] = 'Inputs'\n  selectedGroup: string | undefined\n  modifications: Record<\n    string,\n    Record<\n      string,\n      Record<\n        string,\n        { name?: string | undefined; visible?: boolean | undefined }\n      >\n    >\n  > = {}\n  nodeItems: any[]\n  app: ComfyApp\n  groupNodeType: LGraphNodeConstructor<LGraphNode>\n  groupNodeDef: any\n  groupData: any\n\n  innerNodesList: HTMLUListElement\n  widgetsPage: HTMLElement\n  inputsPage: HTMLElement\n  outputsPage: HTMLElement\n  draggable: any\n\n  get selectedNodeInnerIndex() {\n    return +this.nodeItems[this.selectedNodeIndex].dataset.nodeindex\n  }\n\n  constructor(app) {\n    super()\n    this.app = app\n    this.element = $el('dialog.comfy-group-manage', {\n      parent: document.body\n    }) as HTMLDialogElement\n  }\n\n  changeTab(tab) {\n    this.tabs[this.selectedTab].tab.classList.remove('active')\n    this.tabs[this.selectedTab].page.classList.remove('active')\n    this.tabs[tab].tab.classList.add('active')\n    this.tabs[tab].page.classList.add('active')\n    this.selectedTab = tab\n  }\n\n  changeNode(index, force?) {\n    if (!force && this.selectedNodeIndex === index) return\n\n    if (this.selectedNodeIndex != null) {\n      this.nodeItems[this.selectedNodeIndex].classList.remove('selected')\n    }\n    this.nodeItems[index].classList.add('selected')\n    this.selectedNodeIndex = index\n\n    if (!this.buildInputsPage() && this.selectedTab === 'Inputs') {\n      this.changeTab('Widgets')\n    }\n    if (!this.buildWidgetsPage() && this.selectedTab === 'Widgets') {\n      this.changeTab('Outputs')\n    }\n    if (!this.buildOutputsPage() && this.selectedTab === 'Outputs') {\n      this.changeTab('Inputs')\n    }\n\n    this.changeTab(this.selectedTab)\n  }\n\n  getGroupData() {\n    this.groupNodeType =\n      LiteGraph.registered_node_types['workflow/' + this.selectedGroup]\n    this.groupNodeDef = this.groupNodeType.nodeData\n    this.groupData = GroupNodeHandler.getGroupData(this.groupNodeType)\n  }\n\n  changeGroup(group, reset = true) {\n    this.selectedGroup = group\n    this.getGroupData()\n\n    const nodes = this.groupData.nodeData.nodes\n    this.nodeItems = nodes.map((n, i) =>\n      $el(\n        'li.draggable-item',\n        {\n          dataset: {\n            nodeindex: n.index + ''\n          },\n          onclick: () => {\n            this.changeNode(i)\n          }\n        },\n        [\n          $el('span.drag-handle'),\n          $el(\n            'div',\n            {\n              textContent: n.title ?? n.type\n            },\n            n.title\n              ? $el('span', {\n                  textContent: n.type\n                })\n              : []\n          )\n        ]\n      )\n    )\n\n    this.innerNodesList.replaceChildren(...this.nodeItems)\n\n    if (reset) {\n      this.selectedNodeIndex = null\n      this.changeNode(0)\n    } else {\n      const items = this.draggable.getAllItems()\n      let index = items.findIndex((item) => item.classList.contains('selected'))\n      if (index === -1) index = this.selectedNodeIndex\n      this.changeNode(index, true)\n    }\n\n    const ordered = [...nodes]\n    this.draggable?.dispose()\n    this.draggable = new DraggableList(this.innerNodesList, 'li')\n    this.draggable.addEventListener(\n      'dragend',\n      ({ detail: { oldPosition, newPosition } }) => {\n        if (oldPosition === newPosition) return\n        ordered.splice(newPosition, 0, ordered.splice(oldPosition, 1)[0])\n        for (let i = 0; i < ordered.length; i++) {\n          this.storeModification({\n            nodeIndex: ordered[i].index,\n            section: ORDER,\n            prop: 'order',\n            value: i\n          })\n        }\n      }\n    )\n  }\n\n  storeModification(props: {\n    nodeIndex?: number\n    section: symbol\n    prop: string\n    value: any\n  }) {\n    const { nodeIndex, section, prop, value } = props\n    const groupMod = (this.modifications[this.selectedGroup] ??= {})\n    const nodesMod = (groupMod.nodes ??= {})\n    const nodeMod = (nodesMod[nodeIndex ?? this.selectedNodeInnerIndex] ??= {})\n    const typeMod = (nodeMod[section] ??= {})\n    if (typeof value === 'object') {\n      const objMod = (typeMod[prop] ??= {})\n      Object.assign(objMod, value)\n    } else {\n      typeMod[prop] = value\n    }\n  }\n\n  getEditElement(section, prop, value, placeholder, checked, checkable = true) {\n    if (value === placeholder) value = ''\n\n    const mods =\n      this.modifications[this.selectedGroup]?.nodes?.[\n        this.selectedNodeInnerIndex\n      ]?.[section]?.[prop]\n    if (mods) {\n      if (mods.name != null) {\n        value = mods.name\n      }\n      if (mods.visible != null) {\n        checked = mods.visible\n      }\n    }\n\n    return $el('div', [\n      $el('input', {\n        value,\n        placeholder,\n        type: 'text',\n        onchange: (e) => {\n          this.storeModification({\n            section,\n            prop,\n            value: { name: e.target.value }\n          })\n        }\n      }),\n      $el('label', { textContent: 'Visible' }, [\n        $el('input', {\n          type: 'checkbox',\n          checked,\n          disabled: !checkable,\n          onchange: (e) => {\n            this.storeModification({\n              section,\n              prop,\n              value: { visible: !!e.target.checked }\n            })\n          }\n        })\n      ])\n    ])\n  }\n\n  buildWidgetsPage() {\n    const widgets =\n      this.groupData.oldToNewWidgetMap[this.selectedNodeInnerIndex]\n    const items = Object.keys(widgets ?? {})\n    const type = app.graph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.input\n    this.widgetsPage.replaceChildren(\n      ...items.map((oldName) => {\n        return this.getEditElement(\n          'input',\n          oldName,\n          widgets[oldName],\n          oldName,\n          config?.[oldName]?.visible !== false\n        )\n      })\n    )\n    return !!items.length\n  }\n\n  buildInputsPage() {\n    const inputs = this.groupData.nodeInputs[this.selectedNodeInnerIndex]\n    const items = Object.keys(inputs ?? {})\n    const type = app.graph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.input\n    this.inputsPage.replaceChildren(\n      ...items\n        .map((oldName) => {\n          let value = inputs[oldName]\n          if (!value) {\n            return\n          }\n\n          return this.getEditElement(\n            'input',\n            oldName,\n            value,\n            oldName,\n            config?.[oldName]?.visible !== false\n          )\n        })\n        .filter(Boolean)\n    )\n    return !!items.length\n  }\n\n  buildOutputsPage() {\n    const nodes = this.groupData.nodeData.nodes\n    const innerNodeDef = this.groupData.getNodeDef(\n      nodes[this.selectedNodeInnerIndex]\n    )\n    const outputs = innerNodeDef?.output ?? []\n    const groupOutputs =\n      this.groupData.oldToNewOutputMap[this.selectedNodeInnerIndex]\n\n    const type = app.graph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.output\n    const node = this.groupData.nodeData.nodes[this.selectedNodeInnerIndex]\n    const checkable = node.type !== 'PrimitiveNode'\n    this.outputsPage.replaceChildren(\n      ...outputs\n        .map((type, slot) => {\n          const groupOutputIndex = groupOutputs?.[slot]\n          const oldName = innerNodeDef.output_name?.[slot] ?? type\n          let value = config?.[slot]?.name\n          const visible = config?.[slot]?.visible || groupOutputIndex != null\n          if (!value || value === oldName) {\n            value = ''\n          }\n          return this.getEditElement(\n            'output',\n            slot,\n            value,\n            oldName,\n            visible,\n            checkable\n          )\n        })\n        .filter(Boolean)\n    )\n    return !!outputs.length\n  }\n\n  show(type?) {\n    const groupNodes = Object.keys(app.graph.extra?.groupNodes ?? {}).sort(\n      (a, b) => a.localeCompare(b)\n    )\n\n    this.innerNodesList = $el(\n      'ul.comfy-group-manage-list-items'\n    ) as HTMLUListElement\n    this.widgetsPage = $el('section.comfy-group-manage-node-page')\n    this.inputsPage = $el('section.comfy-group-manage-node-page')\n    this.outputsPage = $el('section.comfy-group-manage-node-page')\n    const pages = $el('div', [\n      this.widgetsPage,\n      this.inputsPage,\n      this.outputsPage\n    ])\n\n    this.tabs = [\n      ['Inputs', this.inputsPage],\n      ['Widgets', this.widgetsPage],\n      ['Outputs', this.outputsPage]\n    ].reduce((p, [name, page]: [string, HTMLElement]) => {\n      p[name] = {\n        tab: $el('a', {\n          onclick: () => {\n            this.changeTab(name)\n          },\n          textContent: name\n        }),\n        page\n      }\n      return p\n    }, {}) as any\n\n    const outer = $el('div.comfy-group-manage-outer', [\n      $el('header', [\n        $el('h2', 'Group Nodes'),\n        $el(\n          'select',\n          {\n            onchange: (e) => {\n              this.changeGroup(e.target.value)\n            }\n          },\n          groupNodes.map((g) =>\n            $el('option', {\n              textContent: g,\n              selected: 'workflow/' + g === type,\n              value: g\n            })\n          )\n        )\n      ]),\n      $el('main', [\n        $el('section.comfy-group-manage-list', this.innerNodesList),\n        $el('section.comfy-group-manage-node', [\n          $el(\n            'header',\n            Object.values(this.tabs).map((t) => t.tab)\n          ),\n          pages\n        ])\n      ]),\n      $el('footer', [\n        $el(\n          'button.comfy-btn',\n          {\n            onclick: (e) => {\n              // @ts-expect-error\n              const node = app.graph._nodes.find(\n                (n) => n.type === 'workflow/' + this.selectedGroup\n              )\n              if (node) {\n                alert(\n                  'This group node is in use in the current workflow, please first remove these.'\n                )\n                return\n              }\n              if (\n                confirm(\n                  `Are you sure you want to remove the node: \"${this.selectedGroup}\"`\n                )\n              ) {\n                delete app.graph.extra.groupNodes[this.selectedGroup]\n                LiteGraph.unregisterNodeType('workflow/' + this.selectedGroup)\n              }\n              this.show()\n            }\n          },\n          'Delete Group Node'\n        ),\n        $el(\n          'button.comfy-btn',\n          {\n            onclick: async () => {\n              let nodesByType\n              let recreateNodes = []\n              const types = {}\n              for (const g in this.modifications) {\n                const type = app.graph.extra.groupNodes[g]\n                let config = (type.config ??= {})\n\n                let nodeMods = this.modifications[g]?.nodes\n                if (nodeMods) {\n                  const keys = Object.keys(nodeMods)\n                  if (nodeMods[keys[0]][ORDER]) {\n                    // If any node is reordered, they will all need sequencing\n                    const orderedNodes = []\n                    const orderedMods = {}\n                    const orderedConfig = {}\n\n                    for (const n of keys) {\n                      const order = nodeMods[n][ORDER].order\n                      orderedNodes[order] = type.nodes[+n]\n                      orderedMods[order] = nodeMods[n]\n                      orderedNodes[order].index = order\n                    }\n\n                    // Rewrite links\n                    for (const l of type.links) {\n                      if (l[0] != null) l[0] = type.nodes[l[0]].index\n                      if (l[2] != null) l[2] = type.nodes[l[2]].index\n                    }\n\n                    // Rewrite externals\n                    if (type.external) {\n                      for (const ext of type.external) {\n                        ext[0] = type.nodes[ext[0]]\n                      }\n                    }\n\n                    // Rewrite modifications\n                    for (const id of keys) {\n                      if (config[id]) {\n                        orderedConfig[type.nodes[id].index] = config[id]\n                      }\n                      delete config[id]\n                    }\n\n                    type.nodes = orderedNodes\n                    nodeMods = orderedMods\n                    type.config = config = orderedConfig\n                  }\n\n                  merge(config, nodeMods)\n                }\n\n                types[g] = type\n\n                if (!nodesByType) {\n                  // @ts-expect-error\n                  nodesByType = app.graph._nodes.reduce((p, n) => {\n                    p[n.type] ??= []\n                    p[n.type].push(n)\n                    return p\n                  }, {})\n                }\n\n                const nodes = nodesByType['workflow/' + g]\n                if (nodes) recreateNodes.push(...nodes)\n              }\n\n              await GroupNodeConfig.registerFromWorkflow(types, {})\n\n              for (const node of recreateNodes) {\n                node.recreate()\n              }\n\n              this.modifications = {}\n              this.app.graph.setDirtyCanvas(true, true)\n              this.changeGroup(this.selectedGroup, false)\n            }\n          },\n          'Save'\n        ),\n        $el(\n          'button.comfy-btn',\n          { onclick: () => this.element.close() },\n          'Close'\n        )\n      ])\n    ])\n\n    this.element.replaceChildren(outer)\n    this.changeGroup(\n      type ? groupNodes.find((g) => 'workflow/' + g === type) : groupNodes[0]\n    )\n    this.element.showModal()\n\n    this.element.addEventListener('close', () => {\n      this.draggable?.dispose()\n    })\n  }\n}\n","import { app } from '../../scripts/app'\nimport { api } from '../../scripts/api'\nimport { mergeIfValid } from './widgetInputs'\nimport { ManageGroupDialog } from './groupNodeManage'\nimport type { LGraphNode } from '@comfyorg/litegraph'\nimport { LGraphCanvas, LiteGraph } from '@comfyorg/litegraph'\n\nconst GROUP = Symbol()\n\nconst Workflow = {\n  InUse: {\n    Free: 0,\n    Registered: 1,\n    InWorkflow: 2\n  },\n  isInUseGroupNode(name) {\n    const id = `workflow/${name}`\n    // Check if lready registered/in use in this workflow\n    if (app.graph.extra?.groupNodes?.[name]) {\n      // @ts-expect-error\n      if (app.graph._nodes.find((n) => n.type === id)) {\n        return Workflow.InUse.InWorkflow\n      } else {\n        return Workflow.InUse.Registered\n      }\n    }\n    return Workflow.InUse.Free\n  },\n  storeGroupNode(name, data) {\n    let extra = app.graph.extra\n    if (!extra) app.graph.extra = extra = {}\n    let groupNodes = extra.groupNodes\n    if (!groupNodes) extra.groupNodes = groupNodes = {}\n    groupNodes[name] = data\n  }\n}\n\nclass GroupNodeBuilder {\n  nodes: LGraphNode[]\n  nodeData: any\n\n  constructor(nodes) {\n    this.nodes = nodes\n  }\n\n  build() {\n    const name = this.getName()\n    if (!name) return\n\n    // Sort the nodes so they are in execution order\n    // this allows for widgets to be in the correct order when reconstructing\n    this.sortNodes()\n\n    this.nodeData = this.getNodeData()\n    Workflow.storeGroupNode(name, this.nodeData)\n\n    return { name, nodeData: this.nodeData }\n  }\n\n  getName() {\n    const name = prompt('Enter group name')\n    if (!name) return\n    const used = Workflow.isInUseGroupNode(name)\n    switch (used) {\n      case Workflow.InUse.InWorkflow:\n        alert(\n          'An in use group node with this name already exists embedded in this workflow, please remove any instances or use a new name.'\n        )\n        return\n      case Workflow.InUse.Registered:\n        if (\n          !confirm(\n            'A group node with this name already exists embedded in this workflow, are you sure you want to overwrite it?'\n          )\n        ) {\n          return\n        }\n        break\n    }\n    return name\n  }\n\n  sortNodes() {\n    // Gets the builders nodes in graph execution order\n    const nodesInOrder = app.graph.computeExecutionOrder(false)\n    this.nodes = this.nodes\n      .map((node) => ({ index: nodesInOrder.indexOf(node), node }))\n      .sort((a, b) => a.index - b.index || a.node.id - b.node.id)\n      .map(({ node }) => node)\n  }\n\n  getNodeData() {\n    const storeLinkTypes = (config) => {\n      // Store link types for dynamically typed nodes e.g. reroutes\n      for (const link of config.links) {\n        const origin = app.graph.getNodeById(link[4])\n        const type = origin.outputs[link[1]].type\n        link.push(type)\n      }\n    }\n\n    const storeExternalLinks = (config) => {\n      // Store any external links to the group in the config so when rebuilding we add extra slots\n      config.external = []\n      for (let i = 0; i < this.nodes.length; i++) {\n        const node = this.nodes[i]\n        if (!node.outputs?.length) continue\n        for (let slot = 0; slot < node.outputs.length; slot++) {\n          let hasExternal = false\n          const output = node.outputs[slot]\n          let type = output.type\n          if (!output.links?.length) continue\n          for (const l of output.links) {\n            const link = app.graph.links[l]\n            if (!link) continue\n            if (type === '*') type = link.type\n\n            if (!app.canvas.selected_nodes[link.target_id]) {\n              hasExternal = true\n              break\n            }\n          }\n          if (hasExternal) {\n            config.external.push([i, slot, type])\n          }\n        }\n      }\n    }\n\n    // Use the built in copyToClipboard function to generate the node data we need\n    const backup = localStorage.getItem('litegrapheditor_clipboard')\n    try {\n      // @ts-expect-error\n      // TODO Figure out if copyToClipboard is really taking this param\n      app.canvas.copyToClipboard(this.nodes)\n      const config = JSON.parse(\n        localStorage.getItem('litegrapheditor_clipboard')\n      )\n\n      storeLinkTypes(config)\n      storeExternalLinks(config)\n\n      return config\n    } finally {\n      localStorage.setItem('litegrapheditor_clipboard', backup)\n    }\n  }\n}\n\nexport class GroupNodeConfig {\n  name: string\n  nodeData: any\n  inputCount: number\n  oldToNewOutputMap: {}\n  newToOldOutputMap: {}\n  oldToNewInputMap: {}\n  oldToNewWidgetMap: {}\n  newToOldWidgetMap: {}\n  primitiveDefs: {}\n  widgetToPrimitive: {}\n  primitiveToWidget: {}\n  nodeInputs: {}\n  outputVisibility: any[]\n  nodeDef: any\n  inputs: any[]\n  linksFrom: {}\n  linksTo: {}\n  externalFrom: {}\n\n  constructor(name, nodeData) {\n    this.name = name\n    this.nodeData = nodeData\n    this.getLinks()\n\n    this.inputCount = 0\n    this.oldToNewOutputMap = {}\n    this.newToOldOutputMap = {}\n    this.oldToNewInputMap = {}\n    this.oldToNewWidgetMap = {}\n    this.newToOldWidgetMap = {}\n    this.primitiveDefs = {}\n    this.widgetToPrimitive = {}\n    this.primitiveToWidget = {}\n    this.nodeInputs = {}\n    this.outputVisibility = []\n  }\n\n  async registerType(source = 'workflow') {\n    this.nodeDef = {\n      output: [],\n      output_name: [],\n      output_is_list: [],\n      output_is_hidden: [],\n      name: source + '/' + this.name,\n      display_name: this.name,\n      category: 'group nodes' + ('/' + source),\n      input: { required: {} },\n\n      [GROUP]: this\n    }\n\n    this.inputs = []\n    const seenInputs = {}\n    const seenOutputs = {}\n    for (let i = 0; i < this.nodeData.nodes.length; i++) {\n      const node = this.nodeData.nodes[i]\n      node.index = i\n      this.processNode(node, seenInputs, seenOutputs)\n    }\n\n    for (const p of this.#convertedToProcess) {\n      p()\n    }\n    this.#convertedToProcess = null\n    await app.registerNodeDef('workflow/' + this.name, this.nodeDef)\n  }\n\n  getLinks() {\n    this.linksFrom = {}\n    this.linksTo = {}\n    this.externalFrom = {}\n\n    // Extract links for easy lookup\n    for (const l of this.nodeData.links) {\n      const [sourceNodeId, sourceNodeSlot, targetNodeId, targetNodeSlot] = l\n\n      // Skip links outside the copy config\n      if (sourceNodeId == null) continue\n\n      if (!this.linksFrom[sourceNodeId]) {\n        this.linksFrom[sourceNodeId] = {}\n      }\n      if (!this.linksFrom[sourceNodeId][sourceNodeSlot]) {\n        this.linksFrom[sourceNodeId][sourceNodeSlot] = []\n      }\n      this.linksFrom[sourceNodeId][sourceNodeSlot].push(l)\n\n      if (!this.linksTo[targetNodeId]) {\n        this.linksTo[targetNodeId] = {}\n      }\n      this.linksTo[targetNodeId][targetNodeSlot] = l\n    }\n\n    if (this.nodeData.external) {\n      for (const ext of this.nodeData.external) {\n        if (!this.externalFrom[ext[0]]) {\n          this.externalFrom[ext[0]] = { [ext[1]]: ext[2] }\n        } else {\n          this.externalFrom[ext[0]][ext[1]] = ext[2]\n        }\n      }\n    }\n  }\n\n  processNode(node, seenInputs, seenOutputs) {\n    const def = this.getNodeDef(node)\n    if (!def) return\n\n    const inputs = { ...def.input?.required, ...def.input?.optional }\n\n    this.inputs.push(this.processNodeInputs(node, seenInputs, inputs))\n    if (def.output?.length) this.processNodeOutputs(node, seenOutputs, def)\n  }\n\n  getNodeDef(node) {\n    const def = globalDefs[node.type]\n    if (def) return def\n\n    const linksFrom = this.linksFrom[node.index]\n    if (node.type === 'PrimitiveNode') {\n      // Skip as its not linked\n      if (!linksFrom) return\n\n      let type = linksFrom['0'][0][5]\n      if (type === 'COMBO') {\n        // Use the array items\n        const source = node.outputs[0].widget.name\n        const fromTypeName = this.nodeData.nodes[linksFrom['0'][0][2]].type\n        const fromType = globalDefs[fromTypeName]\n        const input =\n          fromType.input.required[source] ?? fromType.input.optional[source]\n        type = input[0]\n      }\n\n      const def = (this.primitiveDefs[node.index] = {\n        input: {\n          required: {\n            value: [type, {}]\n          }\n        },\n        output: [type],\n        output_name: [],\n        output_is_list: []\n      })\n      return def\n    } else if (node.type === 'Reroute') {\n      const linksTo = this.linksTo[node.index]\n      if (linksTo && linksFrom && !this.externalFrom[node.index]?.[0]) {\n        // Being used internally\n        return null\n      }\n\n      let config = {}\n      let rerouteType = '*'\n      if (linksFrom) {\n        for (const [, , id, slot] of linksFrom['0']) {\n          const node = this.nodeData.nodes[id]\n          const input = node.inputs[slot]\n          if (rerouteType === '*') {\n            rerouteType = input.type\n          }\n          if (input.widget) {\n            const targetDef = globalDefs[node.type]\n            const targetWidget =\n              targetDef.input.required[input.widget.name] ??\n              targetDef.input.optional[input.widget.name]\n\n            const widget = [targetWidget[0], config]\n            const res = mergeIfValid(\n              {\n                widget\n              },\n              targetWidget,\n              false,\n              null,\n              widget\n            )\n            config = res?.customConfig ?? config\n          }\n        }\n      } else if (linksTo) {\n        const [id, slot] = linksTo['0']\n        rerouteType = this.nodeData.nodes[id].outputs[slot].type\n      } else {\n        // Reroute used as a pipe\n        for (const l of this.nodeData.links) {\n          if (l[2] === node.index) {\n            rerouteType = l[5]\n            break\n          }\n        }\n        if (rerouteType === '*') {\n          // Check for an external link\n          const t = this.externalFrom[node.index]?.[0]\n          if (t) {\n            rerouteType = t\n          }\n        }\n      }\n\n      // @ts-expect-error\n      config.forceInput = true\n      return {\n        input: {\n          required: {\n            [rerouteType]: [rerouteType, config]\n          }\n        },\n        output: [rerouteType],\n        output_name: [],\n        output_is_list: []\n      }\n    }\n\n    console.warn(\n      'Skipping virtual node ' +\n        node.type +\n        ' when building group node ' +\n        this.name\n    )\n  }\n\n  getInputConfig(node, inputName, seenInputs, config, extra?) {\n    const customConfig = this.nodeData.config?.[node.index]?.input?.[inputName]\n    let name =\n      customConfig?.name ??\n      node.inputs?.find((inp) => inp.name === inputName)?.label ??\n      inputName\n    let key = name\n    let prefix = ''\n    // Special handling for primitive to include the title if it is set rather than just \"value\"\n    if ((node.type === 'PrimitiveNode' && node.title) || name in seenInputs) {\n      prefix = `${node.title ?? node.type} `\n      key = name = `${prefix}${inputName}`\n      if (name in seenInputs) {\n        name = `${prefix}${seenInputs[name]} ${inputName}`\n      }\n    }\n    seenInputs[key] = (seenInputs[key] ?? 1) + 1\n\n    if (inputName === 'seed' || inputName === 'noise_seed') {\n      if (!extra) extra = {}\n      extra.control_after_generate = `${prefix}control_after_generate`\n    }\n    if (config[0] === 'IMAGEUPLOAD') {\n      if (!extra) extra = {}\n      extra.widget =\n        this.oldToNewWidgetMap[node.index]?.[config[1]?.widget ?? 'image'] ??\n        'image'\n    }\n\n    if (extra) {\n      config = [config[0], { ...config[1], ...extra }]\n    }\n\n    return { name, config, customConfig }\n  }\n\n  processWidgetInputs(inputs, node, inputNames, seenInputs) {\n    const slots = []\n    const converted = new Map()\n    const widgetMap = (this.oldToNewWidgetMap[node.index] = {})\n    for (const inputName of inputNames) {\n      let widgetType = app.getWidgetType(inputs[inputName], inputName)\n      if (widgetType) {\n        const convertedIndex = node.inputs?.findIndex(\n          (inp) => inp.name === inputName && inp.widget?.name === inputName\n        )\n        if (convertedIndex > -1) {\n          // This widget has been converted to a widget\n          // We need to store this in the correct position so link ids line up\n          converted.set(convertedIndex, inputName)\n          widgetMap[inputName] = null\n        } else {\n          // Normal widget\n          const { name, config } = this.getInputConfig(\n            node,\n            inputName,\n            seenInputs,\n            inputs[inputName]\n          )\n          this.nodeDef.input.required[name] = config\n          widgetMap[inputName] = name\n          this.newToOldWidgetMap[name] = { node, inputName }\n        }\n      } else {\n        // Normal input\n        slots.push(inputName)\n      }\n    }\n    return { converted, slots }\n  }\n\n  checkPrimitiveConnection(link, inputName, inputs) {\n    const sourceNode = this.nodeData.nodes[link[0]]\n    if (sourceNode.type === 'PrimitiveNode') {\n      // Merge link configurations\n      const [sourceNodeId, _, targetNodeId, __] = link\n      const primitiveDef = this.primitiveDefs[sourceNodeId]\n      const targetWidget = inputs[inputName]\n      const primitiveConfig = primitiveDef.input.required.value\n      const output = { widget: primitiveConfig }\n      const config = mergeIfValid(\n        output,\n        targetWidget,\n        false,\n        null,\n        primitiveConfig\n      )\n      primitiveConfig[1] =\n        config?.customConfig ?? inputs[inputName][1]\n          ? { ...inputs[inputName][1] }\n          : {}\n\n      let name = this.oldToNewWidgetMap[sourceNodeId]['value']\n      name = name.substr(0, name.length - 6)\n      primitiveConfig[1].control_after_generate = true\n      primitiveConfig[1].control_prefix = name\n\n      let toPrimitive = this.widgetToPrimitive[targetNodeId]\n      if (!toPrimitive) {\n        toPrimitive = this.widgetToPrimitive[targetNodeId] = {}\n      }\n      if (toPrimitive[inputName]) {\n        toPrimitive[inputName].push(sourceNodeId)\n      }\n      toPrimitive[inputName] = sourceNodeId\n\n      let toWidget = this.primitiveToWidget[sourceNodeId]\n      if (!toWidget) {\n        toWidget = this.primitiveToWidget[sourceNodeId] = []\n      }\n      toWidget.push({ nodeId: targetNodeId, inputName })\n    }\n  }\n\n  processInputSlots(inputs, node, slots, linksTo, inputMap, seenInputs) {\n    this.nodeInputs[node.index] = {}\n    for (let i = 0; i < slots.length; i++) {\n      const inputName = slots[i]\n      if (linksTo[i]) {\n        this.checkPrimitiveConnection(linksTo[i], inputName, inputs)\n        // This input is linked so we can skip it\n        continue\n      }\n\n      const { name, config, customConfig } = this.getInputConfig(\n        node,\n        inputName,\n        seenInputs,\n        inputs[inputName]\n      )\n\n      this.nodeInputs[node.index][inputName] = name\n      if (customConfig?.visible === false) continue\n\n      this.nodeDef.input.required[name] = config\n      inputMap[i] = this.inputCount++\n    }\n  }\n\n  processConvertedWidgets(\n    inputs,\n    node,\n    slots,\n    converted,\n    linksTo,\n    inputMap,\n    seenInputs\n  ) {\n    // Add converted widgets sorted into their index order (ordered as they were converted) so link ids match up\n    const convertedSlots = [...converted.keys()]\n      .sort()\n      .map((k) => converted.get(k))\n    for (let i = 0; i < convertedSlots.length; i++) {\n      const inputName = convertedSlots[i]\n      if (linksTo[slots.length + i]) {\n        this.checkPrimitiveConnection(\n          linksTo[slots.length + i],\n          inputName,\n          inputs\n        )\n        // This input is linked so we can skip it\n        continue\n      }\n\n      const { name, config } = this.getInputConfig(\n        node,\n        inputName,\n        seenInputs,\n        inputs[inputName],\n        {\n          defaultInput: true\n        }\n      )\n\n      this.nodeDef.input.required[name] = config\n      this.newToOldWidgetMap[name] = { node, inputName }\n\n      if (!this.oldToNewWidgetMap[node.index]) {\n        this.oldToNewWidgetMap[node.index] = {}\n      }\n      this.oldToNewWidgetMap[node.index][inputName] = name\n\n      inputMap[slots.length + i] = this.inputCount++\n    }\n  }\n\n  #convertedToProcess = []\n  processNodeInputs(node, seenInputs, inputs) {\n    const inputMapping = []\n\n    const inputNames = Object.keys(inputs)\n    if (!inputNames.length) return\n\n    const { converted, slots } = this.processWidgetInputs(\n      inputs,\n      node,\n      inputNames,\n      seenInputs\n    )\n    const linksTo = this.linksTo[node.index] ?? {}\n    const inputMap = (this.oldToNewInputMap[node.index] = {})\n    this.processInputSlots(inputs, node, slots, linksTo, inputMap, seenInputs)\n\n    // Converted inputs have to be processed after all other nodes as they'll be at the end of the list\n    this.#convertedToProcess.push(() =>\n      this.processConvertedWidgets(\n        inputs,\n        node,\n        slots,\n        converted,\n        linksTo,\n        inputMap,\n        seenInputs\n      )\n    )\n\n    return inputMapping\n  }\n\n  processNodeOutputs(node, seenOutputs, def) {\n    const oldToNew = (this.oldToNewOutputMap[node.index] = {})\n\n    // Add outputs\n    for (let outputId = 0; outputId < def.output.length; outputId++) {\n      const linksFrom = this.linksFrom[node.index]\n      // If this output is linked internally we flag it to hide\n      const hasLink =\n        linksFrom?.[outputId] && !this.externalFrom[node.index]?.[outputId]\n      const customConfig =\n        this.nodeData.config?.[node.index]?.output?.[outputId]\n      const visible = customConfig?.visible ?? !hasLink\n      this.outputVisibility.push(visible)\n      if (!visible) {\n        continue\n      }\n\n      oldToNew[outputId] = this.nodeDef.output.length\n      this.newToOldOutputMap[this.nodeDef.output.length] = {\n        node,\n        slot: outputId\n      }\n      this.nodeDef.output.push(def.output[outputId])\n      this.nodeDef.output_is_list.push(def.output_is_list[outputId])\n\n      let label = customConfig?.name\n      if (!label) {\n        label = def.output_name?.[outputId] ?? def.output[outputId]\n        const output = node.outputs.find((o) => o.name === label)\n        if (output?.label) {\n          label = output.label\n        }\n      }\n\n      let name = label\n      if (name in seenOutputs) {\n        const prefix = `${node.title ?? node.type} `\n        name = `${prefix}${label}`\n        if (name in seenOutputs) {\n          name = `${prefix}${node.index} ${label}`\n        }\n      }\n      seenOutputs[name] = 1\n\n      this.nodeDef.output_name.push(name)\n    }\n  }\n\n  static async registerFromWorkflow(groupNodes, missingNodeTypes) {\n    const clean = app.clean\n    app.clean = function () {\n      for (const g in groupNodes) {\n        try {\n          LiteGraph.unregisterNodeType('workflow/' + g)\n        } catch (error) {}\n      }\n      app.clean = clean\n    }\n\n    for (const g in groupNodes) {\n      const groupData = groupNodes[g]\n\n      let hasMissing = false\n      for (const n of groupData.nodes) {\n        // Find missing node types\n        if (!(n.type in LiteGraph.registered_node_types)) {\n          missingNodeTypes.push({\n            type: n.type,\n            hint: ` (In group node 'workflow/${g}')`\n          })\n\n          missingNodeTypes.push({\n            type: 'workflow/' + g,\n            action: {\n              text: 'Remove from workflow',\n              callback: (e) => {\n                delete groupNodes[g]\n                e.target.textContent = 'Removed'\n                e.target.style.pointerEvents = 'none'\n                e.target.style.opacity = 0.7\n              }\n            }\n          })\n\n          hasMissing = true\n        }\n      }\n\n      if (hasMissing) continue\n\n      const config = new GroupNodeConfig(g, groupData)\n      await config.registerType()\n    }\n  }\n}\n\nexport class GroupNodeHandler {\n  node\n  groupData\n  innerNodes: any\n\n  constructor(node) {\n    this.node = node\n    this.groupData = node.constructor?.nodeData?.[GROUP]\n\n    this.node.setInnerNodes = (innerNodes) => {\n      this.innerNodes = innerNodes\n\n      for (\n        let innerNodeIndex = 0;\n        innerNodeIndex < this.innerNodes.length;\n        innerNodeIndex++\n      ) {\n        const innerNode = this.innerNodes[innerNodeIndex]\n\n        for (const w of innerNode.widgets ?? []) {\n          if (w.type === 'converted-widget') {\n            w.serializeValue = w.origSerializeValue\n          }\n        }\n\n        innerNode.index = innerNodeIndex\n        innerNode.getInputNode = (slot) => {\n          // Check if this input is internal or external\n          const externalSlot =\n            this.groupData.oldToNewInputMap[innerNode.index]?.[slot]\n          if (externalSlot != null) {\n            return this.node.getInputNode(externalSlot)\n          }\n\n          // Internal link\n          const innerLink = this.groupData.linksTo[innerNode.index]?.[slot]\n          if (!innerLink) return null\n\n          const inputNode = innerNodes[innerLink[0]]\n          // Primitives will already apply their values\n          if (inputNode.type === 'PrimitiveNode') return null\n\n          return inputNode\n        }\n\n        innerNode.getInputLink = (slot) => {\n          const externalSlot =\n            this.groupData.oldToNewInputMap[innerNode.index]?.[slot]\n          if (externalSlot != null) {\n            // The inner node is connected via the group node inputs\n            const linkId = this.node.inputs[externalSlot].link\n            let link = app.graph.links[linkId]\n\n            // Use the outer link, but update the target to the inner node\n            // @ts-expect-error\n            // TODO: Fix this\n            link = {\n              ...link,\n              target_id: innerNode.id,\n              target_slot: +slot\n            }\n            return link\n          }\n\n          let link = this.groupData.linksTo[innerNode.index]?.[slot]\n          if (!link) return null\n          // Use the inner link, but update the origin node to be inner node id\n          link = {\n            origin_id: innerNodes[link[0]].id,\n            origin_slot: link[1],\n            target_id: innerNode.id,\n            target_slot: +slot\n          }\n          return link\n        }\n      }\n    }\n\n    this.node.updateLink = (link) => {\n      // Replace the group node reference with the internal node\n      link = { ...link }\n      const output = this.groupData.newToOldOutputMap[link.origin_slot]\n      let innerNode = this.innerNodes[output.node.index]\n      let l\n      while (innerNode?.type === 'Reroute') {\n        l = innerNode.getInputLink(0)\n        innerNode = innerNode.getInputNode(0)\n      }\n\n      if (!innerNode) {\n        return null\n      }\n\n      if (l && GroupNodeHandler.isGroupNode(innerNode)) {\n        return innerNode.updateLink(l)\n      }\n\n      link.origin_id = innerNode.id\n      link.origin_slot = l?.origin_slot ?? output.slot\n      return link\n    }\n\n    this.node.getInnerNodes = () => {\n      if (!this.innerNodes) {\n        this.node.setInnerNodes(\n          this.groupData.nodeData.nodes.map((n, i) => {\n            const innerNode = LiteGraph.createNode(n.type)\n            innerNode.configure(n)\n            // @ts-expect-error\n            innerNode.id = `${this.node.id}:${i}`\n            return innerNode\n          })\n        )\n      }\n\n      this.updateInnerWidgets()\n\n      return this.innerNodes\n    }\n\n    this.node.recreate = async () => {\n      const id = this.node.id\n      const sz = this.node.size\n      const nodes = this.node.convertToNodes()\n\n      const groupNode = LiteGraph.createNode(this.node.type)\n      groupNode.id = id\n\n      // Reuse the existing nodes for this instance\n      groupNode.setInnerNodes(nodes)\n      groupNode[GROUP].populateWidgets()\n      app.graph.add(groupNode)\n      groupNode.size = [\n        Math.max(groupNode.size[0], sz[0]),\n        Math.max(groupNode.size[1], sz[1])\n      ]\n\n      // Remove all converted nodes and relink them\n      groupNode[GROUP].replaceNodes(nodes)\n      return groupNode\n    }\n\n    this.node.convertToNodes = () => {\n      const addInnerNodes = () => {\n        const backup = localStorage.getItem('litegrapheditor_clipboard')\n        // Clone the node data so we dont mutate it for other nodes\n        const c = { ...this.groupData.nodeData }\n        c.nodes = [...c.nodes]\n        const innerNodes = this.node.getInnerNodes()\n        let ids = []\n        for (let i = 0; i < c.nodes.length; i++) {\n          let id = innerNodes?.[i]?.id\n          // Use existing IDs if they are set on the inner nodes\n          if (id == null || isNaN(id)) {\n            id = undefined\n          } else {\n            ids.push(id)\n          }\n          c.nodes[i] = { ...c.nodes[i], id }\n        }\n        localStorage.setItem('litegrapheditor_clipboard', JSON.stringify(c))\n        app.canvas.pasteFromClipboard()\n        localStorage.setItem('litegrapheditor_clipboard', backup)\n\n        const [x, y] = this.node.pos\n        let top\n        let left\n        // Configure nodes with current widget data\n        const selectedIds = ids.length\n          ? ids\n          : Object.keys(app.canvas.selected_nodes)\n        const newNodes = []\n        for (let i = 0; i < selectedIds.length; i++) {\n          const id = selectedIds[i]\n          const newNode = app.graph.getNodeById(id)\n          const innerNode = innerNodes[i]\n          newNodes.push(newNode)\n\n          if (left == null || newNode.pos[0] < left) {\n            left = newNode.pos[0]\n          }\n          if (top == null || newNode.pos[1] < top) {\n            top = newNode.pos[1]\n          }\n\n          if (!newNode.widgets) continue\n\n          const map = this.groupData.oldToNewWidgetMap[innerNode.index]\n          if (map) {\n            const widgets = Object.keys(map)\n\n            for (const oldName of widgets) {\n              const newName = map[oldName]\n              if (!newName) continue\n\n              const widgetIndex = this.node.widgets.findIndex(\n                (w) => w.name === newName\n              )\n              if (widgetIndex === -1) continue\n\n              // Populate the main and any linked widgets\n              if (innerNode.type === 'PrimitiveNode') {\n                for (let i = 0; i < newNode.widgets.length; i++) {\n                  newNode.widgets[i].value =\n                    this.node.widgets[widgetIndex + i].value\n                }\n              } else {\n                const outerWidget = this.node.widgets[widgetIndex]\n                const newWidget = newNode.widgets.find(\n                  (w) => w.name === oldName\n                )\n                if (!newWidget) continue\n\n                newWidget.value = outerWidget.value\n                for (let w = 0; w < outerWidget.linkedWidgets?.length; w++) {\n                  newWidget.linkedWidgets[w].value =\n                    outerWidget.linkedWidgets[w].value\n                }\n              }\n            }\n          }\n        }\n\n        // Shift each node\n        for (const newNode of newNodes) {\n          newNode.pos = [\n            newNode.pos[0] - (left - x),\n            newNode.pos[1] - (top - y)\n          ]\n        }\n\n        return { newNodes, selectedIds }\n      }\n\n      const reconnectInputs = (selectedIds) => {\n        for (const innerNodeIndex in this.groupData.oldToNewInputMap) {\n          const id = selectedIds[innerNodeIndex]\n          const newNode = app.graph.getNodeById(id)\n          const map = this.groupData.oldToNewInputMap[innerNodeIndex]\n          for (const innerInputId in map) {\n            const groupSlotId = map[innerInputId]\n            if (groupSlotId == null) continue\n            const slot = node.inputs[groupSlotId]\n            if (slot.link == null) continue\n            const link = app.graph.links[slot.link]\n            if (!link) continue\n            //  connect this node output to the input of another node\n            const originNode = app.graph.getNodeById(link.origin_id)\n            originNode.connect(link.origin_slot, newNode, +innerInputId)\n          }\n        }\n      }\n\n      const reconnectOutputs = (selectedIds) => {\n        for (\n          let groupOutputId = 0;\n          groupOutputId < node.outputs?.length;\n          groupOutputId++\n        ) {\n          const output = node.outputs[groupOutputId]\n          if (!output.links) continue\n          const links = [...output.links]\n          for (const l of links) {\n            const slot = this.groupData.newToOldOutputMap[groupOutputId]\n            const link = app.graph.links[l]\n            const targetNode = app.graph.getNodeById(link.target_id)\n            const newNode = app.graph.getNodeById(selectedIds[slot.node.index])\n            newNode.connect(slot.slot, targetNode, link.target_slot)\n          }\n        }\n      }\n\n      const { newNodes, selectedIds } = addInnerNodes()\n      reconnectInputs(selectedIds)\n      reconnectOutputs(selectedIds)\n      app.graph.remove(this.node)\n\n      return newNodes\n    }\n\n    const getExtraMenuOptions = this.node.getExtraMenuOptions\n    this.node.getExtraMenuOptions = function (_, options) {\n      getExtraMenuOptions?.apply(this, arguments)\n\n      let optionIndex = options.findIndex((o) => o.content === 'Outputs')\n      if (optionIndex === -1) optionIndex = options.length\n      else optionIndex++\n      options.splice(\n        optionIndex,\n        0,\n        null,\n        {\n          content: 'Convert to nodes',\n          callback: () => {\n            return this.convertToNodes()\n          }\n        },\n        {\n          content: 'Manage Group Node',\n          callback: () => {\n            new ManageGroupDialog(app).show(this.type)\n          }\n        }\n      )\n    }\n\n    // Draw custom collapse icon to identity this as a group\n    const onDrawTitleBox = this.node.onDrawTitleBox\n    this.node.onDrawTitleBox = function (ctx, height, size, scale) {\n      onDrawTitleBox?.apply(this, arguments)\n\n      const fill = ctx.fillStyle\n      ctx.beginPath()\n      ctx.rect(11, -height + 11, 2, 2)\n      ctx.rect(14, -height + 11, 2, 2)\n      ctx.rect(17, -height + 11, 2, 2)\n      ctx.rect(11, -height + 14, 2, 2)\n      ctx.rect(14, -height + 14, 2, 2)\n      ctx.rect(17, -height + 14, 2, 2)\n      ctx.rect(11, -height + 17, 2, 2)\n      ctx.rect(14, -height + 17, 2, 2)\n      ctx.rect(17, -height + 17, 2, 2)\n\n      ctx.fillStyle = this.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR\n      ctx.fill()\n      ctx.fillStyle = fill\n    }\n\n    // Draw progress label\n    const onDrawForeground = node.onDrawForeground\n    const groupData = this.groupData.nodeData\n    node.onDrawForeground = function (ctx) {\n      const r = onDrawForeground?.apply?.(this, arguments)\n      if (\n        +app.runningNodeId === this.id &&\n        this.runningInternalNodeId !== null\n      ) {\n        const n = groupData.nodes[this.runningInternalNodeId]\n        if (!n) return\n        const message = `Running ${n.title || n.type} (${this.runningInternalNodeId}/${groupData.nodes.length})`\n        ctx.save()\n        ctx.font = '12px sans-serif'\n        const sz = ctx.measureText(message)\n        ctx.fillStyle = node.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR\n        ctx.beginPath()\n        ctx.roundRect(\n          0,\n          -LiteGraph.NODE_TITLE_HEIGHT - 20,\n          sz.width + 12,\n          20,\n          5\n        )\n        ctx.fill()\n\n        ctx.fillStyle = '#fff'\n        ctx.fillText(message, 6, -LiteGraph.NODE_TITLE_HEIGHT - 6)\n        ctx.restore()\n      }\n    }\n\n    // Flag this node as needing to be reset\n    const onExecutionStart = this.node.onExecutionStart\n    this.node.onExecutionStart = function () {\n      this.resetExecution = true\n      return onExecutionStart?.apply(this, arguments)\n    }\n\n    const self = this\n    const onNodeCreated = this.node.onNodeCreated\n    this.node.onNodeCreated = function () {\n      if (!this.widgets) {\n        return\n      }\n      const config = self.groupData.nodeData.config\n      if (config) {\n        for (const n in config) {\n          const inputs = config[n]?.input\n          for (const w in inputs) {\n            if (inputs[w].visible !== false) continue\n            const widgetName = self.groupData.oldToNewWidgetMap[n][w]\n            const widget = this.widgets.find((w) => w.name === widgetName)\n            if (widget) {\n              widget.type = 'hidden'\n              widget.computeSize = () => [0, -4]\n            }\n          }\n        }\n      }\n\n      return onNodeCreated?.apply(this, arguments)\n    }\n\n    function handleEvent(type, getId, getEvent) {\n      const handler = ({ detail }) => {\n        const id = getId(detail)\n        if (!id) return\n        const node = app.graph.getNodeById(id)\n        if (node) return\n\n        const innerNodeIndex = this.innerNodes?.findIndex((n) => n.id == id)\n        if (innerNodeIndex > -1) {\n          this.node.runningInternalNodeId = innerNodeIndex\n          api.dispatchEvent(\n            new CustomEvent(type, {\n              detail: getEvent(detail, this.node.id + '', this.node)\n            })\n          )\n        }\n      }\n      api.addEventListener(type, handler)\n      return handler\n    }\n\n    const executing = handleEvent.call(\n      this,\n      'executing',\n      (d) => d,\n      (d, id, node) => id\n    )\n\n    const executed = handleEvent.call(\n      this,\n      'executed',\n      (d) => d?.display_node || d?.node,\n      (d, id, node) => ({\n        ...d,\n        node: id,\n        display_node: id,\n        merge: !node.resetExecution\n      })\n    )\n\n    const onRemoved = node.onRemoved\n    this.node.onRemoved = function () {\n      onRemoved?.apply(this, arguments)\n      api.removeEventListener('executing', executing)\n      api.removeEventListener('executed', executed)\n    }\n\n    this.node.refreshComboInNode = (defs) => {\n      // Update combo widget options\n      for (const widgetName in this.groupData.newToOldWidgetMap) {\n        const widget = this.node.widgets.find((w) => w.name === widgetName)\n        if (widget?.type === 'combo') {\n          const old = this.groupData.newToOldWidgetMap[widgetName]\n          const def = defs[old.node.type]\n          const input =\n            def?.input?.required?.[old.inputName] ??\n            def?.input?.optional?.[old.inputName]\n          if (!input) continue\n\n          widget.options.values = input[0]\n\n          if (\n            old.inputName !== 'image' &&\n            !widget.options.values.includes(widget.value)\n          ) {\n            widget.value = widget.options.values[0]\n            widget.callback(widget.value)\n          }\n        }\n      }\n    }\n  }\n\n  updateInnerWidgets() {\n    for (const newWidgetName in this.groupData.newToOldWidgetMap) {\n      const newWidget = this.node.widgets.find((w) => w.name === newWidgetName)\n      if (!newWidget) continue\n\n      const newValue = newWidget.value\n      const old = this.groupData.newToOldWidgetMap[newWidgetName]\n      let innerNode = this.innerNodes[old.node.index]\n\n      if (innerNode.type === 'PrimitiveNode') {\n        innerNode.primitiveValue = newValue\n        const primitiveLinked = this.groupData.primitiveToWidget[old.node.index]\n        for (const linked of primitiveLinked ?? []) {\n          const node = this.innerNodes[linked.nodeId]\n          const widget = node.widgets.find((w) => w.name === linked.inputName)\n\n          if (widget) {\n            widget.value = newValue\n          }\n        }\n        continue\n      } else if (innerNode.type === 'Reroute') {\n        const rerouteLinks = this.groupData.linksFrom[old.node.index]\n        if (rerouteLinks) {\n          for (const [_, , targetNodeId, targetSlot] of rerouteLinks['0']) {\n            const node = this.innerNodes[targetNodeId]\n            const input = node.inputs[targetSlot]\n            if (input.widget) {\n              const widget = node.widgets?.find(\n                (w) => w.name === input.widget.name\n              )\n              if (widget) {\n                widget.value = newValue\n              }\n            }\n          }\n        }\n      }\n\n      const widget = innerNode.widgets?.find((w) => w.name === old.inputName)\n      if (widget) {\n        widget.value = newValue\n      }\n    }\n  }\n\n  populatePrimitive(node, nodeId, oldName, i, linkedShift) {\n    // Converted widget, populate primitive if linked\n    const primitiveId = this.groupData.widgetToPrimitive[nodeId]?.[oldName]\n    if (primitiveId == null) return\n    const targetWidgetName =\n      this.groupData.oldToNewWidgetMap[primitiveId]['value']\n    const targetWidgetIndex = this.node.widgets.findIndex(\n      (w) => w.name === targetWidgetName\n    )\n    if (targetWidgetIndex > -1) {\n      const primitiveNode = this.innerNodes[primitiveId]\n      let len = primitiveNode.widgets.length\n      if (\n        len - 1 !==\n        this.node.widgets[targetWidgetIndex].linkedWidgets?.length\n      ) {\n        // Fallback handling for if some reason the primitive has a different number of widgets\n        // we dont want to overwrite random widgets, better to leave blank\n        len = 1\n      }\n      for (let i = 0; i < len; i++) {\n        this.node.widgets[targetWidgetIndex + i].value =\n          primitiveNode.widgets[i].value\n      }\n    }\n    return true\n  }\n\n  populateReroute(node, nodeId, map) {\n    if (node.type !== 'Reroute') return\n\n    const link = this.groupData.linksFrom[nodeId]?.[0]?.[0]\n    if (!link) return\n    const [, , targetNodeId, targetNodeSlot] = link\n    const targetNode = this.groupData.nodeData.nodes[targetNodeId]\n    const inputs = targetNode.inputs\n    const targetWidget = inputs?.[targetNodeSlot]?.widget\n    if (!targetWidget) return\n\n    const offset = inputs.length - (targetNode.widgets_values?.length ?? 0)\n    const v = targetNode.widgets_values?.[targetNodeSlot - offset]\n    if (v == null) return\n\n    const widgetName = Object.values(map)[0]\n    const widget = this.node.widgets.find((w) => w.name === widgetName)\n    if (widget) {\n      widget.value = v\n    }\n  }\n\n  populateWidgets() {\n    if (!this.node.widgets) return\n\n    for (\n      let nodeId = 0;\n      nodeId < this.groupData.nodeData.nodes.length;\n      nodeId++\n    ) {\n      const node = this.groupData.nodeData.nodes[nodeId]\n      const map = this.groupData.oldToNewWidgetMap[nodeId] ?? {}\n      const widgets = Object.keys(map)\n\n      if (!node.widgets_values?.length) {\n        // special handling for populating values into reroutes\n        // this allows primitives connect to them to pick up the correct value\n        this.populateReroute(node, nodeId, map)\n        continue\n      }\n\n      let linkedShift = 0\n      for (let i = 0; i < widgets.length; i++) {\n        const oldName = widgets[i]\n        const newName = map[oldName]\n        const widgetIndex = this.node.widgets.findIndex(\n          (w) => w.name === newName\n        )\n        const mainWidget = this.node.widgets[widgetIndex]\n        if (\n          this.populatePrimitive(node, nodeId, oldName, i, linkedShift) ||\n          widgetIndex === -1\n        ) {\n          // Find the inner widget and shift by the number of linked widgets as they will have been removed too\n          const innerWidget = this.innerNodes[nodeId].widgets?.find(\n            (w) => w.name === oldName\n          )\n          linkedShift += innerWidget?.linkedWidgets?.length ?? 0\n        }\n        if (widgetIndex === -1) {\n          continue\n        }\n\n        // Populate the main and any linked widget\n        mainWidget.value = node.widgets_values[i + linkedShift]\n        for (let w = 0; w < mainWidget.linkedWidgets?.length; w++) {\n          this.node.widgets[widgetIndex + w + 1].value =\n            node.widgets_values[i + ++linkedShift]\n        }\n      }\n    }\n  }\n\n  replaceNodes(nodes) {\n    let top\n    let left\n\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i]\n      if (left == null || node.pos[0] < left) {\n        left = node.pos[0]\n      }\n      if (top == null || node.pos[1] < top) {\n        top = node.pos[1]\n      }\n\n      this.linkOutputs(node, i)\n      app.graph.remove(node)\n    }\n\n    this.linkInputs()\n    this.node.pos = [left, top]\n  }\n\n  linkOutputs(originalNode, nodeId) {\n    if (!originalNode.outputs) return\n\n    for (const output of originalNode.outputs) {\n      if (!output.links) continue\n      // Clone the links as they'll be changed if we reconnect\n      const links = [...output.links]\n      for (const l of links) {\n        const link = app.graph.links[l]\n        if (!link) continue\n\n        const targetNode = app.graph.getNodeById(link.target_id)\n        const newSlot =\n          this.groupData.oldToNewOutputMap[nodeId]?.[link.origin_slot]\n        if (newSlot != null) {\n          this.node.connect(newSlot, targetNode, link.target_slot)\n        }\n      }\n    }\n  }\n\n  linkInputs() {\n    for (const link of this.groupData.nodeData.links ?? []) {\n      const [, originSlot, targetId, targetSlot, actualOriginId] = link\n      const originNode = app.graph.getNodeById(actualOriginId)\n      if (!originNode) continue // this node is in the group\n      originNode.connect(\n        originSlot,\n        this.node.id,\n        this.groupData.oldToNewInputMap[targetId][targetSlot]\n      )\n    }\n  }\n\n  static getGroupData(node) {\n    return (node.nodeData ?? node.constructor?.nodeData)?.[GROUP]\n  }\n\n  static isGroupNode(node) {\n    return !!node.constructor?.nodeData?.[GROUP]\n  }\n\n  static async fromNodes(nodes) {\n    // Process the nodes into the stored workflow group node data\n    const builder = new GroupNodeBuilder(nodes)\n    const res = builder.build()\n    if (!res) return\n\n    const { name, nodeData } = res\n\n    // Convert this data into a LG node definition and register it\n    const config = new GroupNodeConfig(name, nodeData)\n    await config.registerType()\n\n    const groupNode = LiteGraph.createNode(`workflow/${name}`)\n    // Reuse the existing nodes for this instance\n    groupNode.setInnerNodes(builder.nodes)\n    groupNode[GROUP].populateWidgets()\n    app.graph.add(groupNode)\n\n    // Remove all converted nodes and relink them\n    groupNode[GROUP].replaceNodes(builder.nodes)\n    return groupNode\n  }\n}\n\nfunction addConvertToGroupOptions() {\n  function addConvertOption(options, index) {\n    const selected = Object.values(app.canvas.selected_nodes ?? {})\n    const disabled =\n      selected.length < 2 ||\n      selected.find((n) => GroupNodeHandler.isGroupNode(n))\n    options.splice(index + 1, null, {\n      content: `Convert to Group Node`,\n      disabled,\n      callback: async () => {\n        return await GroupNodeHandler.fromNodes(selected)\n      }\n    })\n  }\n\n  function addManageOption(options, index) {\n    const groups = app.graph.extra?.groupNodes\n    const disabled = !groups || !Object.keys(groups).length\n    options.splice(index + 1, null, {\n      content: `Manage Group Nodes`,\n      disabled,\n      callback: () => {\n        new ManageGroupDialog(app).show()\n      }\n    })\n  }\n\n  // Add to canvas\n  const getCanvasMenuOptions = LGraphCanvas.prototype.getCanvasMenuOptions\n  LGraphCanvas.prototype.getCanvasMenuOptions = function () {\n    const options = getCanvasMenuOptions.apply(this, arguments)\n    const index =\n      options.findIndex((o) => o?.content === 'Add Group') + 1 || options.length\n    addConvertOption(options, index)\n    addManageOption(options, index + 1)\n    return options\n  }\n\n  // Add to nodes\n  const getNodeMenuOptions = LGraphCanvas.prototype.getNodeMenuOptions\n  LGraphCanvas.prototype.getNodeMenuOptions = function (node) {\n    const options = getNodeMenuOptions.apply(this, arguments)\n    if (!GroupNodeHandler.isGroupNode(node)) {\n      const index =\n        options.findIndex((o) => o?.content === 'Outputs') + 1 ||\n        options.length - 1\n      addConvertOption(options, index)\n    }\n    return options\n  }\n}\n\nconst id = 'Comfy.GroupNode'\nlet globalDefs\nconst ext = {\n  name: id,\n  setup() {\n    addConvertToGroupOptions()\n  },\n  async beforeConfigureGraph(graphData, missingNodeTypes) {\n    const nodes = graphData?.extra?.groupNodes\n    if (nodes) {\n      await GroupNodeConfig.registerFromWorkflow(nodes, missingNodeTypes)\n    }\n  },\n  addCustomNodeDefs(defs) {\n    // Store this so we can mutate it later with group nodes\n    globalDefs = defs\n  },\n  nodeCreated(node) {\n    if (GroupNodeHandler.isGroupNode(node)) {\n      node[GROUP] = new GroupNodeHandler(node)\n    }\n  },\n  async refreshComboInNodes(defs) {\n    // Re-register group nodes so new ones are created with the correct options\n    Object.assign(globalDefs, defs)\n    const nodes = app.graph.extra?.groupNodes\n    if (nodes) {\n      await GroupNodeConfig.registerFromWorkflow(nodes, {})\n    }\n  }\n}\n\napp.registerExtension(ext)\n","import { app } from '../../scripts/app'\nimport { LGraphCanvas, LiteGraph } from '@comfyorg/litegraph'\n\nfunction setNodeMode(node, mode) {\n  node.mode = mode\n  node.graph.change()\n}\n\nfunction addNodesToGroup(group, nodes = []) {\n  var x1, y1, x2, y2\n  var nx1, ny1, nx2, ny2\n  var node\n\n  x1 = y1 = x2 = y2 = -1\n  nx1 = ny1 = nx2 = ny2 = -1\n\n  for (var n of [group._nodes, nodes]) {\n    for (var i in n) {\n      node = n[i]\n\n      nx1 = node.pos[0]\n      ny1 = node.pos[1]\n      nx2 = node.pos[0] + node.size[0]\n      ny2 = node.pos[1] + node.size[1]\n\n      if (node.type != 'Reroute') {\n        ny1 -= LiteGraph.NODE_TITLE_HEIGHT\n      }\n\n      if (node.flags?.collapsed) {\n        ny2 = ny1 + LiteGraph.NODE_TITLE_HEIGHT\n\n        if (node?._collapsed_width) {\n          nx2 = nx1 + Math.round(node._collapsed_width)\n        }\n      }\n\n      if (x1 == -1 || nx1 < x1) {\n        x1 = nx1\n      }\n\n      if (y1 == -1 || ny1 < y1) {\n        y1 = ny1\n      }\n\n      if (x2 == -1 || nx2 > x2) {\n        x2 = nx2\n      }\n\n      if (y2 == -1 || ny2 > y2) {\n        y2 = ny2\n      }\n    }\n  }\n\n  var padding = 10\n\n  y1 = y1 - Math.round(group.font_size * 1.4)\n\n  group.pos = [x1 - padding, y1 - padding]\n  group.size = [x2 - x1 + padding * 2, y2 - y1 + padding * 2]\n}\n\napp.registerExtension({\n  name: 'Comfy.GroupOptions',\n  setup() {\n    const orig = LGraphCanvas.prototype.getCanvasMenuOptions\n    // graph_mouse\n    LGraphCanvas.prototype.getCanvasMenuOptions = function () {\n      const options = orig.apply(this, arguments)\n      const group = this.graph.getGroupOnPos(\n        this.graph_mouse[0],\n        this.graph_mouse[1]\n      )\n      if (!group) {\n        options.push({\n          content: 'Add Group For Selected Nodes',\n          disabled: !Object.keys(app.canvas.selected_nodes || {}).length,\n          callback: () => {\n            // @ts-expect-error\n            var group = new LiteGraph.LGraphGroup()\n            addNodesToGroup(group, this.selected_nodes)\n            app.canvas.graph.add(group)\n            this.graph.change()\n          }\n        })\n\n        return options\n      }\n\n      // Group nodes aren't recomputed until the group is moved, this ensures the nodes are up-to-date\n      group.recomputeInsideNodes()\n      const nodesInGroup = group._nodes\n\n      options.push({\n        content: 'Add Selected Nodes To Group',\n        disabled: !Object.keys(app.canvas.selected_nodes || {}).length,\n        callback: () => {\n          addNodesToGroup(group, this.selected_nodes)\n          this.graph.change()\n        }\n      })\n\n      // No nodes in group, return default options\n      if (nodesInGroup.length === 0) {\n        return options\n      } else {\n        // Add a separator between the default options and the group options\n        options.push(null)\n      }\n\n      // Check if all nodes are the same mode\n      let allNodesAreSameMode = true\n      for (let i = 1; i < nodesInGroup.length; i++) {\n        if (nodesInGroup[i].mode !== nodesInGroup[0].mode) {\n          allNodesAreSameMode = false\n          break\n        }\n      }\n\n      options.push({\n        content: 'Fit Group To Nodes',\n        callback: () => {\n          addNodesToGroup(group)\n          this.graph.change()\n        }\n      })\n\n      options.push({\n        content: 'Select Nodes',\n        callback: () => {\n          this.selectNodes(nodesInGroup)\n          this.graph.change()\n          this.canvas.focus()\n        }\n      })\n\n      // Modes\n      // 0: Always\n      // 1: On Event\n      // 2: Never\n      // 3: On Trigger\n      // 4: Bypass\n      // If all nodes are the same mode, add a menu option to change the mode\n      if (allNodesAreSameMode) {\n        const mode = nodesInGroup[0].mode\n        switch (mode) {\n          case 0:\n            // All nodes are always, option to disable, and bypass\n            options.push({\n              content: 'Set Group Nodes to Never',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 2)\n                }\n              }\n            })\n            options.push({\n              content: 'Bypass Group Nodes',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 4)\n                }\n              }\n            })\n            break\n          case 2:\n            // All nodes are never, option to enable, and bypass\n            options.push({\n              content: 'Set Group Nodes to Always',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 0)\n                }\n              }\n            })\n            options.push({\n              content: 'Bypass Group Nodes',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 4)\n                }\n              }\n            })\n            break\n          case 4:\n            // All nodes are bypass, option to enable, and disable\n            options.push({\n              content: 'Set Group Nodes to Always',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 0)\n                }\n              }\n            })\n            options.push({\n              content: 'Set Group Nodes to Never',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 2)\n                }\n              }\n            })\n            break\n          default:\n            // All nodes are On Trigger or On Event(Or other?), option to disable, set to always, or bypass\n            options.push({\n              content: 'Set Group Nodes to Always',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 0)\n                }\n              }\n            })\n            options.push({\n              content: 'Set Group Nodes to Never',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 2)\n                }\n              }\n            })\n            options.push({\n              content: 'Bypass Group Nodes',\n              callback: () => {\n                for (const node of nodesInGroup) {\n                  setNodeMode(node, 4)\n                }\n              }\n            })\n            break\n        }\n      } else {\n        // Nodes are not all the same mode, add a menu option to change the mode to always, never, or bypass\n        options.push({\n          content: 'Set Group Nodes to Always',\n          callback: () => {\n            for (const node of nodesInGroup) {\n              setNodeMode(node, 0)\n            }\n          }\n        })\n        options.push({\n          content: 'Set Group Nodes to Never',\n          callback: () => {\n            for (const node of nodesInGroup) {\n              setNodeMode(node, 2)\n            }\n          }\n        })\n        options.push({\n          content: 'Bypass Group Nodes',\n          callback: () => {\n            for (const node of nodesInGroup) {\n              setNodeMode(node, 4)\n            }\n          }\n        })\n      }\n\n      return options\n    }\n  }\n})\n","import { LiteGraph } from '@comfyorg/litegraph'\nimport { app } from '../../scripts/app'\n\n// Inverts the scrolling of context menus\n\nconst id = 'Comfy.InvertMenuScrolling'\napp.registerExtension({\n  name: id,\n  init() {\n    const ctxMenu = LiteGraph.ContextMenu\n    const replace = () => {\n      // @ts-expect-error\n      LiteGraph.ContextMenu = function (values, options) {\n        options = options || {}\n        if (options.scroll_speed) {\n          options.scroll_speed *= -1\n        } else {\n          options.scroll_speed = -0.1\n        }\n        return ctxMenu.call(this, values, options)\n      }\n      LiteGraph.ContextMenu.prototype = ctxMenu.prototype\n    }\n    app.ui.settings.addSetting({\n      id,\n      name: 'Invert Menu Scrolling',\n      type: 'boolean',\n      defaultValue: false,\n      onChange(value) {\n        if (value) {\n          replace()\n        } else {\n          LiteGraph.ContextMenu = ctxMenu\n        }\n      }\n    })\n  }\n})\n","import { app } from '../../scripts/app'\nimport { api } from '../../scripts/api'\n\napp.registerExtension({\n  name: 'Comfy.Keybinds',\n  init() {\n    const keybindListener = function (event) {\n      const modifierPressed = event.ctrlKey || event.metaKey\n\n      // Queue prompt using (ctrl or command) + enter\n      if (modifierPressed && event.key === 'Enter') {\n        // Cancel current prompt using (ctrl or command) + alt + enter\n        if (event.altKey) {\n          api.interrupt()\n          return\n        }\n        // Queue prompt as first for generation using (ctrl or command) + shift + enter\n        app.queuePrompt(event.shiftKey ? -1 : 0).then()\n        return\n      }\n\n      const target = event.composedPath()[0]\n      if (['INPUT', 'TEXTAREA'].includes(target.tagName)) {\n        return\n      }\n\n      const modifierKeyIdMap = {\n        s: '#comfy-save-button',\n        o: '#comfy-file-input',\n        Backspace: '#comfy-clear-button',\n        d: '#comfy-load-default-button'\n      }\n\n      const modifierKeybindId = modifierKeyIdMap[event.key]\n      if (modifierPressed && modifierKeybindId) {\n        event.preventDefault()\n\n        const elem = document.querySelector(modifierKeybindId)\n        elem.click()\n        return\n      }\n\n      // Finished Handling all modifier keybinds, now handle the rest\n      if (event.ctrlKey || event.altKey || event.metaKey) {\n        return\n      }\n\n      // Close out of modals using escape\n      if (event.key === 'Escape') {\n        const modals = document.querySelectorAll<HTMLElement>('.comfy-modal')\n        const modal = Array.from(modals).find(\n          (modal) =>\n            window.getComputedStyle(modal).getPropertyValue('display') !==\n            'none'\n        )\n        if (modal) {\n          modal.style.display = 'none'\n        }\n\n        ;[...document.querySelectorAll('dialog')].forEach((d) => {\n          d.close()\n        })\n      }\n\n      const keyIdMap = {\n        q: '.queue-tab-button.side-bar-button',\n        h: '.queue-tab-button.side-bar-button',\n        r: '#comfy-refresh-button'\n      }\n\n      const buttonId = keyIdMap[event.key]\n      if (buttonId) {\n        const button = document.querySelector(buttonId)\n        button.click()\n      }\n    }\n\n    window.addEventListener('keydown', keybindListener, true)\n  }\n})\n","import { app } from '../../scripts/app'\nimport { LiteGraph } from '@comfyorg/litegraph'\nconst id = 'Comfy.LinkRenderMode'\nconst ext = {\n  name: id,\n  async setup(app) {\n    app.ui.settings.addSetting({\n      id,\n      name: 'Link Render Mode',\n      defaultValue: 2,\n      type: 'combo',\n      // @ts-expect-error\n      options: [...LiteGraph.LINK_RENDER_MODES, 'Hidden'].map((m, i) => ({\n        value: i,\n        text: m,\n        selected: i == app.canvas.links_render_mode\n      })),\n      onChange(value) {\n        app.canvas.links_render_mode = +value\n        app.graph.setDirtyCanvas(true)\n      }\n    })\n  }\n}\n\napp.registerExtension(ext)\n","import { app } from '../../scripts/app'\nimport { ComfyDialog, $el } from '../../scripts/ui'\nimport { ComfyApp } from '../../scripts/app'\nimport { api } from '../../scripts/api'\nimport { ClipspaceDialog } from './clipspace'\n\n// Helper function to convert a data URL to a Blob object\nfunction dataURLToBlob(dataURL) {\n  const parts = dataURL.split(';base64,')\n  const contentType = parts[0].split(':')[1]\n  const byteString = atob(parts[1])\n  const arrayBuffer = new ArrayBuffer(byteString.length)\n  const uint8Array = new Uint8Array(arrayBuffer)\n  for (let i = 0; i < byteString.length; i++) {\n    uint8Array[i] = byteString.charCodeAt(i)\n  }\n  return new Blob([arrayBuffer], { type: contentType })\n}\n\nfunction loadedImageToBlob(image) {\n  const canvas = document.createElement('canvas')\n\n  canvas.width = image.width\n  canvas.height = image.height\n\n  const ctx = canvas.getContext('2d')\n\n  ctx.drawImage(image, 0, 0)\n\n  const dataURL = canvas.toDataURL('image/png', 1)\n  const blob = dataURLToBlob(dataURL)\n\n  return blob\n}\n\nfunction loadImage(imagePath) {\n  return new Promise((resolve, reject) => {\n    const image = new Image()\n\n    image.onload = function () {\n      resolve(image)\n    }\n\n    image.src = imagePath\n  })\n}\n\nasync function uploadMask(filepath, formData) {\n  await api\n    .fetchApi('/upload/mask', {\n      method: 'POST',\n      body: formData\n    })\n    .then((response) => {})\n    .catch((error) => {\n      console.error('Error:', error)\n    })\n\n  ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']] = new Image()\n  ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src = api.apiURL(\n    '/view?' +\n      new URLSearchParams(filepath).toString() +\n      app.getPreviewFormatParam() +\n      app.getRandParam()\n  )\n\n  if (ComfyApp.clipspace.images)\n    ComfyApp.clipspace.images[ComfyApp.clipspace['selectedIndex']] = filepath\n\n  ClipspaceDialog.invalidatePreview()\n}\n\nfunction prepare_mask(image, maskCanvas, maskCtx, maskColor) {\n  // paste mask data into alpha channel\n  maskCtx.drawImage(image, 0, 0, maskCanvas.width, maskCanvas.height)\n  const maskData = maskCtx.getImageData(\n    0,\n    0,\n    maskCanvas.width,\n    maskCanvas.height\n  )\n\n  // invert mask\n  for (let i = 0; i < maskData.data.length; i += 4) {\n    if (maskData.data[i + 3] == 255) maskData.data[i + 3] = 0\n    else maskData.data[i + 3] = 255\n\n    maskData.data[i] = maskColor.r\n    maskData.data[i + 1] = maskColor.g\n    maskData.data[i + 2] = maskColor.b\n  }\n\n  maskCtx.globalCompositeOperation = 'source-over'\n  maskCtx.putImageData(maskData, 0, 0)\n}\n\nclass MaskEditorDialog extends ComfyDialog {\n  static instance = null\n  static mousedown_x: number | null = null\n  static mousedown_y: number | null = null\n\n  brush: HTMLDivElement\n  maskCtx: any\n  maskCanvas: HTMLCanvasElement\n  brush_size_slider: HTMLDivElement\n  brush_opacity_slider: HTMLDivElement\n  colorButton: HTMLButtonElement\n  saveButton: HTMLButtonElement\n  zoom_ratio: number\n  pan_x: number\n  pan_y: number\n  imgCanvas: HTMLCanvasElement\n  last_display_style: string\n  is_visible: boolean\n  image: HTMLImageElement\n  handler_registered: boolean\n  brush_slider_input: HTMLInputElement\n  cursorX: number\n  cursorY: number\n  mousedown_pan_x: number\n  mousedown_pan_y: number\n  last_pressure: number\n\n  static getInstance() {\n    if (!MaskEditorDialog.instance) {\n      MaskEditorDialog.instance = new MaskEditorDialog()\n    }\n\n    return MaskEditorDialog.instance\n  }\n\n  is_layout_created = false\n\n  constructor() {\n    super()\n    this.element = $el('div.comfy-modal', { parent: document.body }, [\n      $el('div.comfy-modal-content', [...this.createButtons()])\n    ])\n  }\n\n  createButtons() {\n    return []\n  }\n\n  createButton(name, callback): HTMLButtonElement {\n    var button = document.createElement('button')\n    button.style.pointerEvents = 'auto'\n    button.innerText = name\n    button.addEventListener('click', callback)\n    return button\n  }\n\n  createLeftButton(name, callback) {\n    var button = this.createButton(name, callback)\n    button.style.cssFloat = 'left'\n    button.style.marginRight = '4px'\n    return button\n  }\n\n  createRightButton(name, callback) {\n    var button = this.createButton(name, callback)\n    button.style.cssFloat = 'right'\n    button.style.marginLeft = '4px'\n    return button\n  }\n\n  createLeftSlider(self, name, callback): HTMLDivElement {\n    const divElement = document.createElement('div')\n    divElement.id = 'maskeditor-slider'\n    divElement.style.cssFloat = 'left'\n    divElement.style.fontFamily = 'sans-serif'\n    divElement.style.marginRight = '4px'\n    divElement.style.color = 'var(--input-text)'\n    divElement.style.backgroundColor = 'var(--comfy-input-bg)'\n    divElement.style.borderRadius = '8px'\n    divElement.style.borderColor = 'var(--border-color)'\n    divElement.style.borderStyle = 'solid'\n    divElement.style.fontSize = '15px'\n    divElement.style.height = '21px'\n    divElement.style.padding = '1px 6px'\n    divElement.style.display = 'flex'\n    divElement.style.position = 'relative'\n    divElement.style.top = '2px'\n    divElement.style.pointerEvents = 'auto'\n    self.brush_slider_input = document.createElement('input')\n    self.brush_slider_input.setAttribute('type', 'range')\n    self.brush_slider_input.setAttribute('min', '1')\n    self.brush_slider_input.setAttribute('max', '100')\n    self.brush_slider_input.setAttribute('value', '10')\n    const labelElement = document.createElement('label')\n    labelElement.textContent = name\n\n    divElement.appendChild(labelElement)\n    divElement.appendChild(self.brush_slider_input)\n\n    self.brush_slider_input.addEventListener('change', callback)\n\n    return divElement\n  }\n\n  createOpacitySlider(self, name, callback): HTMLDivElement {\n    const divElement = document.createElement('div')\n    divElement.id = 'maskeditor-opacity-slider'\n    divElement.style.cssFloat = 'left'\n    divElement.style.fontFamily = 'sans-serif'\n    divElement.style.marginRight = '4px'\n    divElement.style.color = 'var(--input-text)'\n    divElement.style.backgroundColor = 'var(--comfy-input-bg)'\n    divElement.style.borderRadius = '8px'\n    divElement.style.borderColor = 'var(--border-color)'\n    divElement.style.borderStyle = 'solid'\n    divElement.style.fontSize = '15px'\n    divElement.style.height = '21px'\n    divElement.style.padding = '1px 6px'\n    divElement.style.display = 'flex'\n    divElement.style.position = 'relative'\n    divElement.style.top = '2px'\n    divElement.style.pointerEvents = 'auto'\n    self.opacity_slider_input = document.createElement('input')\n    self.opacity_slider_input.setAttribute('type', 'range')\n    self.opacity_slider_input.setAttribute('min', '0.1')\n    self.opacity_slider_input.setAttribute('max', '1.0')\n    self.opacity_slider_input.setAttribute('step', '0.01')\n    self.opacity_slider_input.setAttribute('value', '0.7')\n    const labelElement = document.createElement('label')\n    labelElement.textContent = name\n\n    divElement.appendChild(labelElement)\n    divElement.appendChild(self.opacity_slider_input)\n\n    self.opacity_slider_input.addEventListener('input', callback)\n\n    return divElement\n  }\n\n  setlayout(imgCanvas: HTMLCanvasElement, maskCanvas: HTMLCanvasElement) {\n    const self = this\n\n    // If it is specified as relative, using it only as a hidden placeholder for padding is recommended\n    // to prevent anomalies where it exceeds a certain size and goes outside of the window.\n    var bottom_panel = document.createElement('div')\n    bottom_panel.style.position = 'absolute'\n    bottom_panel.style.bottom = '0px'\n    bottom_panel.style.left = '20px'\n    bottom_panel.style.right = '20px'\n    bottom_panel.style.height = '50px'\n    bottom_panel.style.pointerEvents = 'none'\n\n    var brush = document.createElement('div')\n    brush.id = 'brush'\n    brush.style.backgroundColor = 'transparent'\n    brush.style.outline = '1px dashed black'\n    brush.style.boxShadow = '0 0 0 1px white'\n    brush.style.borderRadius = '50%'\n    // @ts-expect-error\n    brush.style.MozBorderRadius = '50%'\n    // @ts-expect-error\n    brush.style.WebkitBorderRadius = '50%'\n    brush.style.position = 'absolute'\n    brush.style.zIndex = '8889'\n    brush.style.pointerEvents = 'none'\n    this.brush = brush\n    this.element.appendChild(imgCanvas)\n    this.element.appendChild(maskCanvas)\n    this.element.appendChild(bottom_panel)\n    document.body.appendChild(brush)\n\n    var clearButton = this.createLeftButton('Clear', () => {\n      self.maskCtx.clearRect(\n        0,\n        0,\n        self.maskCanvas.width,\n        self.maskCanvas.height\n      )\n    })\n\n    this.brush_size_slider = this.createLeftSlider(\n      self,\n      'Thickness',\n      (event) => {\n        self.brush_size = event.target.value\n        self.updateBrushPreview(self)\n      }\n    )\n\n    this.brush_opacity_slider = this.createOpacitySlider(\n      self,\n      'Opacity',\n      (event) => {\n        self.brush_opacity = event.target.value\n        if (self.brush_color_mode !== 'negative') {\n          self.maskCanvas.style.opacity = self.brush_opacity.toString()\n        }\n      }\n    )\n\n    this.colorButton = this.createLeftButton(this.getColorButtonText(), () => {\n      if (self.brush_color_mode === 'black') {\n        self.brush_color_mode = 'white'\n      } else if (self.brush_color_mode === 'white') {\n        self.brush_color_mode = 'negative'\n      } else {\n        self.brush_color_mode = 'black'\n      }\n\n      self.updateWhenBrushColorModeChanged()\n    })\n\n    var cancelButton = this.createRightButton('Cancel', () => {\n      document.removeEventListener('keydown', MaskEditorDialog.handleKeyDown)\n      self.close()\n    })\n\n    this.saveButton = this.createRightButton('Save', () => {\n      document.removeEventListener('keydown', MaskEditorDialog.handleKeyDown)\n      self.save()\n    })\n\n    this.element.appendChild(imgCanvas)\n    this.element.appendChild(maskCanvas)\n    this.element.appendChild(bottom_panel)\n\n    bottom_panel.appendChild(clearButton)\n    bottom_panel.appendChild(this.saveButton)\n    bottom_panel.appendChild(cancelButton)\n    bottom_panel.appendChild(this.brush_size_slider)\n    bottom_panel.appendChild(this.brush_opacity_slider)\n    bottom_panel.appendChild(this.colorButton)\n\n    imgCanvas.style.position = 'absolute'\n    maskCanvas.style.position = 'absolute'\n\n    imgCanvas.style.top = '200'\n    imgCanvas.style.left = '0'\n\n    maskCanvas.style.top = imgCanvas.style.top\n    maskCanvas.style.left = imgCanvas.style.left\n\n    const maskCanvasStyle = this.getMaskCanvasStyle()\n    maskCanvas.style.mixBlendMode = maskCanvasStyle.mixBlendMode\n    maskCanvas.style.opacity = maskCanvasStyle.opacity.toString()\n  }\n\n  async show() {\n    this.zoom_ratio = 1.0\n    this.pan_x = 0\n    this.pan_y = 0\n\n    if (!this.is_layout_created) {\n      // layout\n      const imgCanvas = document.createElement('canvas')\n      const maskCanvas = document.createElement('canvas')\n\n      imgCanvas.id = 'imageCanvas'\n      maskCanvas.id = 'maskCanvas'\n\n      this.setlayout(imgCanvas, maskCanvas)\n\n      // prepare content\n      this.imgCanvas = imgCanvas\n      this.maskCanvas = maskCanvas\n      this.maskCtx = maskCanvas.getContext('2d', { willReadFrequently: true })\n\n      this.setEventHandler(maskCanvas)\n\n      this.is_layout_created = true\n\n      // replacement of onClose hook since close is not real close\n      const self = this\n      const observer = new MutationObserver(function (mutations) {\n        mutations.forEach(function (mutation) {\n          if (\n            mutation.type === 'attributes' &&\n            mutation.attributeName === 'style'\n          ) {\n            if (\n              self.last_display_style &&\n              self.last_display_style != 'none' &&\n              self.element.style.display == 'none'\n            ) {\n              self.brush.style.display = 'none'\n              ComfyApp.onClipspaceEditorClosed()\n            }\n\n            self.last_display_style = self.element.style.display\n          }\n        })\n      })\n\n      const config = { attributes: true }\n      observer.observe(this.element, config)\n    }\n\n    // The keydown event needs to be reconfigured when closing the dialog as it gets removed.\n    document.addEventListener('keydown', MaskEditorDialog.handleKeyDown)\n\n    if (ComfyApp.clipspace_return_node) {\n      this.saveButton.innerText = 'Save to node'\n    } else {\n      this.saveButton.innerText = 'Save'\n    }\n    this.saveButton.disabled = false\n\n    this.element.style.display = 'block'\n    this.element.style.width = '85%'\n    this.element.style.margin = '0 7.5%'\n    this.element.style.height = '100vh'\n    this.element.style.top = '50%'\n    this.element.style.left = '42%'\n    this.element.style.zIndex = '8888' // NOTE: alert dialog must be high priority.\n\n    await this.setImages(this.imgCanvas)\n\n    this.is_visible = true\n  }\n\n  isOpened() {\n    return this.element.style.display == 'block'\n  }\n\n  invalidateCanvas(orig_image, mask_image) {\n    this.imgCanvas.width = orig_image.width\n    this.imgCanvas.height = orig_image.height\n\n    this.maskCanvas.width = orig_image.width\n    this.maskCanvas.height = orig_image.height\n\n    let imgCtx = this.imgCanvas.getContext('2d', { willReadFrequently: true })\n    let maskCtx = this.maskCanvas.getContext('2d', {\n      willReadFrequently: true\n    })\n\n    imgCtx.drawImage(orig_image, 0, 0, orig_image.width, orig_image.height)\n    prepare_mask(mask_image, this.maskCanvas, maskCtx, this.getMaskColor())\n  }\n\n  async setImages(imgCanvas) {\n    let self = this\n\n    const imgCtx = imgCanvas.getContext('2d', { willReadFrequently: true })\n    const maskCtx = this.maskCtx\n    const maskCanvas = this.maskCanvas\n\n    imgCtx.clearRect(0, 0, this.imgCanvas.width, this.imgCanvas.height)\n    maskCtx.clearRect(0, 0, this.maskCanvas.width, this.maskCanvas.height)\n\n    // image load\n    const filepath = ComfyApp.clipspace.images\n\n    const alpha_url = new URL(\n      ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src\n    )\n    alpha_url.searchParams.delete('channel')\n    alpha_url.searchParams.delete('preview')\n    alpha_url.searchParams.set('channel', 'a')\n    let mask_image = await loadImage(alpha_url)\n\n    // original image load\n    const rgb_url = new URL(\n      ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src\n    )\n    rgb_url.searchParams.delete('channel')\n    rgb_url.searchParams.set('channel', 'rgb')\n    this.image = new Image()\n    this.image.onload = function () {\n      maskCanvas.width = self.image.width\n      maskCanvas.height = self.image.height\n\n      self.invalidateCanvas(self.image, mask_image)\n      self.initializeCanvasPanZoom()\n    }\n    this.image.src = rgb_url.toString()\n  }\n\n  initializeCanvasPanZoom() {\n    // set initialize\n    let drawWidth = this.image.width\n    let drawHeight = this.image.height\n\n    let width = this.element.clientWidth\n    let height = this.element.clientHeight\n\n    if (this.image.width > width) {\n      drawWidth = width\n      drawHeight = (drawWidth / this.image.width) * this.image.height\n    }\n\n    if (drawHeight > height) {\n      drawHeight = height\n      drawWidth = (drawHeight / this.image.height) * this.image.width\n    }\n\n    this.zoom_ratio = drawWidth / this.image.width\n\n    const canvasX = (width - drawWidth) / 2\n    const canvasY = (height - drawHeight) / 2\n    this.pan_x = canvasX\n    this.pan_y = canvasY\n\n    this.invalidatePanZoom()\n  }\n\n  invalidatePanZoom() {\n    let raw_width = this.image.width * this.zoom_ratio\n    let raw_height = this.image.height * this.zoom_ratio\n\n    if (this.pan_x + raw_width < 10) {\n      this.pan_x = 10 - raw_width\n    }\n\n    if (this.pan_y + raw_height < 10) {\n      this.pan_y = 10 - raw_height\n    }\n\n    let width = `${raw_width}px`\n    let height = `${raw_height}px`\n\n    let left = `${this.pan_x}px`\n    let top = `${this.pan_y}px`\n\n    this.maskCanvas.style.width = width\n    this.maskCanvas.style.height = height\n    this.maskCanvas.style.left = left\n    this.maskCanvas.style.top = top\n\n    this.imgCanvas.style.width = width\n    this.imgCanvas.style.height = height\n    this.imgCanvas.style.left = left\n    this.imgCanvas.style.top = top\n  }\n\n  setEventHandler(maskCanvas) {\n    const self = this\n\n    if (!this.handler_registered) {\n      maskCanvas.addEventListener('contextmenu', (event) => {\n        event.preventDefault()\n      })\n\n      this.element.addEventListener('wheel', (event) =>\n        this.handleWheelEvent(self, event)\n      )\n      this.element.addEventListener('pointermove', (event) =>\n        this.pointMoveEvent(self, event)\n      )\n      this.element.addEventListener('touchmove', (event) =>\n        this.pointMoveEvent(self, event)\n      )\n\n      this.element.addEventListener('dragstart', (event) => {\n        if (event.ctrlKey) {\n          event.preventDefault()\n        }\n      })\n\n      maskCanvas.addEventListener('pointerdown', (event) =>\n        this.handlePointerDown(self, event)\n      )\n      maskCanvas.addEventListener('pointermove', (event) =>\n        this.draw_move(self, event)\n      )\n      maskCanvas.addEventListener('touchmove', (event) =>\n        this.draw_move(self, event)\n      )\n      maskCanvas.addEventListener('pointerover', (event) => {\n        this.brush.style.display = 'block'\n      })\n      maskCanvas.addEventListener('pointerleave', (event) => {\n        this.brush.style.display = 'none'\n      })\n\n      document.addEventListener('pointerup', MaskEditorDialog.handlePointerUp)\n\n      this.handler_registered = true\n    }\n  }\n\n  getMaskCanvasStyle() {\n    if (this.brush_color_mode === 'negative') {\n      return {\n        mixBlendMode: 'difference',\n        opacity: '1'\n      }\n    } else {\n      return {\n        mixBlendMode: 'initial',\n        opacity: this.brush_opacity\n      }\n    }\n  }\n\n  getMaskColor() {\n    if (this.brush_color_mode === 'black') {\n      return { r: 0, g: 0, b: 0 }\n    }\n    if (this.brush_color_mode === 'white') {\n      return { r: 255, g: 255, b: 255 }\n    }\n    if (this.brush_color_mode === 'negative') {\n      // negative effect only works with white color\n      return { r: 255, g: 255, b: 255 }\n    }\n\n    return { r: 0, g: 0, b: 0 }\n  }\n\n  getMaskFillStyle() {\n    const maskColor = this.getMaskColor()\n\n    return 'rgb(' + maskColor.r + ',' + maskColor.g + ',' + maskColor.b + ')'\n  }\n\n  getColorButtonText() {\n    let colorCaption = 'unknown'\n\n    if (this.brush_color_mode === 'black') {\n      colorCaption = 'black'\n    } else if (this.brush_color_mode === 'white') {\n      colorCaption = 'white'\n    } else if (this.brush_color_mode === 'negative') {\n      colorCaption = 'negative'\n    }\n\n    return 'Color: ' + colorCaption\n  }\n\n  updateWhenBrushColorModeChanged() {\n    this.colorButton.innerText = this.getColorButtonText()\n\n    // update mask canvas css styles\n\n    const maskCanvasStyle = this.getMaskCanvasStyle()\n    this.maskCanvas.style.mixBlendMode = maskCanvasStyle.mixBlendMode\n    this.maskCanvas.style.opacity = maskCanvasStyle.opacity.toString()\n\n    // update mask canvas rgb colors\n\n    const maskColor = this.getMaskColor()\n\n    const maskData = this.maskCtx.getImageData(\n      0,\n      0,\n      this.maskCanvas.width,\n      this.maskCanvas.height\n    )\n\n    for (let i = 0; i < maskData.data.length; i += 4) {\n      maskData.data[i] = maskColor.r\n      maskData.data[i + 1] = maskColor.g\n      maskData.data[i + 2] = maskColor.b\n    }\n\n    this.maskCtx.putImageData(maskData, 0, 0)\n  }\n\n  brush_opacity = 0.7\n  brush_size = 10\n  brush_color_mode = 'black'\n  drawing_mode = false\n  lastx = -1\n  lasty = -1\n  lasttime = 0\n\n  static handleKeyDown(event) {\n    const self = MaskEditorDialog.instance\n    if (event.key === ']') {\n      self.brush_size = Math.min(self.brush_size + 2, 100)\n      self.brush_slider_input.value = self.brush_size\n    } else if (event.key === '[') {\n      self.brush_size = Math.max(self.brush_size - 2, 1)\n      self.brush_slider_input.value = self.brush_size\n    } else if (event.key === 'Enter') {\n      self.save()\n    }\n\n    self.updateBrushPreview(self)\n  }\n\n  static handlePointerUp(event) {\n    event.preventDefault()\n\n    this.mousedown_x = null\n    this.mousedown_y = null\n\n    MaskEditorDialog.instance.drawing_mode = false\n  }\n\n  updateBrushPreview(self) {\n    const brush = self.brush\n\n    var centerX = self.cursorX\n    var centerY = self.cursorY\n\n    brush.style.width = self.brush_size * 2 * this.zoom_ratio + 'px'\n    brush.style.height = self.brush_size * 2 * this.zoom_ratio + 'px'\n    brush.style.left = centerX - self.brush_size * this.zoom_ratio + 'px'\n    brush.style.top = centerY - self.brush_size * this.zoom_ratio + 'px'\n  }\n\n  handleWheelEvent(self, event) {\n    event.preventDefault()\n\n    if (event.ctrlKey) {\n      // zoom canvas\n      if (event.deltaY < 0) {\n        this.zoom_ratio = Math.min(10.0, this.zoom_ratio + 0.2)\n      } else {\n        this.zoom_ratio = Math.max(0.2, this.zoom_ratio - 0.2)\n      }\n\n      this.invalidatePanZoom()\n    } else {\n      // adjust brush size\n      if (event.deltaY < 0) this.brush_size = Math.min(this.brush_size + 2, 100)\n      else this.brush_size = Math.max(this.brush_size - 2, 1)\n\n      this.brush_slider_input.value = this.brush_size.toString()\n\n      this.updateBrushPreview(this)\n    }\n  }\n\n  pointMoveEvent(self, event) {\n    this.cursorX = event.pageX\n    this.cursorY = event.pageY\n\n    self.updateBrushPreview(self)\n\n    if (event.ctrlKey) {\n      event.preventDefault()\n      self.pan_move(self, event)\n    }\n\n    let left_button_down =\n      (window.TouchEvent && event instanceof TouchEvent) || event.buttons == 1\n\n    if (event.shiftKey && left_button_down) {\n      self.drawing_mode = false\n\n      const y = event.clientY\n      let delta = (self.zoom_lasty - y) * 0.005\n      self.zoom_ratio = Math.max(\n        Math.min(10.0, self.last_zoom_ratio - delta),\n        0.2\n      )\n\n      this.invalidatePanZoom()\n      return\n    }\n  }\n\n  pan_move(self, event) {\n    if (event.buttons == 1) {\n      if (MaskEditorDialog.mousedown_x) {\n        let deltaX = MaskEditorDialog.mousedown_x - event.clientX\n        let deltaY = MaskEditorDialog.mousedown_y - event.clientY\n\n        self.pan_x = this.mousedown_pan_x - deltaX\n        self.pan_y = this.mousedown_pan_y - deltaY\n\n        self.invalidatePanZoom()\n      }\n    }\n  }\n\n  draw_move(self, event) {\n    if (event.ctrlKey || event.shiftKey) {\n      return\n    }\n\n    event.preventDefault()\n\n    this.cursorX = event.pageX\n    this.cursorY = event.pageY\n\n    self.updateBrushPreview(self)\n\n    let left_button_down =\n      (window.TouchEvent && event instanceof TouchEvent) || event.buttons == 1\n    let right_button_down = [2, 5, 32].includes(event.buttons)\n\n    if (!event.altKey && left_button_down) {\n      var diff = performance.now() - self.lasttime\n\n      const maskRect = self.maskCanvas.getBoundingClientRect()\n\n      var x = event.offsetX\n      var y = event.offsetY\n\n      if (event.offsetX == null) {\n        x = event.targetTouches[0].clientX - maskRect.left\n      }\n\n      if (event.offsetY == null) {\n        y = event.targetTouches[0].clientY - maskRect.top\n      }\n\n      x /= self.zoom_ratio\n      y /= self.zoom_ratio\n\n      var brush_size = this.brush_size\n      if (event instanceof PointerEvent && event.pointerType == 'pen') {\n        brush_size *= event.pressure\n        this.last_pressure = event.pressure\n      } else if (\n        window.TouchEvent &&\n        event instanceof TouchEvent &&\n        diff < 20\n      ) {\n        // The firing interval of PointerEvents in Pen is unreliable, so it is supplemented by TouchEvents.\n        brush_size *= this.last_pressure\n      } else {\n        brush_size = this.brush_size\n      }\n\n      if (diff > 20 && !this.drawing_mode)\n        requestAnimationFrame(() => {\n          self.maskCtx.beginPath()\n          self.maskCtx.fillStyle = this.getMaskFillStyle()\n          self.maskCtx.globalCompositeOperation = 'source-over'\n          self.maskCtx.arc(x, y, brush_size, 0, Math.PI * 2, false)\n          self.maskCtx.fill()\n          self.lastx = x\n          self.lasty = y\n        })\n      else\n        requestAnimationFrame(() => {\n          self.maskCtx.beginPath()\n          self.maskCtx.fillStyle = this.getMaskFillStyle()\n          self.maskCtx.globalCompositeOperation = 'source-over'\n\n          var dx = x - self.lastx\n          var dy = y - self.lasty\n\n          var distance = Math.sqrt(dx * dx + dy * dy)\n          var directionX = dx / distance\n          var directionY = dy / distance\n\n          for (var i = 0; i < distance; i += 5) {\n            var px = self.lastx + directionX * i\n            var py = self.lasty + directionY * i\n            self.maskCtx.arc(px, py, brush_size, 0, Math.PI * 2, false)\n            self.maskCtx.fill()\n          }\n          self.lastx = x\n          self.lasty = y\n        })\n\n      self.lasttime = performance.now()\n    } else if ((event.altKey && left_button_down) || right_button_down) {\n      const maskRect = self.maskCanvas.getBoundingClientRect()\n      const x =\n        (event.offsetX || event.targetTouches[0].clientX - maskRect.left) /\n        self.zoom_ratio\n      const y =\n        (event.offsetY || event.targetTouches[0].clientY - maskRect.top) /\n        self.zoom_ratio\n\n      var brush_size = this.brush_size\n      if (event instanceof PointerEvent && event.pointerType == 'pen') {\n        brush_size *= event.pressure\n        this.last_pressure = event.pressure\n      } else if (\n        window.TouchEvent &&\n        event instanceof TouchEvent &&\n        diff < 20\n      ) {\n        brush_size *= this.last_pressure\n      } else {\n        brush_size = this.brush_size\n      }\n\n      if (diff > 20 && !this.drawing_mode)\n        // cannot tracking drawing_mode for touch event\n        requestAnimationFrame(() => {\n          self.maskCtx.beginPath()\n          self.maskCtx.globalCompositeOperation = 'destination-out'\n          self.maskCtx.arc(x, y, brush_size, 0, Math.PI * 2, false)\n          self.maskCtx.fill()\n          self.lastx = x\n          self.lasty = y\n        })\n      else\n        requestAnimationFrame(() => {\n          self.maskCtx.beginPath()\n          self.maskCtx.globalCompositeOperation = 'destination-out'\n\n          var dx = x - self.lastx\n          var dy = y - self.lasty\n\n          var distance = Math.sqrt(dx * dx + dy * dy)\n          var directionX = dx / distance\n          var directionY = dy / distance\n\n          for (var i = 0; i < distance; i += 5) {\n            var px = self.lastx + directionX * i\n            var py = self.lasty + directionY * i\n            self.maskCtx.arc(px, py, brush_size, 0, Math.PI * 2, false)\n            self.maskCtx.fill()\n          }\n          self.lastx = x\n          self.lasty = y\n        })\n\n      self.lasttime = performance.now()\n    }\n  }\n\n  handlePointerDown(self, event) {\n    if (event.ctrlKey) {\n      if (event.buttons == 1) {\n        MaskEditorDialog.mousedown_x = event.clientX\n        MaskEditorDialog.mousedown_y = event.clientY\n\n        this.mousedown_pan_x = this.pan_x\n        this.mousedown_pan_y = this.pan_y\n      }\n      return\n    }\n\n    var brush_size = this.brush_size\n    if (event instanceof PointerEvent && event.pointerType == 'pen') {\n      brush_size *= event.pressure\n      this.last_pressure = event.pressure\n    }\n\n    if ([0, 2, 5].includes(event.button)) {\n      self.drawing_mode = true\n\n      event.preventDefault()\n\n      if (event.shiftKey) {\n        self.zoom_lasty = event.clientY\n        self.last_zoom_ratio = self.zoom_ratio\n        return\n      }\n\n      const maskRect = self.maskCanvas.getBoundingClientRect()\n      const x =\n        (event.offsetX || event.targetTouches[0].clientX - maskRect.left) /\n        self.zoom_ratio\n      const y =\n        (event.offsetY || event.targetTouches[0].clientY - maskRect.top) /\n        self.zoom_ratio\n\n      self.maskCtx.beginPath()\n      if (!event.altKey && event.button == 0) {\n        self.maskCtx.fillStyle = this.getMaskFillStyle()\n        self.maskCtx.globalCompositeOperation = 'source-over'\n      } else {\n        self.maskCtx.globalCompositeOperation = 'destination-out'\n      }\n      self.maskCtx.arc(x, y, brush_size, 0, Math.PI * 2, false)\n      self.maskCtx.fill()\n      self.lastx = x\n      self.lasty = y\n      self.lasttime = performance.now()\n    }\n  }\n\n  async save() {\n    const backupCanvas = document.createElement('canvas')\n    const backupCtx = backupCanvas.getContext('2d', {\n      willReadFrequently: true\n    })\n    backupCanvas.width = this.image.width\n    backupCanvas.height = this.image.height\n\n    backupCtx.clearRect(0, 0, backupCanvas.width, backupCanvas.height)\n    backupCtx.drawImage(\n      this.maskCanvas,\n      0,\n      0,\n      this.maskCanvas.width,\n      this.maskCanvas.height,\n      0,\n      0,\n      backupCanvas.width,\n      backupCanvas.height\n    )\n\n    // paste mask data into alpha channel\n    const backupData = backupCtx.getImageData(\n      0,\n      0,\n      backupCanvas.width,\n      backupCanvas.height\n    )\n\n    // refine mask image\n    for (let i = 0; i < backupData.data.length; i += 4) {\n      if (backupData.data[i + 3] == 255) backupData.data[i + 3] = 0\n      else backupData.data[i + 3] = 255\n\n      backupData.data[i] = 0\n      backupData.data[i + 1] = 0\n      backupData.data[i + 2] = 0\n    }\n\n    backupCtx.globalCompositeOperation = 'source-over'\n    backupCtx.putImageData(backupData, 0, 0)\n\n    const formData = new FormData()\n    const filename = 'clipspace-mask-' + performance.now() + '.png'\n\n    const item = {\n      filename: filename,\n      subfolder: 'clipspace',\n      type: 'input'\n    }\n\n    if (ComfyApp.clipspace.images) ComfyApp.clipspace.images[0] = item\n\n    if (ComfyApp.clipspace.widgets) {\n      const index = ComfyApp.clipspace.widgets.findIndex(\n        (obj) => obj.name === 'image'\n      )\n\n      if (index >= 0) ComfyApp.clipspace.widgets[index].value = item\n    }\n\n    const dataURL = backupCanvas.toDataURL()\n    const blob = dataURLToBlob(dataURL)\n\n    let original_url = new URL(this.image.src)\n\n    type Ref = { filename: string; subfolder?: string; type?: string }\n\n    const original_ref: Ref = {\n      filename: original_url.searchParams.get('filename')\n    }\n\n    let original_subfolder = original_url.searchParams.get('subfolder')\n    if (original_subfolder) original_ref.subfolder = original_subfolder\n\n    let original_type = original_url.searchParams.get('type')\n    if (original_type) original_ref.type = original_type\n\n    formData.append('image', blob, filename)\n    formData.append('original_ref', JSON.stringify(original_ref))\n    formData.append('type', 'input')\n    formData.append('subfolder', 'clipspace')\n\n    this.saveButton.innerText = 'Saving...'\n    this.saveButton.disabled = true\n    await uploadMask(item, formData)\n    ComfyApp.onClipspaceEditorSave()\n    this.close()\n  }\n}\n\napp.registerExtension({\n  name: 'Comfy.MaskEditor',\n  init(app) {\n    ComfyApp.open_maskeditor = function () {\n      const dlg = MaskEditorDialog.getInstance()\n      if (!dlg.isOpened()) {\n        dlg.show()\n      }\n    }\n\n    const context_predicate = () =>\n      ComfyApp.clipspace &&\n      ComfyApp.clipspace.imgs &&\n      ComfyApp.clipspace.imgs.length > 0\n    ClipspaceDialog.registerButton(\n      'MaskEditor',\n      context_predicate,\n      ComfyApp.open_maskeditor\n    )\n  }\n})\n","import { app } from '../../scripts/app'\nimport { api } from '../../scripts/api'\nimport { ComfyDialog, $el } from '../../scripts/ui'\nimport { GroupNodeConfig, GroupNodeHandler } from './groupNode'\nimport { LGraphCanvas } from '@comfyorg/litegraph'\n\n// Adds the ability to save and add multiple nodes as a template\n// To save:\n// Select multiple nodes (ctrl + drag to select a region or ctrl+click individual nodes)\n// Right click the canvas\n// Save Node Template -> give it a name\n//\n// To add:\n// Right click the canvas\n// Node templates -> click the one to add\n//\n// To delete/rename:\n// Right click the canvas\n// Node templates -> Manage\n//\n// To rearrange:\n// Open the manage dialog and Drag and drop elements using the \"Name:\" label as handle\n\nconst id = 'Comfy.NodeTemplates'\nconst file = 'comfy.templates.json'\n\nclass ManageTemplates extends ComfyDialog {\n  templates: any[]\n  draggedEl: HTMLElement | null\n  saveVisualCue: number | null\n  emptyImg: HTMLImageElement\n  importInput: HTMLInputElement\n\n  constructor() {\n    super()\n    this.load().then((v) => {\n      this.templates = v\n    })\n\n    this.element.classList.add('comfy-manage-templates')\n    this.draggedEl = null\n    this.saveVisualCue = null\n    this.emptyImg = new Image()\n    this.emptyImg.src =\n      'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs='\n\n    this.importInput = $el('input', {\n      type: 'file',\n      accept: '.json',\n      multiple: true,\n      style: { display: 'none' },\n      parent: document.body,\n      onchange: () => this.importAll()\n    }) as HTMLInputElement\n  }\n\n  createButtons() {\n    const btns = super.createButtons()\n    btns[0].textContent = 'Close'\n    btns[0].onclick = (e) => {\n      clearTimeout(this.saveVisualCue)\n      this.close()\n    }\n    btns.unshift(\n      $el('button', {\n        type: 'button',\n        textContent: 'Export',\n        onclick: () => this.exportAll()\n      })\n    )\n    btns.unshift(\n      $el('button', {\n        type: 'button',\n        textContent: 'Import',\n        onclick: () => {\n          this.importInput.click()\n        }\n      })\n    )\n    return btns\n  }\n\n  async load() {\n    let templates = []\n    if (app.storageLocation === 'server') {\n      if (app.isNewUserSession) {\n        // New user so migrate existing templates\n        const json = localStorage.getItem(id)\n        if (json) {\n          templates = JSON.parse(json)\n        }\n        await api.storeUserData(file, json, { stringify: false })\n      } else {\n        const res = await api.getUserData(file)\n        if (res.status === 200) {\n          try {\n            templates = await res.json()\n          } catch (error) {}\n        } else if (res.status !== 404) {\n          console.error(res.status + ' ' + res.statusText)\n        }\n      }\n    } else {\n      const json = localStorage.getItem(id)\n      if (json) {\n        templates = JSON.parse(json)\n      }\n    }\n\n    return templates ?? []\n  }\n\n  async store() {\n    if (app.storageLocation === 'server') {\n      const templates = JSON.stringify(this.templates, undefined, 4)\n      localStorage.setItem(id, templates) // Backwards compatibility\n      try {\n        await api.storeUserData(file, templates, { stringify: false })\n      } catch (error) {\n        console.error(error)\n        alert(error.message)\n      }\n    } else {\n      localStorage.setItem(id, JSON.stringify(this.templates))\n    }\n  }\n\n  async importAll() {\n    for (const file of this.importInput.files) {\n      if (file.type === 'application/json' || file.name.endsWith('.json')) {\n        const reader = new FileReader()\n        reader.onload = async () => {\n          const importFile = JSON.parse(reader.result as string)\n          if (importFile?.templates) {\n            for (const template of importFile.templates) {\n              if (template?.name && template?.data) {\n                this.templates.push(template)\n              }\n            }\n            await this.store()\n          }\n        }\n        await reader.readAsText(file)\n      }\n    }\n\n    this.importInput.value = null\n\n    this.close()\n  }\n\n  exportAll() {\n    if (this.templates.length == 0) {\n      alert('No templates to export.')\n      return\n    }\n\n    const json = JSON.stringify({ templates: this.templates }, null, 2) // convert the data to a JSON string\n    const blob = new Blob([json], { type: 'application/json' })\n    const url = URL.createObjectURL(blob)\n    const a = $el('a', {\n      href: url,\n      download: 'node_templates.json',\n      style: { display: 'none' },\n      parent: document.body\n    })\n    a.click()\n    setTimeout(function () {\n      a.remove()\n      window.URL.revokeObjectURL(url)\n    }, 0)\n  }\n\n  show() {\n    // Show list of template names + delete button\n    super.show(\n      $el(\n        'div',\n        {},\n        this.templates.flatMap((t, i) => {\n          let nameInput\n          return [\n            $el(\n              'div',\n              {\n                dataset: { id: i.toString() },\n                className: 'templateManagerRow',\n                style: {\n                  display: 'grid',\n                  gridTemplateColumns: '1fr auto',\n                  border: '1px dashed transparent',\n                  gap: '5px',\n                  backgroundColor: 'var(--comfy-menu-bg)'\n                },\n                ondragstart: (e) => {\n                  this.draggedEl = e.currentTarget\n                  e.currentTarget.style.opacity = '0.6'\n                  e.currentTarget.style.border = '1px dashed yellow'\n                  e.dataTransfer.effectAllowed = 'move'\n                  e.dataTransfer.setDragImage(this.emptyImg, 0, 0)\n                },\n                ondragend: (e) => {\n                  e.target.style.opacity = '1'\n                  e.currentTarget.style.border = '1px dashed transparent'\n                  e.currentTarget.removeAttribute('draggable')\n\n                  // rearrange the elements\n                  this.element\n                    .querySelectorAll('.templateManagerRow')\n                    .forEach((el: HTMLElement, i) => {\n                      var prev_i = Number.parseInt(el.dataset.id)\n\n                      if (el == this.draggedEl && prev_i != i) {\n                        this.templates.splice(\n                          i,\n                          0,\n                          this.templates.splice(prev_i, 1)[0]\n                        )\n                      }\n                      el.dataset.id = i.toString()\n                    })\n                  this.store()\n                },\n                ondragover: (e) => {\n                  e.preventDefault()\n                  if (e.currentTarget == this.draggedEl) return\n\n                  let rect = e.currentTarget.getBoundingClientRect()\n                  if (e.clientY > rect.top + rect.height / 2) {\n                    e.currentTarget.parentNode.insertBefore(\n                      this.draggedEl,\n                      e.currentTarget.nextSibling\n                    )\n                  } else {\n                    e.currentTarget.parentNode.insertBefore(\n                      this.draggedEl,\n                      e.currentTarget\n                    )\n                  }\n                }\n              },\n              [\n                $el(\n                  'label',\n                  {\n                    textContent: 'Name: ',\n                    style: {\n                      cursor: 'grab'\n                    },\n                    onmousedown: (e) => {\n                      // enable dragging only from the label\n                      if (e.target.localName == 'label')\n                        e.currentTarget.parentNode.draggable = 'true'\n                    }\n                  },\n                  [\n                    $el('input', {\n                      value: t.name,\n                      dataset: { name: t.name },\n                      style: {\n                        transitionProperty: 'background-color',\n                        transitionDuration: '0s'\n                      },\n                      onchange: (e) => {\n                        clearTimeout(this.saveVisualCue)\n                        var el = e.target\n                        var row = el.parentNode.parentNode\n                        this.templates[row.dataset.id].name =\n                          el.value.trim() || 'untitled'\n                        this.store()\n                        el.style.backgroundColor = 'rgb(40, 95, 40)'\n                        el.style.transitionDuration = '0s'\n                        // @ts-expect-error\n                        // In browser env the return value is number.\n                        this.saveVisualCue = setTimeout(function () {\n                          el.style.transitionDuration = '.7s'\n                          el.style.backgroundColor = 'var(--comfy-input-bg)'\n                        }, 15)\n                      },\n                      onkeypress: (e) => {\n                        var el = e.target\n                        clearTimeout(this.saveVisualCue)\n                        el.style.transitionDuration = '0s'\n                        el.style.backgroundColor = 'var(--comfy-input-bg)'\n                      },\n                      $: (el) => (nameInput = el)\n                    })\n                  ]\n                ),\n                $el('div', {}, [\n                  $el('button', {\n                    textContent: 'Export',\n                    style: {\n                      fontSize: '12px',\n                      fontWeight: 'normal'\n                    },\n                    onclick: (e) => {\n                      const json = JSON.stringify({ templates: [t] }, null, 2) // convert the data to a JSON string\n                      const blob = new Blob([json], {\n                        type: 'application/json'\n                      })\n                      const url = URL.createObjectURL(blob)\n                      const a = $el('a', {\n                        href: url,\n                        download: (nameInput.value || t.name) + '.json',\n                        style: { display: 'none' },\n                        parent: document.body\n                      })\n                      a.click()\n                      setTimeout(function () {\n                        a.remove()\n                        window.URL.revokeObjectURL(url)\n                      }, 0)\n                    }\n                  }),\n                  $el('button', {\n                    textContent: 'Delete',\n                    style: {\n                      fontSize: '12px',\n                      color: 'red',\n                      fontWeight: 'normal'\n                    },\n                    onclick: (e) => {\n                      const item = e.target.parentNode.parentNode\n                      item.parentNode.removeChild(item)\n                      this.templates.splice(item.dataset.id * 1, 1)\n                      this.store()\n                      // update the rows index, setTimeout ensures that the list is updated\n                      var that = this\n                      setTimeout(function () {\n                        that.element\n                          .querySelectorAll('.templateManagerRow')\n                          .forEach((el: HTMLElement, i) => {\n                            el.dataset.id = i.toString()\n                          })\n                      }, 0)\n                    }\n                  })\n                ])\n              ]\n            )\n          ]\n        })\n      )\n    )\n  }\n}\n\napp.registerExtension({\n  name: id,\n  setup() {\n    const manage = new ManageTemplates()\n\n    const clipboardAction = async (cb) => {\n      // We use the clipboard functions but dont want to overwrite the current user clipboard\n      // Restore it after we've run our callback\n      const old = localStorage.getItem('litegrapheditor_clipboard')\n      await cb()\n      localStorage.setItem('litegrapheditor_clipboard', old)\n    }\n\n    const orig = LGraphCanvas.prototype.getCanvasMenuOptions\n    LGraphCanvas.prototype.getCanvasMenuOptions = function () {\n      const options = orig.apply(this, arguments)\n\n      options.push(null)\n      options.push({\n        content: `Save Selected as Template`,\n        disabled: !Object.keys(app.canvas.selected_nodes || {}).length,\n        callback: () => {\n          const name = prompt('Enter name')\n          if (!name?.trim()) return\n\n          clipboardAction(() => {\n            app.canvas.copyToClipboard()\n            let data = localStorage.getItem('litegrapheditor_clipboard')\n            data = JSON.parse(data)\n            const nodeIds = Object.keys(app.canvas.selected_nodes)\n            for (let i = 0; i < nodeIds.length; i++) {\n              const node = app.graph.getNodeById(Number.parseInt(nodeIds[i]))\n              // @ts-expect-error\n              const nodeData = node?.constructor.nodeData\n\n              let groupData = GroupNodeHandler.getGroupData(node)\n              if (groupData) {\n                groupData = groupData.nodeData\n                // @ts-expect-error\n                if (!data.groupNodes) {\n                  // @ts-expect-error\n                  data.groupNodes = {}\n                }\n                // @ts-expect-error\n                data.groupNodes[nodeData.name] = groupData\n                // @ts-expect-error\n                data.nodes[i].type = nodeData.name\n              }\n            }\n\n            manage.templates.push({\n              name,\n              data: JSON.stringify(data)\n            })\n            manage.store()\n          })\n        }\n      })\n\n      // Map each template to a menu item\n      const subItems = manage.templates.map((t) => {\n        return {\n          content: t.name,\n          callback: () => {\n            clipboardAction(async () => {\n              const data = JSON.parse(t.data)\n              await GroupNodeConfig.registerFromWorkflow(data.groupNodes, {})\n              localStorage.setItem('litegrapheditor_clipboard', t.data)\n              app.canvas.pasteFromClipboard()\n            })\n          }\n        }\n      })\n\n      subItems.push(null, {\n        content: 'Manage',\n        callback: () => manage.show()\n      })\n\n      options.push({\n        content: 'Node Templates',\n        submenu: {\n          options: subItems\n        }\n      })\n\n      return options\n    }\n  }\n})\n","import { LiteGraph, LGraphCanvas } from '@comfyorg/litegraph'\nimport { app } from '../../scripts/app'\nimport { ComfyWidgets } from '../../scripts/widgets'\n// Node that add notes to your project\n\napp.registerExtension({\n  name: 'Comfy.NoteNode',\n  registerCustomNodes() {\n    class NoteNode {\n      static category: string\n\n      color = LGraphCanvas.node_colors.yellow.color\n      bgcolor = LGraphCanvas.node_colors.yellow.bgcolor\n      groupcolor = LGraphCanvas.node_colors.yellow.groupcolor\n      properties: { text: string }\n      serialize_widgets: boolean\n      isVirtualNode: boolean\n      collapsable: boolean\n      title_mode: number\n\n      constructor() {\n        if (!this.properties) {\n          this.properties = { text: '' }\n        }\n        ComfyWidgets.STRING(\n          // @ts-expect-error\n          // Should we extends LGraphNode?\n          this,\n          '',\n          ['', { default: this.properties.text, multiline: true }],\n          app\n        )\n\n        this.serialize_widgets = true\n        this.isVirtualNode = true\n      }\n    }\n\n    // Load default visibility\n\n    LiteGraph.registerNodeType(\n      'Note',\n      // @ts-expect-error\n      Object.assign(NoteNode, {\n        title_mode: LiteGraph.NORMAL_TITLE,\n        title: 'Note',\n        collapsable: true\n      })\n    )\n\n    NoteNode.category = 'utils'\n  }\n})\n","import { app } from '../../scripts/app'\nimport { mergeIfValid, getWidgetConfig, setWidgetConfig } from './widgetInputs'\nimport { LiteGraph, LGraphCanvas, LGraphNode } from '@comfyorg/litegraph'\n\n// Node that allows you to redirect connections for cleaner graphs\n\napp.registerExtension({\n  name: 'Comfy.RerouteNode',\n  registerCustomNodes(app) {\n    interface RerouteNode extends LGraphNode {\n      __outputType?: string\n    }\n\n    class RerouteNode {\n      static category: string | undefined\n      static defaultVisibility = false\n\n      constructor() {\n        if (!this.properties) {\n          this.properties = {}\n        }\n        this.properties.showOutputText = RerouteNode.defaultVisibility\n        this.properties.horizontal = false\n\n        this.addInput('', '*')\n        this.addOutput(this.properties.showOutputText ? '*' : '', '*')\n\n        this.onAfterGraphConfigured = function () {\n          requestAnimationFrame(() => {\n            this.onConnectionsChange(LiteGraph.INPUT, null, true, null)\n          })\n        }\n\n        this.onConnectionsChange = function (\n          type,\n          index,\n          connected,\n          link_info\n        ) {\n          this.applyOrientation()\n\n          // Prevent multiple connections to different types when we have no input\n          if (connected && type === LiteGraph.OUTPUT) {\n            // Ignore wildcard nodes as these will be updated to real types\n            const types = new Set(\n              this.outputs[0].links\n                .map((l) => app.graph.links[l].type)\n                .filter((t) => t !== '*')\n            )\n            if (types.size > 1) {\n              const linksToDisconnect = []\n              for (let i = 0; i < this.outputs[0].links.length - 1; i++) {\n                const linkId = this.outputs[0].links[i]\n                const link = app.graph.links[linkId]\n                linksToDisconnect.push(link)\n              }\n              for (const link of linksToDisconnect) {\n                const node = app.graph.getNodeById(link.target_id)\n                node.disconnectInput(link.target_slot)\n              }\n            }\n          }\n\n          // Find root input\n          let currentNode = this\n          let updateNodes = []\n          let inputType = null\n          let inputNode = null\n          while (currentNode) {\n            updateNodes.unshift(currentNode)\n            const linkId = currentNode.inputs[0].link\n            if (linkId !== null) {\n              const link = app.graph.links[linkId]\n              if (!link) return\n              const node = app.graph.getNodeById(link.origin_id)\n              const type = node.constructor.type\n              if (type === 'Reroute') {\n                if (node === this) {\n                  // We've found a circle\n                  currentNode.disconnectInput(link.target_slot)\n                  currentNode = null\n                } else {\n                  // Move the previous node\n                  currentNode = node\n                }\n              } else {\n                // We've found the end\n                inputNode = currentNode\n                inputType = node.outputs[link.origin_slot]?.type ?? null\n                break\n              }\n            } else {\n              // This path has no input node\n              currentNode = null\n              break\n            }\n          }\n\n          // Find all outputs\n          const nodes = [this]\n          let outputType = null\n          while (nodes.length) {\n            currentNode = nodes.pop()\n            const outputs =\n              (currentNode.outputs ? currentNode.outputs[0].links : []) || []\n            if (outputs.length) {\n              for (const linkId of outputs) {\n                const link = app.graph.links[linkId]\n\n                // When disconnecting sometimes the link is still registered\n                if (!link) continue\n\n                const node = app.graph.getNodeById(link.target_id)\n                const type = node.constructor.type\n\n                if (type === 'Reroute') {\n                  // Follow reroute nodes\n                  nodes.push(node)\n                  updateNodes.push(node)\n                } else {\n                  // We've found an output\n                  const nodeOutType =\n                    node.inputs &&\n                    node.inputs[link?.target_slot] &&\n                    node.inputs[link.target_slot].type\n                      ? node.inputs[link.target_slot].type\n                      : null\n                  if (\n                    inputType &&\n                    inputType !== '*' &&\n                    nodeOutType !== inputType\n                  ) {\n                    // The output doesnt match our input so disconnect it\n                    node.disconnectInput(link.target_slot)\n                  } else {\n                    outputType = nodeOutType\n                  }\n                }\n              }\n            } else {\n              // No more outputs for this path\n            }\n          }\n\n          const displayType = inputType || outputType || '*'\n          const color = LGraphCanvas.link_type_colors[displayType]\n\n          let widgetConfig\n          let targetWidget\n          let widgetType\n          // Update the types of each node\n          for (const node of updateNodes) {\n            // If we dont have an input type we are always wildcard but we'll show the output type\n            // This lets you change the output link to a different type and all nodes will update\n            node.outputs[0].type = inputType || '*'\n            node.__outputType = displayType\n            node.outputs[0].name = node.properties.showOutputText\n              ? displayType\n              : ''\n            node.size = node.computeSize()\n            node.applyOrientation()\n\n            for (const l of node.outputs[0].links || []) {\n              const link = app.graph.links[l]\n              if (link) {\n                link.color = color\n\n                if (app.configuringGraph) continue\n                const targetNode = app.graph.getNodeById(link.target_id)\n                const targetInput = targetNode.inputs?.[link.target_slot]\n                if (targetInput?.widget) {\n                  const config = getWidgetConfig(targetInput)\n                  if (!widgetConfig) {\n                    widgetConfig = config[1] ?? {}\n                    widgetType = config[0]\n                  }\n                  if (!targetWidget) {\n                    targetWidget = targetNode.widgets?.find(\n                      (w) => w.name === targetInput.widget.name\n                    )\n                  }\n\n                  const merged = mergeIfValid(targetInput, [\n                    config[0],\n                    widgetConfig\n                  ])\n                  if (merged.customConfig) {\n                    widgetConfig = merged.customConfig\n                  }\n                }\n              }\n            }\n          }\n\n          for (const node of updateNodes) {\n            if (widgetConfig && outputType) {\n              node.inputs[0].widget = { name: 'value' }\n              setWidgetConfig(\n                node.inputs[0],\n                [widgetType ?? displayType, widgetConfig],\n                targetWidget\n              )\n            } else {\n              setWidgetConfig(node.inputs[0], null)\n            }\n          }\n\n          if (inputNode) {\n            const link = app.graph.links[inputNode.inputs[0].link]\n            if (link) {\n              link.color = color\n            }\n          }\n        }\n\n        this.clone = function () {\n          const cloned = RerouteNode.prototype.clone.apply(this)\n          cloned.removeOutput(0)\n          cloned.addOutput(this.properties.showOutputText ? '*' : '', '*')\n          cloned.size = cloned.computeSize()\n          return cloned\n        }\n\n        // This node is purely frontend and does not impact the resulting prompt so should not be serialized\n        this.isVirtualNode = true\n      }\n\n      getExtraMenuOptions(_, options) {\n        options.unshift(\n          {\n            content:\n              (this.properties.showOutputText ? 'Hide' : 'Show') + ' Type',\n            callback: () => {\n              this.properties.showOutputText = !this.properties.showOutputText\n              if (this.properties.showOutputText) {\n                this.outputs[0].name =\n                  this.__outputType || (this.outputs[0].type as string)\n              } else {\n                this.outputs[0].name = ''\n              }\n              this.size = this.computeSize()\n              this.applyOrientation()\n              app.graph.setDirtyCanvas(true, true)\n            }\n          },\n          {\n            content:\n              (RerouteNode.defaultVisibility ? 'Hide' : 'Show') +\n              ' Type By Default',\n            callback: () => {\n              RerouteNode.setDefaultTextVisibility(\n                !RerouteNode.defaultVisibility\n              )\n            }\n          },\n          {\n            // naming is inverted with respect to LiteGraphNode.horizontal\n            // LiteGraphNode.horizontal == true means that\n            // each slot in the inputs and outputs are laid out horizontally,\n            // which is the opposite of the visual orientation of the inputs and outputs as a node\n            content:\n              'Set ' + (this.properties.horizontal ? 'Horizontal' : 'Vertical'),\n            callback: () => {\n              this.properties.horizontal = !this.properties.horizontal\n              this.applyOrientation()\n            }\n          }\n        )\n      }\n      applyOrientation() {\n        this.horizontal = this.properties.horizontal\n        if (this.horizontal) {\n          // we correct the input position, because LiteGraphNode.horizontal\n          // doesn't account for title presence\n          // which reroute nodes don't have\n          this.inputs[0].pos = [this.size[0] / 2, 0]\n        } else {\n          delete this.inputs[0].pos\n        }\n        app.graph.setDirtyCanvas(true, true)\n      }\n\n      computeSize(): [number, number] {\n        return [\n          this.properties.showOutputText && this.outputs && this.outputs.length\n            ? Math.max(\n                75,\n                LiteGraph.NODE_TEXT_SIZE * this.outputs[0].name.length * 0.6 +\n                  40\n              )\n            : 75,\n          26\n        ]\n      }\n\n      static setDefaultTextVisibility(visible) {\n        RerouteNode.defaultVisibility = visible\n        if (visible) {\n          localStorage['Comfy.RerouteNode.DefaultVisibility'] = 'true'\n        } else {\n          delete localStorage['Comfy.RerouteNode.DefaultVisibility']\n        }\n      }\n    }\n\n    // Load default visibility\n    RerouteNode.setDefaultTextVisibility(\n      !!localStorage['Comfy.RerouteNode.DefaultVisibility']\n    )\n\n    LiteGraph.registerNodeType(\n      'Reroute',\n      Object.assign(RerouteNode, {\n        title_mode: LiteGraph.NO_TITLE,\n        title: 'Reroute',\n        collapsable: false\n      })\n    )\n\n    RerouteNode.category = 'utils'\n  }\n})\n","import { app } from '../../scripts/app'\nimport { applyTextReplacements } from '../../scripts/utils'\n// Use widget values and dates in output filenames\n\napp.registerExtension({\n  name: 'Comfy.SaveImageExtraOutput',\n  async beforeRegisterNodeDef(nodeType, nodeData, app) {\n    if (nodeData.name === 'SaveImage' || nodeData.name === 'SaveAnimatedWEBP') {\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n      // When the SaveImage node is created we want to override the serialization of the output name widget to run our S&R\n      nodeType.prototype.onNodeCreated = function () {\n        const r = onNodeCreated\n          ? onNodeCreated.apply(this, arguments)\n          : undefined\n\n        const widget = this.widgets.find((w) => w.name === 'filename_prefix')\n        widget.serializeValue = () => {\n          return applyTextReplacements(app, widget.value)\n        }\n\n        return r\n      }\n    } else {\n      // When any other node is created add a property to alias the node\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n      nodeType.prototype.onNodeCreated = function () {\n        const r = onNodeCreated\n          ? onNodeCreated.apply(this, arguments)\n          : undefined\n\n        if (!this.properties || !('Node name for S&R' in this.properties)) {\n          this.addProperty('Node name for S&R', this.constructor.type, 'string')\n        }\n\n        return r\n      }\n    }\n  }\n})\n","import { app } from '../../scripts/app'\nimport { LGraphCanvas, LiteGraph } from '@comfyorg/litegraph'\n\nlet touchZooming\nlet touchCount = 0\n\napp.registerExtension({\n  name: 'Comfy.SimpleTouchSupport',\n  setup() {\n    let zoomPos\n    let touchTime\n    let lastTouch\n\n    function getMultiTouchPos(e) {\n      return Math.hypot(\n        e.touches[0].clientX - e.touches[1].clientX,\n        e.touches[0].clientY - e.touches[1].clientY\n      )\n    }\n\n    app.canvasEl.addEventListener(\n      'touchstart',\n      (e) => {\n        touchCount++\n        lastTouch = null\n        if (e.touches?.length === 1) {\n          // Store start time for press+hold for context menu\n          touchTime = new Date()\n          lastTouch = e.touches[0]\n        } else {\n          touchTime = null\n          if (e.touches?.length === 2) {\n            // Store center pos for zoom\n            zoomPos = getMultiTouchPos(e)\n            app.canvas.pointer_is_down = false\n          }\n        }\n      },\n      true\n    )\n\n    app.canvasEl.addEventListener('touchend', (e: TouchEvent) => {\n      touchZooming = false\n      touchCount = e.touches?.length ?? touchCount - 1\n      if (touchTime && !e.touches?.length) {\n        if (new Date().getTime() - touchTime > 600) {\n          try {\n            // hack to get litegraph to use this event\n            e.constructor = CustomEvent\n          } catch (error) {}\n          // @ts-expect-error\n          e.clientX = lastTouch.clientX\n          // @ts-expect-error\n          e.clientY = lastTouch.clientY\n\n          app.canvas.pointer_is_down = true\n          // @ts-expect-error\n          app.canvas._mousedown_callback(e)\n        }\n        touchTime = null\n      }\n    })\n\n    app.canvasEl.addEventListener(\n      'touchmove',\n      (e) => {\n        touchTime = null\n        if (e.touches?.length === 2) {\n          app.canvas.pointer_is_down = false\n          touchZooming = true\n          // @ts-expect-error\n          LiteGraph.closeAllContextMenus()\n          // @ts-expect-error\n          app.canvas.search_box?.close()\n          const newZoomPos = getMultiTouchPos(e)\n\n          const midX = (e.touches[0].clientX + e.touches[1].clientX) / 2\n          const midY = (e.touches[0].clientY + e.touches[1].clientY) / 2\n\n          let scale = app.canvas.ds.scale\n          const diff = zoomPos - newZoomPos\n          if (diff > 0.5) {\n            scale *= 1 / 1.07\n          } else if (diff < -0.5) {\n            scale *= 1.07\n          }\n          app.canvas.ds.changeScale(scale, [midX, midY])\n          app.canvas.setDirty(true, true)\n          zoomPos = newZoomPos\n        }\n      },\n      true\n    )\n  }\n})\n\nconst processMouseDown = LGraphCanvas.prototype.processMouseDown\nLGraphCanvas.prototype.processMouseDown = function (e) {\n  if (touchZooming || touchCount) {\n    return\n  }\n  return processMouseDown.apply(this, arguments)\n}\n\nconst processMouseMove = LGraphCanvas.prototype.processMouseMove\nLGraphCanvas.prototype.processMouseMove = function (e) {\n  if (touchZooming || touchCount > 1) {\n    return\n  }\n  return processMouseMove.apply(this, arguments)\n}\n","import { app } from '../../scripts/app'\nimport { ComfyWidgets } from '../../scripts/widgets'\nimport { LiteGraph } from '@comfyorg/litegraph'\n// Adds defaults for quickly adding nodes with middle click on the input/output\n\napp.registerExtension({\n  name: 'Comfy.SlotDefaults',\n  suggestionsNumber: null,\n  init() {\n    LiteGraph.search_filter_enabled = true\n    LiteGraph.middle_click_slot_add_default_node = true\n    this.suggestionsNumber = app.ui.settings.addSetting({\n      id: 'Comfy.NodeSuggestions.number',\n      name: 'Number of nodes suggestions',\n      type: 'slider',\n      attrs: {\n        min: 1,\n        max: 100,\n        step: 1\n      },\n      defaultValue: 5,\n      onChange: (newVal, oldVal) => {\n        this.setDefaults(newVal)\n      }\n    })\n  },\n  slot_types_default_out: {},\n  slot_types_default_in: {},\n  async beforeRegisterNodeDef(nodeType, nodeData, app) {\n    var nodeId = nodeData.name\n    var inputs = []\n    inputs = nodeData['input']['required'] //only show required inputs to reduce the mess also not logical to create node with optional inputs\n    for (const inputKey in inputs) {\n      var input = inputs[inputKey]\n      if (typeof input[0] !== 'string') continue\n\n      var type = input[0]\n      if (type in ComfyWidgets) {\n        var customProperties = input[1]\n        if (!customProperties?.forceInput) continue //ignore widgets that don't force input\n      }\n\n      if (!(type in this.slot_types_default_out)) {\n        this.slot_types_default_out[type] = ['Reroute']\n      }\n      if (this.slot_types_default_out[type].includes(nodeId)) continue\n      this.slot_types_default_out[type].push(nodeId)\n\n      // Input types have to be stored as lower case\n      // Store each node that can handle this input type\n      const lowerType = type.toLocaleLowerCase()\n      if (!(lowerType in LiteGraph.registered_slot_in_types)) {\n        LiteGraph.registered_slot_in_types[lowerType] = { nodes: [] }\n      }\n      LiteGraph.registered_slot_in_types[lowerType].nodes.push(\n        nodeType.comfyClass\n      )\n    }\n\n    var outputs = nodeData['output']\n    for (const key in outputs) {\n      var type = outputs[key] as string\n      if (!(type in this.slot_types_default_in)) {\n        this.slot_types_default_in[type] = ['Reroute'] // [\"Reroute\", \"Primitive\"];  primitive doesn't always work :'()\n      }\n\n      this.slot_types_default_in[type].push(nodeId)\n\n      // Store each node that can handle this output type\n      if (!(type in LiteGraph.registered_slot_out_types)) {\n        LiteGraph.registered_slot_out_types[type] = { nodes: [] }\n      }\n      LiteGraph.registered_slot_out_types[type].nodes.push(nodeType.comfyClass)\n\n      if (!LiteGraph.slot_types_out.includes(type)) {\n        LiteGraph.slot_types_out.push(type)\n      }\n    }\n    var maxNum = this.suggestionsNumber.value\n    this.setDefaults(maxNum)\n  },\n  setDefaults(maxNum) {\n    LiteGraph.slot_types_default_out = {}\n    LiteGraph.slot_types_default_in = {}\n\n    for (const type in this.slot_types_default_out) {\n      LiteGraph.slot_types_default_out[type] = this.slot_types_default_out[\n        type\n      ].slice(0, maxNum)\n    }\n    for (const type in this.slot_types_default_in) {\n      LiteGraph.slot_types_default_in[type] = this.slot_types_default_in[\n        type\n      ].slice(0, maxNum)\n    }\n  }\n})\n","import { app } from '../../scripts/app'\nimport {\n  LGraphCanvas,\n  LGraphNode,\n  LGraphGroup,\n  LiteGraph\n} from '@comfyorg/litegraph'\n\n// Shift + drag/resize to snap to grid\n\n/** Rounds a Vector2 in-place to the current CANVAS_GRID_SIZE. */\nfunction roundVectorToGrid(vec) {\n  vec[0] =\n    LiteGraph.CANVAS_GRID_SIZE * Math.round(vec[0] / LiteGraph.CANVAS_GRID_SIZE)\n  vec[1] =\n    LiteGraph.CANVAS_GRID_SIZE * Math.round(vec[1] / LiteGraph.CANVAS_GRID_SIZE)\n  return vec\n}\n\napp.registerExtension({\n  name: 'Comfy.SnapToGrid',\n  init() {\n    // Add setting to control grid size\n    app.ui.settings.addSetting({\n      id: 'Comfy.SnapToGrid.GridSize',\n      name: 'Grid Size',\n      type: 'slider',\n      attrs: {\n        min: 1,\n        max: 500\n      },\n      tooltip:\n        'When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid.',\n      defaultValue: LiteGraph.CANVAS_GRID_SIZE,\n      onChange(value) {\n        LiteGraph.CANVAS_GRID_SIZE = +value\n      }\n    })\n\n    // After moving a node, if the shift key is down align it to grid\n    const onNodeMoved = app.canvas.onNodeMoved\n    app.canvas.onNodeMoved = function (node) {\n      const r = onNodeMoved?.apply(this, arguments)\n\n      if (app.shiftDown) {\n        // Ensure all selected nodes are realigned\n        for (const id in this.selected_nodes) {\n          this.selected_nodes[id].alignToGrid()\n        }\n      }\n\n      return r\n    }\n\n    // When a node is added, add a resize handler to it so we can fix align the size with the grid\n    const onNodeAdded = app.graph.onNodeAdded\n    app.graph.onNodeAdded = function (node) {\n      const onResize = node.onResize\n      node.onResize = function () {\n        if (app.shiftDown) {\n          roundVectorToGrid(node.size)\n        }\n        return onResize?.apply(this, arguments)\n      }\n      return onNodeAdded?.apply(this, arguments)\n    }\n\n    // Draw a preview of where the node will go if holding shift and the node is selected\n    const origDrawNode = LGraphCanvas.prototype.drawNode\n    LGraphCanvas.prototype.drawNode = function (node, ctx) {\n      if (\n        app.shiftDown &&\n        this.node_dragged &&\n        node.id in this.selected_nodes\n      ) {\n        const [x, y] = roundVectorToGrid([...node.pos])\n        const shiftX = x - node.pos[0]\n        let shiftY = y - node.pos[1]\n\n        let w, h\n        if (node.flags.collapsed) {\n          // @ts-expect-error\n          w = node._collapsed_width\n          h = LiteGraph.NODE_TITLE_HEIGHT\n          shiftY -= LiteGraph.NODE_TITLE_HEIGHT\n        } else {\n          w = node.size[0]\n          h = node.size[1]\n          // @ts-expect-error\n          let titleMode = node.constructor.title_mode\n          if (\n            titleMode !== LiteGraph.TRANSPARENT_TITLE &&\n            titleMode !== LiteGraph.NO_TITLE\n          ) {\n            h += LiteGraph.NODE_TITLE_HEIGHT\n            shiftY -= LiteGraph.NODE_TITLE_HEIGHT\n          }\n        }\n        const f = ctx.fillStyle\n        ctx.fillStyle = 'rgba(100, 100, 100, 0.5)'\n        ctx.fillRect(shiftX, shiftY, w, h)\n        ctx.fillStyle = f\n      }\n\n      return origDrawNode.apply(this, arguments)\n    }\n\n    /**\n     * The currently moving, selected group only. Set after the `selected_group` has actually started\n     * moving.\n     */\n    let selectedAndMovingGroup: LGraphGroup | null = null\n\n    /**\n     * Handles moving a group; tracking when a group has been moved (to show the ghost in `drawGroups`\n     * below) as well as handle the last move call from LiteGraph's `processMouseUp`.\n     */\n    const groupMove = LGraphGroup.prototype.move\n    LGraphGroup.prototype.move = function (deltax, deltay, ignore_nodes) {\n      const v = groupMove.apply(this, arguments)\n      // When we've started moving, set `selectedAndMovingGroup` as LiteGraph sets `selected_group`\n      // too eagerly and we don't want to behave like we're moving until we get a delta.\n      if (\n        !selectedAndMovingGroup &&\n        app.canvas.selected_group === this &&\n        (deltax || deltay)\n      ) {\n        selectedAndMovingGroup = this\n      }\n\n      // LiteGraph will call group.move both on mouse-move as well as mouse-up though we only want\n      // to snap on a mouse-up which we can determine by checking if `app.canvas.last_mouse_dragging`\n      // has been set to `false`. Essentially, this check here is the equivalent to calling an\n      // `LGraphGroup.prototype.onNodeMoved` if it had existed.\n      if (app.canvas.last_mouse_dragging === false && app.shiftDown) {\n        // After moving a group (while app.shiftDown), snap all the child nodes and, finally,\n        //  align the group itself.\n        this.recomputeInsideNodes()\n        for (const node of this._nodes) {\n          node.alignToGrid()\n        }\n        LGraphNode.prototype.alignToGrid.apply(this)\n      }\n      return v\n    }\n\n    /**\n     * Handles drawing a group when, snapping the size when one is actively being resized tracking and/or\n     * drawing a ghost box when one is actively being moved. This mimics the node snapping behavior for\n     * both.\n     */\n    const drawGroups = LGraphCanvas.prototype.drawGroups\n    LGraphCanvas.prototype.drawGroups = function (canvas, ctx) {\n      if (this.selected_group && app.shiftDown) {\n        if (this.selected_group_resizing) {\n          roundVectorToGrid(this.selected_group.size)\n        } else if (selectedAndMovingGroup) {\n          // @ts-expect-error\n          const [x, y] = roundVectorToGrid([...selectedAndMovingGroup.pos])\n          const f = ctx.fillStyle\n          const s = ctx.strokeStyle\n          ctx.fillStyle = 'rgba(100, 100, 100, 0.33)'\n          ctx.strokeStyle = 'rgba(100, 100, 100, 0.66)'\n          // @ts-expect-error\n          ctx.rect(x, y, ...selectedAndMovingGroup.size)\n          ctx.fill()\n          ctx.stroke()\n          ctx.fillStyle = f\n          ctx.strokeStyle = s\n        }\n      } else if (!this.selected_group) {\n        selectedAndMovingGroup = null\n      }\n      return drawGroups.apply(this, arguments)\n    }\n\n    /** Handles adding a group in a snapping-enabled state. */\n    const onGroupAdd = LGraphCanvas.onGroupAdd\n    LGraphCanvas.onGroupAdd = function () {\n      const v = onGroupAdd.apply(app.canvas, arguments)\n      if (app.shiftDown) {\n        // @ts-expect-error\n        const lastGroup = app.graph._groups[app.graph._groups.length - 1]\n        if (lastGroup) {\n          // @ts-expect-error\n          roundVectorToGrid(lastGroup.pos)\n          // @ts-expect-error\n          roundVectorToGrid(lastGroup.size)\n        }\n      }\n      return v\n    }\n  }\n})\n","import { app } from '../../scripts/app'\nimport { ComfyNodeDef } from '@/types/apiTypes'\n\n// Adds an upload button to the nodes\n\napp.registerExtension({\n  name: 'Comfy.UploadImage',\n  async beforeRegisterNodeDef(nodeType, nodeData: ComfyNodeDef, app) {\n    if (nodeData?.input?.required?.image?.[1]?.image_upload === true) {\n      nodeData.input.required.upload = ['IMAGEUPLOAD']\n    }\n  }\n})\n","import { app } from '../../scripts/app'\nimport { api } from '../../scripts/api'\n\nconst WEBCAM_READY = Symbol()\n\napp.registerExtension({\n  name: 'Comfy.WebcamCapture',\n  getCustomWidgets(app) {\n    return {\n      WEBCAM(node, inputName) {\n        let res\n        node[WEBCAM_READY] = new Promise((resolve) => (res = resolve))\n\n        const container = document.createElement('div')\n        container.style.background = 'rgba(0,0,0,0.25)'\n        container.style.textAlign = 'center'\n\n        const video = document.createElement('video')\n        video.style.height = video.style.width = '100%'\n\n        const loadVideo = async () => {\n          try {\n            const stream = await navigator.mediaDevices.getUserMedia({\n              video: true,\n              audio: false\n            })\n            container.replaceChildren(video)\n\n            setTimeout(() => res(video), 500) // Fallback as loadedmetadata doesnt fire sometimes?\n            video.addEventListener('loadedmetadata', () => res(video), false)\n            video.srcObject = stream\n            video.play()\n          } catch (error) {\n            const label = document.createElement('div')\n            label.style.color = 'red'\n            label.style.overflow = 'auto'\n            label.style.maxHeight = '100%'\n            label.style.whiteSpace = 'pre-wrap'\n\n            if (window.isSecureContext) {\n              label.textContent =\n                'Unable to load webcam, please ensure access is granted:\\n' +\n                error.message\n            } else {\n              label.textContent =\n                'Unable to load webcam. A secure context is required, if you are not accessing ComfyUI on localhost (127.0.0.1) you will have to enable TLS (https)\\n\\n' +\n                error.message\n            }\n\n            container.replaceChildren(label)\n          }\n        }\n\n        loadVideo()\n\n        return { widget: node.addDOMWidget(inputName, 'WEBCAM', container) }\n      }\n    }\n  },\n  nodeCreated(node) {\n    if ((node.type, node.constructor.comfyClass !== 'WebcamCapture')) return\n\n    let video\n    const camera = node.widgets.find((w) => w.name === 'image')\n    const w = node.widgets.find((w) => w.name === 'width')\n    const h = node.widgets.find((w) => w.name === 'height')\n    const captureOnQueue = node.widgets.find(\n      (w) => w.name === 'capture_on_queue'\n    )\n\n    const canvas = document.createElement('canvas')\n\n    const capture = () => {\n      canvas.width = w.value\n      canvas.height = h.value\n      const ctx = canvas.getContext('2d')\n      ctx.drawImage(video, 0, 0, w.value, h.value)\n      const data = canvas.toDataURL('image/png')\n\n      const img = new Image()\n      img.onload = () => {\n        node.imgs = [img]\n        app.graph.setDirtyCanvas(true)\n        requestAnimationFrame(() => {\n          node.setSizeForImage?.()\n        })\n      }\n      img.src = data\n    }\n\n    const btn = node.addWidget(\n      'button',\n      'waiting for camera...',\n      'capture',\n      capture\n    )\n    btn.disabled = true\n    btn.serializeValue = () => undefined\n\n    camera.serializeValue = async () => {\n      if (captureOnQueue.value) {\n        capture()\n      } else if (!node.imgs?.length) {\n        const err = `No webcam image captured`\n        alert(err)\n        throw new Error(err)\n      }\n\n      // Upload image to temp storage\n      const blob = await new Promise<Blob>((r) => canvas.toBlob(r))\n      const name = `${+new Date()}.png`\n      const file = new File([blob], name)\n      const body = new FormData()\n      body.append('image', file)\n      body.append('subfolder', 'webcam')\n      body.append('type', 'temp')\n      const resp = await api.fetchApi('/upload/image', {\n        method: 'POST',\n        body\n      })\n      if (resp.status !== 200) {\n        const err = `Error uploading camera image: ${resp.status} - ${resp.statusText}`\n        alert(err)\n        throw new Error(err)\n      }\n      return `webcam/${name} [temp]`\n    }\n\n    node[WEBCAM_READY].then((v) => {\n      video = v\n      // If width isnt specified then use video output resolution\n      if (!w.value) {\n        w.value = video.videoWidth || 640\n        h.value = video.videoHeight || 480\n      }\n      btn.disabled = false\n      btn.label = 'capture'\n    })\n  }\n})\n","import { app } from '../../scripts/app'\nimport { api } from '../../scripts/api'\nimport type { IWidget } from '@comfyorg/litegraph'\nimport type { DOMWidget } from '@/scripts/domWidget'\nimport { ComfyNodeDef } from '@/types/apiTypes'\n\ntype FolderType = 'input' | 'output' | 'temp'\n\nfunction splitFilePath(path: string): [string, string] {\n  const folder_separator = path.lastIndexOf('/')\n  if (folder_separator === -1) {\n    return ['', path]\n  }\n  return [\n    path.substring(0, folder_separator),\n    path.substring(folder_separator + 1)\n  ]\n}\n\nfunction getResourceURL(\n  subfolder: string,\n  filename: string,\n  type: FolderType = 'input'\n): string {\n  const params = [\n    'filename=' + encodeURIComponent(filename),\n    'type=' + type,\n    'subfolder=' + subfolder,\n    app.getRandParam().substring(1)\n  ].join('&')\n\n  return `/view?${params}`\n}\n\nasync function uploadFile(\n  audioWidget: IWidget,\n  audioUIWidget: DOMWidget<HTMLAudioElement>,\n  file: File,\n  updateNode: boolean,\n  pasted: boolean = false\n) {\n  try {\n    // Wrap file in formdata so it includes filename\n    const body = new FormData()\n    body.append('image', file)\n    if (pasted) body.append('subfolder', 'pasted')\n    const resp = await api.fetchApi('/upload/image', {\n      method: 'POST',\n      body\n    })\n\n    if (resp.status === 200) {\n      const data = await resp.json()\n      // Add the file to the dropdown list and update the widget value\n      let path = data.name\n      if (data.subfolder) path = data.subfolder + '/' + path\n\n      if (!audioWidget.options.values.includes(path)) {\n        audioWidget.options.values.push(path)\n      }\n\n      if (updateNode) {\n        audioUIWidget.element.src = api.apiURL(\n          getResourceURL(...splitFilePath(path))\n        )\n        audioWidget.value = path\n      }\n    } else {\n      alert(resp.status + ' - ' + resp.statusText)\n    }\n  } catch (error) {\n    alert(error)\n  }\n}\n\n// AudioWidget MUST be registered first, as AUDIOUPLOAD depends on AUDIO_UI to be\n// present.\napp.registerExtension({\n  name: 'Comfy.AudioWidget',\n  async beforeRegisterNodeDef(nodeType, nodeData) {\n    if (\n      ['LoadAudio', 'SaveAudio', 'PreviewAudio'].includes(nodeType.comfyClass)\n    ) {\n      nodeData.input.required.audioUI = ['AUDIO_UI']\n    }\n  },\n  getCustomWidgets() {\n    return {\n      AUDIO_UI(node, inputName: string) {\n        const audio = document.createElement('audio')\n        audio.controls = true\n        audio.classList.add('comfy-audio')\n        audio.setAttribute('name', 'media')\n\n        const audioUIWidget: DOMWidget<HTMLAudioElement> = node.addDOMWidget(\n          inputName,\n          /* name=*/ 'audioUI',\n          audio\n        )\n        // @ts-expect-error\n        // TODO: Sort out the DOMWidget type.\n        audioUIWidget.serialize = false\n\n        const isOutputNode = node.constructor.nodeData.output_node\n        if (isOutputNode) {\n          // Hide the audio widget when there is no audio initially.\n          audioUIWidget.element.classList.add('empty-audio-widget')\n          // Populate the audio widget UI on node execution.\n          const onExecuted = node.onExecuted\n          node.onExecuted = function (message) {\n            onExecuted?.apply(this, arguments)\n            const audios = message.audio\n            if (!audios) return\n            const audio = audios[0]\n            audioUIWidget.element.src = api.apiURL(\n              getResourceURL(audio.subfolder, audio.filename, audio.type)\n            )\n            audioUIWidget.element.classList.remove('empty-audio-widget')\n          }\n        }\n        return { widget: audioUIWidget }\n      }\n    }\n  },\n  onNodeOutputsUpdated(nodeOutputs: Record<number, any>) {\n    for (const [nodeId, output] of Object.entries(nodeOutputs)) {\n      const node = app.graph.getNodeById(Number.parseInt(nodeId))\n      if ('audio' in output) {\n        const audioUIWidget = node.widgets.find(\n          (w) => w.name === 'audioUI'\n        ) as unknown as DOMWidget<HTMLAudioElement>\n        const audio = output.audio[0]\n        audioUIWidget.element.src = api.apiURL(\n          getResourceURL(audio.subfolder, audio.filename, audio.type)\n        )\n        audioUIWidget.element.classList.remove('empty-audio-widget')\n      }\n    }\n  }\n})\n\napp.registerExtension({\n  name: 'Comfy.UploadAudio',\n  async beforeRegisterNodeDef(nodeType, nodeData: ComfyNodeDef) {\n    if (nodeData?.input?.required?.audio?.[1]?.audio_upload === true) {\n      nodeData.input.required.upload = ['AUDIOUPLOAD']\n    }\n  },\n  getCustomWidgets() {\n    return {\n      AUDIOUPLOAD(node, inputName: string) {\n        // The widget that allows user to select file.\n        const audioWidget: IWidget = node.widgets.find(\n          (w: IWidget) => w.name === 'audio'\n        )\n        const audioUIWidget: DOMWidget<HTMLAudioElement> = node.widgets.find(\n          (w: IWidget) => w.name === 'audioUI'\n        )\n\n        const onAudioWidgetUpdate = () => {\n          audioUIWidget.element.src = api.apiURL(\n            getResourceURL(...splitFilePath(audioWidget.value))\n          )\n        }\n        // Initially load default audio file to audioUIWidget.\n        if (audioWidget.value) {\n          onAudioWidgetUpdate()\n        }\n        audioWidget.callback = onAudioWidgetUpdate\n\n        // Load saved audio file widget values if restoring from workflow\n        const onGraphConfigured = node.onGraphConfigured\n        node.onGraphConfigured = function () {\n          onGraphConfigured?.apply(this, arguments)\n          if (audioWidget.value) {\n            onAudioWidgetUpdate()\n          }\n        }\n\n        const fileInput = document.createElement('input')\n        fileInput.type = 'file'\n        fileInput.accept = 'audio/*'\n        fileInput.style.display = 'none'\n        fileInput.onchange = () => {\n          if (fileInput.files.length) {\n            uploadFile(audioWidget, audioUIWidget, fileInput.files[0], true)\n          }\n        }\n        // The widget to pop up the upload dialog.\n        const uploadWidget = node.addWidget(\n          'button',\n          inputName,\n          /* value=*/ '',\n          () => {\n            fileInput.click()\n          }\n        )\n        uploadWidget.label = 'choose file to upload'\n        uploadWidget.serialize = false\n\n        return { widget: uploadWidget }\n      }\n    }\n  }\n})\n"],"names":["app","id","file","ext","prompt","links","_a","widget","_b","w","type","_c","def","node","link","selectedIds","newNodes","i","group","modal","x","y","audio"],"mappings":"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"}